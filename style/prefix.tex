\documentclass{book}
\usepackage[defaultlines=4,all]{nowidow}
\usepackage[asymmetric, reversemarginpar]{geometry}
\usepackage{xeCJK}
\setCJKmainfont[BoldFont={WenQuanYi Micro Hei}, ItalicFont={AR PL UKai CN}]{Adobe Song Std}
\setCJKsansfont{Adobe Song Std}
\setCJKmonofont{Adobe Song Std}
\xeCJKDeclarePunctStyle{mine}{
  enabled-hanging=true,
}
\xeCJKsetup{CJKmath=true, PlainEquation=true, PunctStyle=mine}
\normalspacedchars{/\\-"}
\usepackage{fontspec}
\setmainfont{TeX Gyre Pagella}[BoldFont={WenQuanYi Micro Hei}, ItalicFont={TeX Gyre Pagella}]
\setsansfont{TeX Gyre Pagella}
\usepackage[T1]{fontenc}
\usepackage{emptypage}

% use package proof
\usepackage{proof}

% also indent at first paragraph
\usepackage{indentfirst}
\setlength{\parindent}{2em}

% customize title format
\usepackage{titlesec}
\titleformat
{\chapter} % command
[hang]
{\bfseries\Large} % format
{\Larger{\Larger{\Larger\thechapter}}} % label
{0.5em} % sep
{
} % before-code
[
] % after-code

% customize header format
\usepackage{fancyhdr}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
\renewcommand{\chaptername}{}
\pagestyle{fancy}
\fancyhf{}
\renewcommand\chaptermark[1]{ \markboth{\textit{\thechapter \hskip1em #1}}{} }
\renewcommand\sectionmark[1]{ \markright{\textit{\thesection \hskip1em  #1}} }
\fancyhead[LE,RO]{\thepage}
\fancyhead[RE]{\leftmark}
\fancyhead[LO]{\rightmark}

% use exercise package for exercise
\usepackage{exercise}
\renewcommand\DifficultyMarker{$\star$}
\renewcommand{\ExerciseHeaderDifficulty}{\theExerciseDifficulty}
\renewcommand{\ExerciseName}{练习}
\renewcommand{\ExerciseHeader}{\noindent\textit{\ExerciseName}\thechapter.\ExerciseHeaderNB~[\ExerciseHeaderDifficulty\ignorespaces]}
\newcounter{ChapterCounter}
\renewcounter{ChapterCounter}[chapter]

\usepackage{xpatch}
\makeatletter
\AtBeginDocument{\xpatchcmd{\@thm}{\thm@headpunct{.}}{\thm@headpunct{}}{}{}}
\makeatother

\usepackage{caption}
\usepackage{subcaption}
\captionsetup[figure]{labelfont=bf, labelsep=quad, name=图}

\usepackage[perpage]{footmisc}

\usepackage{hyperref}
\hypersetup{
  pdfauthor={Daniel P. Friedman, Mitchell Wand},
  pdftitle={Essentials Of Programming Languages},
  pdfsubject={programming languages},
  pdfkeywords={programming languages},
  pdfpagelabels=ture,
  colorlinks=true,
  urlcolor=blue,
  linkcolor=black,
  citecolor=red
}
