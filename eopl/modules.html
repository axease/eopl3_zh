<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>8&nbsp;模块</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="footnote.css" title="default"/><link rel="stylesheet" type="text/css" href="scribble-style.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript">
(function() {
  document.write('<link rel="stylesheet" href="katex/katex.min.css" />');
})();(function() {document.write('<scr' + 'ipt type="text/javascript" src="katex/katex.min.js"></scr' + 'ipt>');})();(function(f) {
  // A "simple" onLoad function
  if (window.document.readyState == "complete") {
    f();
  } else if (window.document.addEventListener) {
    window.document.addEventListener("DOMContentLoaded", f, false);
  } else if (window.attachEvent) {
    window.attachEvent("onreadystatechange", function() {
      if (window.document.readyState == "complete") {
        f();
      }
    });
  } else {
    var oldLoad = window.onload;
    if (typeof(oldLoad) == "function") {
      window.onload = function() {
        try {
          oldLoad();
        } finally {
          f();
        }
      };
    } else {
      window.onload = f;
    }
  }
})(function() {
  // This is an ugly way to change the doctype, in case the scribble document
  // did not use (with-html5).
  if (!(document.doctype && document.doctype.publicId == '')) {
    if (console && console.log) {
      console.log("Re-wrote the document to use the HTML5 doctype.\n"
                  + "  Consider using the following declaration:\n"
                  + "      @title[#:style (with-html5 manual-doc-style)]{…}");
    }
    var wholeDoc = '<!doctype HTML>\n' + document.documentElement.outerHTML;
    document.open();
    document.clear();
    document.write(wholeDoc);
  }
  var inlineElements = document.getElementsByClassName("texMathInline");
  for (var i = 0; i < inlineElements.length; i++) {
    var e = inlineElements[i];
    katex.render(e.textContent, e, { displayMode:false, throwOnError:false });
  }
  var displayElements = document.getElementsByClassName("texMathDisplay");
  for (var i = 0; i < displayElements.length; i++) {
    var e = displayElements[i];
    katex.render(e.textContent, e, { displayMode:true, throwOnError:false });
  }
});
</script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">&#32534;&#31243;&#35821;&#35328;&#35201;&#32032;</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="fw-trans.html" class="tocviewlink" data-pltdoc="x">&#35793;&#32773;&#30340;&#35805;</a></td></tr><tr><td align="right"></td><td><a href="glo.html" class="tocviewlink" data-pltdoc="x">&#35793;&#21517;&#34920;</a></td></tr><tr><td align="right"></td><td><a href="fw.html" class="tocviewlink" data-pltdoc="x">&#24207;</a></td></tr><tr><td align="right"></td><td><a href="pf.html" class="tocviewlink" data-pltdoc="x">&#21069;&#35328;</a></td></tr><tr><td align="right"></td><td><a href="awk.html" class="tocviewlink" data-pltdoc="x">&#33268;&#35874;</a></td></tr><tr><td align="right">1&nbsp;</td><td><a href="isd.html" class="tocviewlink" data-pltdoc="x">&#24402;&#32435;&#24335;&#25968;&#25454;&#38598;</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="da.html" class="tocviewlink" data-pltdoc="x">&#25968;&#25454;&#25277;&#35937;</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="expr.html" class="tocviewlink" data-pltdoc="x">&#34920;&#36798;&#24335;</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="state.html" class="tocviewlink" data-pltdoc="x">&#29366;&#24577;</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="cpi.html" class="tocviewlink" data-pltdoc="x">&#20256;&#36882;&#32493;&#25991;&#30340;&#35299;&#37322;&#22120;</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="cps.html" class="tocviewlink" data-pltdoc="x">&#32493;&#25991;&#20256;&#36882;&#39118;&#26684;</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="types.html" class="tocviewlink" data-pltdoc="x">&#31867;&#22411;</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">&#27169;&#22359;</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="oac.html" class="tocviewlink" data-pltdoc="x">&#23545;&#35937;&#21644;&#31867;</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="further-reading.html" class="tocviewlink" data-pltdoc="x">&#25193;&#23637;&#38405;&#35835;</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="sllgen-parsing-system.html" class="tocviewlink" data-pltdoc="x">SLLGEN&#35299;&#26512;&#31995;&#32479;</a></td></tr><tr><td align="right"></td><td><a href="bib.html" class="tocviewlink" data-pltdoc="x">&#21442;&#32771;&#20070;&#30446;</a></td></tr><tr><td align="right"></td><td><a href="indices.html" class="tocviewlink" data-pltdoc="x">&#32034;&#24341;</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>8&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">&#27169;&#22359;</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">8.1&nbsp;</td><td><a href="#%28part._s8..1%29" class="tocviewlink" data-pltdoc="x">&#31616;&#21333;&#27169;&#22359;&#31995;&#32479;</a></td></tr><tr><td align="right">8.2&nbsp;</td><td><a href="#%28part._s8..2%29" class="tocviewlink" data-pltdoc="x">&#22768;&#26126;&#31867;&#22411;&#30340;&#27169;&#22359;</a></td></tr><tr><td align="right">8.3&nbsp;</td><td><a href="#%28part._s8..3%29" class="tocviewlink" data-pltdoc="x">&#27169;&#22359;&#36807;&#31243;</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">8.1<tt>&nbsp;</tt></span><a href="#%28part._s8..1%29" class="tocsubseclink" data-pltdoc="x">&#31616;&#21333;&#27169;&#22359;&#31995;&#32479;</a></td></tr><tr><td><span class="tocsublinknumber">8.1.1<tt>&nbsp;</tt></span><a href="#%28part._s8..1..1%29" class="tocsubseclink" data-pltdoc="x">&#20363;&#23376;</a></td></tr><tr><td><span class="tocsublinknumber">8.1.2<tt>&nbsp;</tt></span><a href="#%28part._s8..1..2%29" class="tocsubseclink" data-pltdoc="x">&#23454;&#29616;&#31616;&#21333;&#27169;&#22359;&#31995;&#32479;</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._s8..1-syntax%29" class="tocsubseclink" data-pltdoc="x">&#35821;&#27861;</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._s8..1-the-interpreter%29" class="tocsubseclink" data-pltdoc="x">&#35299;&#37322;&#22120;</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._s8..1-checker%29" class="tocsubseclink" data-pltdoc="x">&#26816;&#26597;&#22120;</a></td></tr><tr><td><span class="tocsublinknumber">8.2<tt>&nbsp;</tt></span><a href="#%28part._s8..2%29" class="tocsubseclink" data-pltdoc="x">&#22768;&#26126;&#31867;&#22411;&#30340;&#27169;&#22359;</a></td></tr><tr><td><span class="tocsublinknumber">8.2.1<tt>&nbsp;</tt></span><a href="#%28part._s8..2..1%29" class="tocsubseclink" data-pltdoc="x">&#20363;&#23376;</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._s8..2-transparent-types%29" class="tocsubseclink" data-pltdoc="x">&#36879;&#26126;&#31867;&#22411;</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._s8..2-opaque-types%29" class="tocsubseclink" data-pltdoc="x">&#27169;&#31946;&#31867;&#22411;</a></td></tr><tr><td><span class="tocsublinknumber">8.2.2<tt>&nbsp;</tt></span><a href="#%28part._s8..2..2%29" class="tocsubseclink" data-pltdoc="x">&#23454;&#29616;</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._syntax-and-the-interpreter%29" class="tocsubseclink" data-pltdoc="x">&#35821;&#27861;&#21644;&#35299;&#37322;&#22120;</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._the-checker%29" class="tocsubseclink" data-pltdoc="x">&#26816;&#26597;&#22120;</a></td></tr><tr><td><span class="tocsublinknumber">8.3<tt>&nbsp;</tt></span><a href="#%28part._s8..3%29" class="tocsubseclink" data-pltdoc="x">&#27169;&#22359;&#36807;&#31243;</a></td></tr><tr><td><span class="tocsublinknumber">8.3.1<tt>&nbsp;</tt></span><a href="#%28part._s8..3..1%29" class="tocsubseclink" data-pltdoc="x">&#20363;&#23376;</a></td></tr><tr><td><span class="tocsublinknumber">8.3.2<tt>&nbsp;</tt></span><a href="#%28part._s8..3..2%29" class="tocsubseclink" data-pltdoc="x">&#23454;&#29616;</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._s8..3-syntax%29" class="tocsubseclink" data-pltdoc="x">&#35821;&#27861;</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._s8..3-interpreter%29" class="tocsubseclink" data-pltdoc="x">&#35299;&#37322;&#22120;</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._s8..3-checker%29" class="tocsubseclink" data-pltdoc="x">&#26816;&#26597;&#22120;</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="types.html" title="backward to &quot;7 类型&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;编程语言要素&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="oac.html" title="forward to &quot;9 对象和类&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>8<tt>&nbsp;</tt><a name="(part._modules)"></a>&#27169;&#22359;</h3><p><a name="(idx._(gentag._1181))"></a>
&#35201;&#26500;&#24314;&#21482;&#26377;&#20960;&#30334;&#34892;&#20195;&#30721;&#30340;&#31995;&#32479;&#65292;&#25105;&#20204;&#20171;&#32461;&#30340;&#35821;&#35328;&#29305;&#24615;&#24050;&#38750;&#24120;&#24378;&#22823;&#12290;&#22914;&#26524;&#25105;&#20204;&#35201;&#26500;&#24314;&#26356;&#22823;&#30340;&#31995;
&#32479;&#65292;&#26377;&#25968;&#21315;&#34892;&#20195;&#30721;&#65292;&#25105;&#20204;&#23601;&#36824;&#38656;&#35201;&#19968;&#20123;&#21035;&#30340;&#20304;&#26009;&#12290;</p><ol><li><p>&#25105;&#20204;&#38656;&#35201;&#19968;&#31181;&#22909;&#30340;&#26041;&#24335;&#65292;&#23558;&#31995;&#32479;&#20998;&#20026;&#30456;&#23545;&#29420;&#31435;&#30340;&#37096;&#20998;&#65292;&#24182;&#33021;&#32534;&#20889;&#25991;&#26723;&#65292;&#35299;&#37322;&#21508;&#37096;&#20998;
&#20043;&#38388;&#30340;&#20381;&#36182;&#20851;&#31995;&#12290;</p></li><li><p>&#25105;&#20204;&#38656;&#35201;&#19968;&#31181;&#26356;&#22909;&#30340;&#26041;&#24335;&#26469;&#25511;&#21046;&#21517;&#23383;&#30340;&#20316;&#29992;&#22495;&#21644;&#32465;&#23450;&#12290;&#35789;&#27861;&#23450;&#30028;&#26159;&#21629;&#21517;&#25511;&#21046;&#30340;&#24378;&#22823;
&#24037;&#20855;&#65292;&#20294;&#19981;&#36275;&#20197;&#24212;&#23545;&#26356;&#22823;&#25110;&#20998;&#21106;&#20026;&#22810;&#20221;&#28304;&#20195;&#30721;&#30340;&#31243;&#24207;&#12290;</p></li><li><p>&#25105;&#20204;&#38656;&#35201;&#19968;&#31181;&#26041;&#24335;&#24378;&#21270;&#25277;&#35937;&#36793;&#30028;&#12290;&#22312;<a href="da.html" data-pltdoc="x">&#25968;&#25454;&#25277;&#35937;</a>&#65292;&#25105;&#20204;&#20171;&#32461;&#20102;&#25277;&#35937;&#25968;&#25454;&#31867;&#22411;&#30340;&#24605;&#24819;&#12290;
&#22312;&#31867;&#22411;&#30340;&#23454;&#29616;&#20013;&#65292;&#25105;&#20204;&#21487;&#20197;&#23545;&#20540;&#20570;&#20219;&#24847;&#25805;&#20316;&#65292;&#20294;&#22312;&#23454;&#29616;&#20043;&#22806;&#65292;&#31867;&#22411;&#30340;&#20540;&#21482;&#33021;&#36890;&#36807;&#31867;&#22411;&#25509;&#21475;
&#20013;&#30340;&#36807;&#31243;&#21019;&#24314;&#21644;&#25805;&#20316;&#12290;&#25105;&#20204;&#25226;&#36825;&#21483;&#20570;<a name="(idx._(gentag._1182))"></a><span class="emph">&#25277;&#35937;&#36793;&#30028;</span> (<span class="emph">abstraction boundary</span>)&#12290;&#22914;&#26524;&#31243;&#24207;&#36981;&#23432;&#36825;&#19968;&#30028;&#38480;&#65292;&#25105;&#20204;&#21487;
&#20197;&#25913;&#21464;&#25968;&#25454;&#31867;&#22411;&#30340;&#23454;&#29616;&#12290;&#20294;&#26159;&#65292;&#22914;&#26524;&#26576;&#20123;&#20195;&#30721;&#25171;&#30772;&#20102;&#25277;&#35937;&#65292;&#20381;&#36182;&#23454;&#29616;&#32454;&#33410;&#65292;&#25105;&#20204;&#23601;&#26080;&#27861;&#20219;
&#24847;&#20462;&#25913;&#23454;&#29616;&#32780;&#19981;&#30772;&#22351;&#20854;&#20182;&#20195;&#30721;&#12290;</p></li><li><p>&#26368;&#21518;&#65292;&#25105;&#20204;&#38656;&#35201;&#19968;&#31181;&#26041;&#24335;&#65292;&#23558;&#36825;&#20123;&#37096;&#20998;&#28789;&#27963;&#32452;&#21512;&#65292;&#35753;&#21516;&#19968;&#37096;&#20998;&#21487;&#22797;&#29992;&#20110;&#19981;&#21516;&#22320;&#26041;&#12290;</p></li></ol><p>&#26412;&#31456;&#65292;&#25105;&#20204;&#20171;&#32461;<span class="emph">&#27169;&#22359;</span> (<span class="emph">module</span>)&#65292;&#20197;&#28385;&#36275;&#36825;&#20123;&#38656;&#27714;&#12290;&#20855;&#20307;&#26469;&#35828;&#65292;&#25105;&#20204;&#23637;&#31034;&#20102;&#22914;&#20309;&#29992;
&#31867;&#22411;&#31995;&#32479;&#21019;&#24314;&#21644;&#24378;&#21270;&#25277;&#35937;&#36793;&#30028;&#12290;</p><p>&#25105;&#20204;&#30340;&#27169;&#22359;&#35821;&#35328;&#20013;&#65292;&#31243;&#24207;&#21253;&#21547;&#19968;&#31995;&#21015;<span class="emph">&#27169;&#22359;&#23450;&#20041;</span> (<span class="emph">module definition</span>)&#65292;&#21518;&#36319;&#19968;&#20010;&#24453;
&#27714;&#20540;&#30340;&#34920;&#36798;&#24335;&#12290;&#27599;&#20010;&#27169;&#22359;&#23450;&#20041;&#25226;&#19968;&#20010;&#21517;&#23383;&#32465;&#23450;&#21040;&#19968;&#20010;<span class="emph">&#27169;&#22359;</span>&#12290;&#21019;&#24314;&#30340;&#27169;&#22359;&#21487;&#33021;
&#26159;<span class="emph">&#31616;&#21333;&#27169;&#22359;</span> (<span class="emph">simple module</span>)&#65292;&#31867;&#20284;&#29615;&#22659;&#65292;&#26159;&#19968;&#32452;&#32465;&#23450;&#65307;&#20063;&#21487;&#33021;&#26159;<span class="emph">&#27169;&#22359;&#36807;&#31243;</span> (<span class="emph">module
procedure</span>)&#65292;&#21462;&#19968;&#27169;&#22359;&#65292;&#29983;&#25104;&#21478;&#19968;&#27169;&#22359;&#12290;</p><p><a name="(idx._(gentag._1183))"></a>
&#27599;&#20010;&#27169;&#22359;&#37117;&#26377;&#19968;&#22871;<span class="emph">&#25509;&#21475;</span> (<span class="emph">interface</span>)&#12290;&#20316;&#20026;&#19968;&#32452;&#32465;&#23450;&#30340;&#27169;&#22359;&#20855;&#26377;<span class="emph">&#31616;&#21333;&#25509;&#21475;</span> (<span class="emph">simple
interface</span>)&#65292;&#25509;&#21475;&#21015;&#20986;&#27169;&#22359;&#25552;&#20379;&#30340;&#32465;&#23450;&#21450;&#20854;&#31867;&#22411;&#12290;&#27169;&#22359;&#36807;&#31243;&#30340;&#25509;&#21475;&#25351;&#23450;&#27169;&#22359;&#30340;
&#21442;&#25968;&#25509;&#21475;&#21644;&#36820;&#22238;&#27169;&#22359;&#30340;&#25509;&#21475;&#65292;&#23601;&#20687;&#36807;&#31243;&#30340;&#31867;&#22411;&#25351;&#23450;&#21442;&#25968;&#21644;&#32467;&#26524;&#30340;&#31867;&#22411;&#12290;</p><p>&#36825;&#20123;&#25509;&#21475;&#23601;&#20687;&#31867;&#22411;&#19968;&#26679;&#65292;&#20915;&#23450;&#20102;&#27169;&#22359;&#32452;&#21512;&#30340;&#26041;&#24335;&#12290;&#22240;&#20026;&#27714;&#20986;&#31034;&#20363;&#31243;&#24207;&#30340;&#20540;&#38750;&#24120;&#30452;&#25509;&#65292;&#22240;&#27492;&#25105;
&#20204;&#20851;&#27880;&#20854;&#31867;&#22411;&#12290;&#22914;&#21069;&#25152;&#35265;&#65292;&#29702;&#35299;&#36825;&#31181;&#35821;&#35328;&#30340;&#23450;&#30028;&#21644;&#32465;&#23450;&#35268;&#21017;&#26159;&#31243;&#24207;&#20998;&#26512;&#21644;&#27714;&#20540;&#30340;&#20851;&#38190;&#12290;
<a name="(idx._(gentag._1184))"></a></p><h4>8.1<tt>&nbsp;</tt><a name="(part._s8..1)"></a>&#31616;&#21333;&#27169;&#22359;&#31995;&#32479;</h4><p><a name="(idx._(gentag._1185))"></a>
<a name="(idx._(gentag._1186))"></a>
&#25105;&#20204;&#30340;&#31532;&#19968;&#31181;&#35821;&#35328;&#21517;&#21483; SIMPLE-MODULES&#65292;&#21482;&#26377;&#31616;&#21333;&#27169;&#22359;&#12290;&#23427;&#27809;&#26377;&#27169;&#22359;&#36807;&#31243;&#65292;&#21482;&#21019;&#24314;&#38750;&#24120;&#31616;
&#21333;&#30340;&#25277;&#35937;&#36793;&#30028;&#12290;&#20960;&#31181;&#27969;&#34892;&#35821;&#35328;&#20351;&#29992;&#19982;&#20043;&#31867;&#20284;&#30340;&#27169;&#22359;&#31995;&#32479;&#12290;</p><h5>8.1.1<tt>&nbsp;</tt><a name="(part._s8..1..1)"></a>&#20363;&#23376;</h5><p>&#35774;&#24819;&#19968;&#20010;&#36719;&#20214;&#39033;&#30446;&#20013;&#26377;&#19977;&#21517;&#24320;&#21457;&#32773;&#65306;&#29233;&#20029;&#19997;&#12289;&#40077;&#20271;&#21644;&#26597;&#29702;&#12290;&#29233;&#20029;&#19997;&#12289;&#40077;&#20271;&#21644;&#26597;&#29702;&#27491;&#22312;&#24320;&#21457;&#39033;
&#30446;&#20013;&#30456;&#23545;&#29420;&#31435;&#30340;&#20960;&#37096;&#20998;&#12290;&#36825;&#20123;&#24320;&#21457;&#32773;&#25955;&#23621;&#21508;&#22320;&#65292;&#26102;&#21306;&#37117;&#21487;&#33021;&#19981;&#21516;&#12290;&#39033;&#30446;&#30340;&#27599;&#37096;&#20998;&#37117;&#35201;&#23454;&#29616;&#19968;
&#22871;<a href="da.html#%28part._s2..1%29" data-pltdoc="x">&#29992;&#25509;&#21475;&#23450;&#20041;&#25968;&#25454;</a>&#37027;&#26679;&#30340;&#25509;&#21475;&#65292;&#20294;&#25509;&#21475;&#30340;&#23454;&#29616;&#21487;&#33021;&#28041;&#21450;&#22823;&#37327;&#20854;&#20182;&#36807;&#31243;&#12290;&#32780;&#19988;&#65292;&#24403;&#21508;&#37096;&#20998;&#38598;&#25104;
&#21040;&#19968;&#36215;&#26102;&#65292;&#24320;&#21457;&#32773;&#38656;&#35201;&#30830;&#20445;&#19981;&#23384;&#22312;&#24178;&#25200;&#39033;&#30446;&#20854;&#20182;&#37096;&#20998;&#30340;&#21629;&#21517;&#20914;&#31361;&#12290;</p><p>&#35201;&#23454;&#29616;&#36825;&#19968;&#30446;&#26631;&#65292;&#24320;&#21457;&#32773;&#20204;&#38656;&#35201;&#20844;&#24067;&#19968;&#22871;&#25509;&#21475;&#65292;&#21015;&#20986;&#27599;&#20010;&#20379;&#20182;&#20154;&#20351;&#29992;&#30340;&#36807;&#31243;&#21517;&#23383;&#12290;&#27169;&#22359;&#31995;&#32479;
&#35201;&#20445;&#35777;&#36825;&#20123;&#21517;&#23383;&#26159;&#20844;&#24320;&#30340;&#65292;&#32780;&#23427;&#20204;&#20351;&#29992;&#30340;&#20854;&#20182;&#21517;&#23383;&#21017;&#26159;&#31169;&#26377;&#30340;&#65292;&#19988;&#19981;&#20250;&#34987;&#39033;&#30446;&#20013;&#30340;&#20854;&#20182;&#20195;&#30721;
&#20462;&#25913;&#12290;</p><p>&#25105;&#20204;&#21487;&#20197;&#29992;<a href="expr.html" data-pltdoc="x">&#34920;&#36798;&#24335;</a>&#20013;&#30340;&#23450;&#30028;&#25216;&#26415;&#65292;&#20294;&#36825;&#20123;&#26080;&#27861;&#24212;&#23545;&#26356;&#22823;&#30340;&#24037;&#31243;&#12290;&#30456;&#21453;&#65292;&#25105;&#20204;&#20351;&#29992;&#27169;
&#22359;&#31995;&#32479;&#12290;&#24320;&#21457;&#32773;&#20204;&#21508;&#35774;&#35745;&#19968;&#20010;&#27169;&#22359;&#65292;&#21253;&#21547;&#20844;&#24320;&#25509;&#21475;&#21644;&#31169;&#26377;&#23454;&#29616;&#12290;&#20182;&#20204;&#33021;&#30475;&#21040;&#33258;&#24049;&#27169;&#22359;&#30340;&#25509;&#21475;
&#21644;&#23454;&#29616;&#65292;&#20294;&#29233;&#20029;&#19997;&#21482;&#33021;&#30475;&#21040;&#20182;&#20154;&#27169;&#22359;&#30340;&#25509;&#21475;&#12290;&#22905;&#30340;&#25152;&#20570;&#25152;&#20026;&#19981;&#20250;&#24433;&#21709;&#20854;&#20182;&#27169;&#22359;&#30340;&#23454;&#29616;&#65292;&#20854;&#20182;
&#27169;&#22359;&#30340;&#23454;&#29616;&#20063;&#19981;&#20250;&#24433;&#21709;&#22905;&#30340;&#65288;&#22914;<span class="EoplFigureRef"></span> &#25152;&#31034;&#65289;&#12290;</p><p>&#36825;&#37324;&#26159; SIMPLE-MODULES &#30340;&#31616;&#30701;&#20363;&#23376;&#12290;</p><blockquote class="EoplExample"><p><div class="SIntrapara"><a name="(elem._eg-8..1)"></a></div><div class="SIntrapara"><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[a : int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">b : int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">c : int]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[a = 33</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">x = -(a,1)</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">% = 32</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">b = -(a,x)</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">% = 1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">c = -(x,b)] % = 31</span></p></td></tr><tr><td><p><span class="stt">let a = 10</span></p></td></tr><tr><td><p><span class="stt">in -(-(from m1 take a,</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">from m1 take b),</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">a)</span></p></td></tr></table></blockquote><p>&#31867;&#22411;&#20026; <span class="stt">int</span>&#65292;&#20540;&#20026; <span class="texMathInline">((33-1)-10)=22</span>&#12290;</p></blockquote></div></p></blockquote><blockquote class="EoplFigure"><p><div class="SIntrapara">[!t]</div><div class="SIntrapara"><blockquote class="SCentered"><p><img src="alice-view.svg" alt="项目中，爱丽丝所见的三个模块" width="464.54999999999995pt" height="498.75pt"/></p></blockquote></div></p><blockquote class="caption"><p>&#39033;&#30446;&#20013;&#65292;&#29233;&#20029;&#19997;&#25152;&#35265;&#30340;&#19977;&#20010;&#27169;&#22359;<a name="(elem._fig-8..1)"></a></p></blockquote></blockquote><p><a name="(idx._(gentag._1187))"></a>
<a name="(idx._(gentag._1188))"></a>
<a name="(idx._(gentag._1189))"></a>
&#36825;&#20010;&#31243;&#24207;&#20174;&#21517;&#20026; <span class="stt">m1</span> &#30340;&#27169;&#22359;&#23450;&#20041;&#24320;&#22987;&#12290;&#20687;&#20219;&#20309;&#27169;&#22359;&#19968;&#26679;&#65292;&#23427;&#26377;<span class="emph">&#25509;&#21475;</span>&#21644;<span class="stt">&#20027;&#20307;</span>&#12290;
&#20027;&#20307;<span class="emph">&#23454;&#29616;</span>&#25509;&#21475;&#12290;&#25509;&#21475;<span class="emph">&#22768;&#26126;</span>&#21464;&#37327; <span class="stt">a</span>&#12289;<span class="stt">b</span> &#21644; <span class="stt">c</span>&#12290;&#20027;&#20307;<span class="emph">&#23450;
&#20041;</span>&#20102; <span class="stt">a</span>&#12289;<span class="stt">x</span>&#12289;<span class="stt">b</span> &#21644; <span class="stt">c</span> &#30340;&#32465;&#23450;&#12290;
<a name="(idx._(gentag._1190))"></a></p><p>&#24403;&#25105;&#20204;&#27714;&#31243;&#24207;&#30340;&#20540;&#26102;&#65292;&#20063;&#20250;&#27714;&#20986; <span class="stt">m1</span> &#20027;&#20307;&#20013;&#34920;&#36798;&#24335;&#30340;&#20540;&#12290;&#21464;&#37327; <span class="stt">from m1 take a</span>&#12289;
<span class="stt">from m1 take b</span> &#21644; <span class="stt">from m1 take c</span> &#32465;&#23450;&#21040;&#36866;&#24403;&#30340;&#20540;&#65292;&#23427;&#20204;&#30340;&#20316;&#29992;&#22495;&#20026;&#27169;&#22359;&#23450;
&#20041;&#20043;&#21518;&#12290;&#30001;&#20110; <span class="stt">from m1 take x</span> &#26410;&#22312;&#25509;&#21475;&#20013;&#22768;&#26126;&#65292;&#25152;&#20197;&#23427;&#30340;&#20316;&#29992;&#22495;&#19981;&#21253;&#21547;&#27169;&#22359;&#23450;&#20041;&#20043;
&#21518;&#12290;</p><p><a name="(idx._(gentag._1191))"></a>
<a name="(idx._(gentag._1192))"></a>
&#20026;&#20102;&#21516;<span class="emph">&#31616;&#21333;&#21464;&#37327;</span> (<span class="emph">simple variables</span>) &#21306;&#21035;&#65292;&#25105;&#20204;&#31216;&#36825;&#20123;&#26032;&#21464;&#37327;
&#20026;<span class="emph">&#21463;&#38480;&#21464;&#37327;</span> (<span class="emph">qualified variables</span>)&#12290;&#22312;&#19968;&#33324;&#30340;&#35821;&#35328;&#20013;&#65292;&#21463;&#38480;&#21464;&#37327;&#21487;&#33021;&#20889;&#20316;
<span class="stt">m1.a</span>&#12289;<span class="stt">m1:a</span> &#25110; <span class="stt">m1::a</span>&#12290;&#22312;<a href="oac.html" data-pltdoc="x">&#23545;&#35937;&#21644;&#31867;</a>&#25506;&#35752;&#30340;&#38754;&#21521;&#23545;&#35937;&#35821;&#35328;&#20013;&#65292;
<span class="stt">m1.a</span> &#36890;&#24120;&#21478;&#26377;&#21547;&#20041;&#12290;</p><p>&#25105;&#20204;&#35828;&#25509;&#21475;<span class="emph">&#25552;&#20986;</span> (<span class="emph">offer</span>)&#65288;&#25110;&#31216;<span class="emph">&#20844;&#24067;</span> (<span class="emph">advertise</span>)&#65292;
&#25110;&#31216;<span class="emph">&#25215;&#35834;</span> (<span class="emph">promise</span>)&#65289;&#19977;&#20010;&#25972;&#22411;&#20540;&#65292;&#20027;&#20307;<span class="emph">&#25552;
&#20379;</span> (<span class="emph">supply</span>, <span class="emph">provide</span>)&#65288;&#25110;&#31216;<span class="emph">&#36755;&#20986;</span> (<span class="emph">export</span>)&#65289;&#36825;&#20123;&#20540;&#12290;&#24403;&#27169;&#22359;&#20027;&#20307;&#25552;&#20379;&#30340;&#20540;&#31867;&#22411;&#19982;&#25509;&#21475;&#21629;&#21517;&#21464;&#37327;&#26102;&#20844;
&#24067;&#30340;&#31867;&#22411;&#30456;&#31526;&#26102;&#65292;&#20027;&#20307;<span class="emph">&#28385;&#36275;</span>&#20854;&#25509;&#21475;&#12290;</p><p><a name="(idx._(gentag._1193))"></a>
&#22312;&#20027;&#20307;&#20013;&#65292;&#23450;&#20041;&#20855;&#26377; <span class="stt">let*</span> &#37027;&#26679;&#30340;&#20316;&#29992;&#22495;&#65292;&#25152;&#20197; <span class="stt">x</span>&#12289;<span class="stt">b</span> &#21644; <span class="stt">c</span> &#30340;&#23450;&#20041;
&#22312; <span class="stt">a</span> &#30340;&#20316;&#29992;&#22495;&#20869;&#12290;&#19968;&#20123;&#20316;&#29992;&#22495;&#22914;<span class="EoplFigureRef"></span> &#25152;&#31034;&#12290;</p><p><a name="(idx._(gentag._1194))"></a>
&#26412;&#20363;&#20013;&#65292;&#20197; <span class="stt">let a = 10</span> &#24320;&#22836;&#30340;&#34920;&#36798;&#24335;&#26159;<span class="emph">&#31243;&#24207;&#20027;&#20307;</span> (<span class="emph">program body</span>)&#12290;&#23427;&#30340;&#20540;
&#21363;&#31243;&#24207;&#30340;&#20540;&#12290;</p><p><a name="(idx._(gentag._1195))"></a>&#27599;&#20010;&#27169;&#22359;&#37117;&#22312;&#27169;&#22359;&#20027;&#20307;&#21644;&#31243;&#24207;&#20854;&#20313;&#37096;&#20998;&#20043;&#38388;&#24314;&#31435;&#20102;&#25277;
&#35937;&#36793;&#30028;&#12290;&#27169;&#22359;&#20027;&#20307;&#20013;&#30340;&#34920;&#36798;&#24335;&#22312;&#25277;&#35937;&#36793;&#30028;<span class="emph">&#20043;&#20869;</span>&#65292;&#20854;&#20182;&#37096;&#20998;&#22312;&#25277;&#35937;&#36793;&#30028;<span class="emph">&#20043;&#22806;</span>&#12290;
&#27169;&#22359;&#20027;&#20307;&#20063;&#21487;&#20197;&#25552;&#20379;&#19981;&#22312;&#25509;&#21475;&#20013;&#30340;&#21517;&#23383;&#32465;&#23450;&#65292;&#20294;&#37027;&#20123;&#32465;&#23450;&#22312;&#31243;&#24207;&#20027;&#20307;&#21644;&#20854;&#20182;&#27169;&#22359;&#20013;&#19981;&#21487;&#35265;&#65292;
&#27491;&#22914;<span class="EoplFigureRef"></span> &#25152;&#31034;&#12290;&#22312;&#25105;&#20204;&#30340;&#20363;&#23376;&#20013;&#65292;&#31243;&#24207;&#20027;&#20307;&#19981;&#22312; <span class="stt">from m1 take x</span>
&#30340;&#20316;&#29992;&#22495;&#20869;&#12290;&#22914;&#26524;&#25105;&#20204;&#20889; <span class="stt">-(from m1 take a, from m1 take x)</span>&#65292;&#31243;&#24207;&#23601;&#20250;&#31867;&#22411;&#24322;&#24120;&#12290;</p><blockquote class="EoplExample"><p><a name="(elem._eg-8..2)"></a>&#31243;&#24207;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[u : bool]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[u = 33]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">44</span></p></td></tr></table></blockquote><p>&#31867;&#22411;&#24322;&#24120;&#12290;&#21363;&#20351;&#31243;&#24207;&#30340;&#20854;&#20182;&#37096;&#20998;&#19981;&#20351;&#29992;&#37027;&#20123;&#20540;&#65292;&#27169;&#22359;&#20027;&#20307;&#20063;&#35201;&#23558;&#25509;&#21475;&#20013;&#30340;&#21517;&#23383;&#19982;&#36866;&#24403;&#31867;&#22411;&#30340;
&#20540;&#20851;&#32852;&#36215;&#26469;&#12290;</p></blockquote></blockquote><blockquote class="EoplFigure"><p><div class="SIntrapara">[!ht]</div><div class="SIntrapara"><blockquote class="SCentered"><p><img src="module-contour.svg" alt="简单模块中的一些作用域" width="498.0pt" height="402.0pt"/></p></blockquote></div></p><blockquote class="caption"><p>&#31616;&#21333;&#27169;&#22359;&#20013;&#30340;&#19968;&#20123;&#20316;&#29992;&#22495;<a name="(elem._fig-8..2)"></a></p></blockquote></blockquote><blockquote class="EoplExample"><p><a name="(elem._eg-8..3)"></a>&#27169;&#22359;&#20027;&#20307;&#24517;&#39035;&#25552;&#20379;&#25509;&#21475;&#20013;&#22768;&#26126;&#30340;&#25152;&#26377;&#32465;&#23450;&#12290;&#20363;&#22914;&#65292;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[u : int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">v : int]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[u = 33]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">44</span></p></td></tr></table></blockquote><p>&#31867;&#22411;&#24322;&#24120;&#65292;&#22240;&#20026; <span class="stt">m1</span> &#30340;&#20027;&#20307;&#27809;&#26377;&#25552;&#20379;&#25509;&#21475;&#20013;&#20844;&#24067;&#30340;&#25152;&#26377;&#20540;&#12290;</p></blockquote></blockquote><blockquote class="EoplExample"><p><a name="(elem._eg-8..4)"></a>&#20026;&#20102;&#35753;&#23454;&#29616;&#31616;&#21333;&#19968;&#28857;&#65292;&#25105;&#20204;&#30340;&#35821;&#35328;&#35201;&#27714;&#27169;&#22359;&#20027;&#20307;&#25353;&#29031;&#25509;&#21475;&#22768;&#26126;&#30340;&#39034;&#24207;&#32473;&#20986;&#21508;&#20540;&#12290;&#22240;&#27492;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[u : int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">v : int]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[v = 33</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">u = 44]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">from m1 take u</span></p></td></tr></table></blockquote><p>&#31867;&#22411;&#24322;&#24120;&#12290;&#21487;&#20197;&#20813;&#38500;&#36825;&#19968;&#38480;&#21046;&#65288;<span class="EoplExerciseRef"></span>&#12289;<span class="stt">ex8.17</span>&#65289;&#12290;</p></blockquote></blockquote><blockquote class="EoplExample"><p><a name="(elem._eg-8..5)"></a><a name="(idx._(gentag._1196))"></a>
&#22312;&#25105;&#20204;&#30340;&#35821;&#35328;&#20013;&#65292;&#27169;&#22359;&#20855;&#26377; <span class="stt">let*</span> &#24335;&#30340;&#20316;&#29992;&#22495;&#65288;<span class="EoplExerciseRef"></span>&#65289;&#12290;&#20363;&#22914;&#65292;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[u : int]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[u = 44]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">module m2</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[v : int]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[v = -(from m1 take u,11)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">-(from m1 take u, from m2 take v)</span></p></td></tr></table></blockquote><p>&#31867;&#22411;&#20026; <span class="stt">int</span>&#12290;&#20294;&#22914;&#26524;&#25105;&#20204;&#20132;&#25442;&#23450;&#20041;&#30340;&#39034;&#24207;&#65292;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m2</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[v : int]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[v = -(from m1 take u,11)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[u : int]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[u = 44]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">-(from m1 take u, from m2 take v)</span></p></td></tr></table></blockquote><p>&#21017;&#31867;&#22411;&#24322;&#24120;&#65292;&#22240;&#20026; <span class="stt">m2</span> &#20027;&#20307;&#20013;&#20351;&#29992; <span class="stt">from m1 take u</span> &#30340;&#22320;&#26041;&#19981;&#22312;&#21518;&#32773;&#30340;&#20316;&#29992;&#22495;
&#20869;&#12290;</p></blockquote></blockquote><h5>8.1.2<tt>&nbsp;</tt><a name="(part._s8..1..2)"></a>&#23454;&#29616;&#31616;&#21333;&#27169;&#22359;&#31995;&#32479;</h5><h5><a name="(part._s8..1-syntax)"></a>&#35821;&#27861;</h5><p>SIMPLE-MODULES &#30340;&#31243;&#24207;&#21253;&#21547;&#19968;&#20018;&#27169;&#22359;&#23450;&#20041;&#65292;&#28982;&#21518;&#26159;&#19968;&#20010;&#34920;&#36798;&#24335;&#12290;</p><blockquote class="Small"><p><span class="Iidentity">\begin{align*} \mathit{Program} &amp;::= \{\mathit{ModuleDefn}\}^{*} \mathit{Expression} \\[-3pt]
&amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">a-program (m-defs body)</span>}\end{align*}</span></p></blockquote><p>&#27169;&#22359;&#23450;&#20041;&#21253;&#21547;&#21517;&#23383;&#12289;&#25509;&#21475;&#21644;&#20027;&#20307;&#12290;</p><blockquote class="Small"><p><span class="Iidentity">\begin{align*}\mathit{ModuleDefn} &amp;::= <span class="stt">module</span> \ \mathit{Identifier} \ <span class="stt">interface</span> \ \mathit{Iface} \ <span class="stt">body</span> \ \mathit{ModuleBody} \\[-3pt]
 &amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">a-module-definition (m-name expected-iface m-body)</span>}\end{align*}</span></p></blockquote><p>&#31616;&#21333;&#27169;&#22359;&#30340;&#25509;&#21475;&#21253;&#21547;&#20219;&#24847;&#25968;&#37327;&#30340;&#22768;&#26126;&#12290;&#27599;&#20010;&#22768;&#26126;&#25351;&#23450;&#31243;&#24207;&#20013;&#19968;&#20010;&#21464;&#37327;&#30340;&#31867;&#22411;&#12290;
&#25105;&#20204;&#31216;&#20043;&#20026;<span class="emph">&#20540;&#22768;&#26126;</span> (<span class="emph">value declaration</span>)&#65292;&#22240;&#20026;&#35201;&#22768;&#26126;&#30340;&#21464;&#37327;&#34920;&#31034;&#19968;&#20010;&#20540;&#12290;&#22312;&#21518;&#38754;
&#20960;&#33410;&#20013;&#65292;&#25105;&#20204;&#20171;&#32461;&#20854;&#20182;&#31867;&#21035;&#30340;&#25509;&#21475;&#21644;&#22768;&#26126;&#12290;</p><blockquote class="Small"><p><span class="Iidentity">\begin{align*}   \mathit{Iface} &amp;::= <span class="stt">[</span> \{\mathit{Decl}\}^{*} <span class="stt">]</span> \\[-3pt]
&amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">simple-iface (decls)</span>} \\[-5pt]
    \mathit{Decl} &amp;::= \mathit{Identifier} <span class="stt">:</span> \mathit{Type} \\[-3pt]
&amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">val-decl (var-name ty)</span>}\end{align*}</span></p></blockquote><p>&#27169;&#22359;&#20027;&#20307;&#21253;&#21547;&#20219;&#24847;&#25968;&#37327;&#30340;&#23450;&#20041;&#12290;&#27599;&#20010;&#23450;&#20041;&#23558;&#21464;&#37327;&#21644;&#26576;&#20010;&#34920;&#36798;&#24335;&#30340;&#20540;&#20851;&#32852;&#36215;&#26469;&#12290;</p><blockquote class="Small"><p><span class="Iidentity">\begin{align*}\mathit{ModuleBody} &amp;::= <span class="stt">[</span> \{\mathit{Defn}\}^{*} <span class="stt">]</span> \\[-3pt]
  &amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">defns-module-body (defns)</span>} \\[-5pt]
      \mathit{Defn} &amp;::= \mathit{Identifier} <span class="stt">=</span> \mathit{Expression} \\[-3pt]
  &amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">val-defn (var-name exp)</span>}\end{align*}</span></p></blockquote><p>&#25105;&#20204;&#30340;&#34920;&#36798;&#24335;&#19982; CHECKED&#65288;<a href="types.html#%28part._s7..3%29" data-pltdoc="x">CHECKED&#65306;&#24102;&#26377;&#31867;&#22411;&#26816;&#26597;&#30340;&#35821;&#35328;</a>&#65289;&#30456;&#21516;&#65292;&#20294;&#25105;&#20204;&#35201;&#20462;&#25913;&#35821;&#27861;&#65292;&#26032;&#22686;&#19968;&#31181;&#34920;&#36798;&#24335;&#65292;
&#20197;&#20415;&#20351;&#29992;&#21463;&#38480;&#21464;&#37327;&#12290;</p><blockquote class="Small"><p><span class="Iidentity">\begin{align*}\mathit{Expression} &amp;::= <span class="stt">from</span> \mathit{Identifier} <span class="stt">take</span> \mathit{Identifier} \\[-3pt]
  &amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">qualified-var-exp (m-name var-name)</span>}\end{align*}</span></p></blockquote><h5><a name="(part._s8..1-the-interpreter)"></a>&#35299;&#37322;&#22120;</h5><p><a name="(idx._(gentag._1197))"></a>
&#27714;&#27169;&#22359;&#20027;&#20307;&#30340;&#20540;&#20250;&#24471;&#21040;&#19968;&#20010;<span class="emph">&#27169;&#22359;</span>&#12290;&#22312;&#25105;&#20204;&#30340;&#31616;&#21333;&#27169;&#22359;&#35821;&#35328;&#20013;&#65292;&#27169;&#22359;&#26159;&#19968;&#20010;&#29615;&#22659;&#65292;&#21253;
&#21547;&#27169;&#22359;&#36755;&#20986;&#30340;&#25152;&#26377;&#32465;&#23450;&#12290;&#25105;&#20204;&#29992;&#25968;&#25454;&#31867;&#22411; <span class="stt">typed-module</span> &#34920;&#31034;&#36825;&#20123;&#12290;</p><blockquote class="EoplCodeInset"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define-datatype</span><span class="hspace">&nbsp;</span><span class="RktSym">typed-module</span><span class="hspace">&nbsp;</span><span class="RktSym">typed-module?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-module</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bindings</span><span class="hspace">&nbsp;</span><span class="RktSym">environment?</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote><p>&#25105;&#20204;&#29992;&#19968;&#31181;&#26032;&#30340;&#32465;&#23450;&#22312;&#29615;&#22659;&#20013;&#32465;&#23450;&#27169;&#22359;&#21517;&#65306;</p><blockquote class="EoplCodeInset"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define-datatype</span><span class="hspace">&nbsp;</span><span class="RktSym">environment</span><span class="hspace">&nbsp;</span><span class="RktSym">environment?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">empty-env</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-env</span><span class="hspace">&nbsp;</span><span class="RktSym">...as</span><span class="hspace">&nbsp;</span><span class="RktSym">before...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-env-rec</span><span class="hspace">&nbsp;</span><span class="RktSym">...as</span><span class="hspace">&nbsp;</span><span class="RktSym">before...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-env-with-module</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">symbol?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-val</span><span class="hspace">&nbsp;</span><span class="RktSym">typed-module?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">saved-env</span><span class="hspace">&nbsp;</span><span class="RktSym">environment?</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote><p>&#20363;&#22914;&#65292;&#22914;&#26524;&#25105;&#20204;&#30340;&#31243;&#24207;&#26159;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[a : int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">b : int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">c : int]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[a = 33</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">b = 44</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">c = 55]</span></p></td></tr><tr><td><p><span class="stt">module m2</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[a : int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">b : int]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[a = 66</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">b = 77]</span></p></td></tr><tr><td><p><span class="stt">let z = 99</span></p></td></tr><tr><td><p><span class="stt">in -(z, -(from m1 take a, from m2 take a))</span></p></td></tr></table></blockquote><p>&#37027;&#20040;&#22768;&#26126; <span class="texMathInline">z</span> &#20043;&#21518;&#30340;&#29615;&#22659;&#26159;</p><blockquote class="EoplCodeInset"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:extend-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">z</span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:num-val</span><span class="hspace">&nbsp;</span><span class="RktVal">99</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:extend-env-with-module</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">m2</span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:simple-module</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:extend-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:num-val</span><span class="hspace">&nbsp;</span><span class="RktVal">66</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:extend-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">b</span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:num-val</span><span class="hspace">&nbsp;</span><span class="RktVal">77</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:empty-env</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:extend-env-with-module</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">m1</span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:simple-module</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:extend-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:num-val</span><span class="hspace">&nbsp;</span><span class="RktVal">33</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:extend-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">b</span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:num-val</span><span class="hspace">&nbsp;</span><span class="RktVal">44</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:extend-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">c</span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:num-val</span><span class="hspace">&nbsp;</span><span class="RktVal">55</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:empty-env</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">struct:empty-env</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr></table></blockquote></blockquote><p>&#22312;&#36825;&#20010;&#29615;&#22659;&#20013;&#65292;<span class="stt">m1</span> &#21644; <span class="stt">m2</span> &#21508;&#32465;&#23450;&#21040;&#19968;&#20010;&#31616;&#21333;&#27169;&#22359;&#65292;&#20108;&#32773;&#20998;&#21035;&#21253;&#21547;&#19968;&#20010;&#23567;&#29615;&#22659;&#12290;</p></blockquote><p><a name="(idx._(gentag._1198))"></a>
&#25105;&#20204;&#29992; <span class="stt">lookup-qualified-var-in-env</span> &#27714;&#21463;&#38480;&#21464;&#37327; <span class="stt">from </span><span class="texMathInline">m</span><span class="stt"> take </span><span class="texMathInline">var</span>
&#24341;&#29992;&#30340;&#20540;&#12290;&#23427;&#22312;&#24403;&#21069;&#29615;&#22659;&#20013;&#26597;&#25214;&#27169;&#22359; <span class="texMathInline">m</span>&#65292;&#28982;&#21518;&#22312;&#24471;&#21040;&#30340;&#29615;&#22659;&#20013;&#26597;&#25214; <span class="texMathInline">var</span>&#12290;</p><blockquote class="EoplCodeInset"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">lookup-qualified-var-in-env!</span></span> : <span class="texMathInline">\mathit{Sym} \times \mathit{Sym} \times \mathit{Env} \to \mathit{ExpVal}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">lookup-qualified-var-in-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">var-name</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">m-val</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-module-name-in-env</span><span class="hspace">&nbsp;</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">typed-module</span><span class="hspace">&nbsp;</span><span class="RktSym">m-val</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-module</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bindings</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">apply-env</span><span class="hspace">&nbsp;</span><span class="RktSym">bindings</span><span class="hspace">&nbsp;</span><span class="RktSym">var-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote><p>&#35201;&#27714;&#31243;&#24207;&#30340;&#20540;&#65292;&#25105;&#20204;&#25226;&#25152;&#26377;&#27169;&#22359;&#23450;&#20041;&#21152;&#20837;&#24403;&#21069;&#29615;&#22659;&#20013;&#65292;&#24471;&#21040;&#21021;&#22987;&#29615;&#22659;&#65292;&#28982;&#21518;&#27714;&#31243;&#24207;&#20027;&#20307;&#30340;&#20540;&#12290;
&#36807;&#31243; <span class="stt">add-module-defns-to-env</span> &#36941;&#21382;&#27169;&#22359;&#23450;&#20041;&#65292;&#27714;&#27599;&#20010;&#27169;&#22359;&#23450;&#20041;&#20027;&#20307;&#30340;&#20540;&#65292;&#24182;&#23558;&#24471;&#21040;
&#30340;&#27169;&#22359;&#21152;&#20837;&#24403;&#21069;&#29615;&#22659;&#20013;&#65292;&#22914;<span class="EoplFigureRef"></span> &#25152;&#31034;&#12290;</p><p><a name="(idx._(gentag._1199))"></a>
<a name="(idx._(gentag._1200))"></a>
&#26368;&#21518;&#65292;&#35201;&#27714;&#27169;&#22359;&#20027;&#20307;&#30340;&#20540;&#65292;&#25105;&#20204;&#25353;&#29031; <span class="stt">let*</span> &#24335;&#23450;&#30028;&#65292;&#22312;&#36866;&#24403;&#30340;&#29615;&#22659;&#20869;&#27714;&#27599;&#20010;&#34920;&#36798;&#24335;&#30340;
&#20540;&#65292;&#24471;&#20986;&#19968;&#29615;&#22659;&#12290;&#36807;&#31243; <span class="stt">defns-to-env</span> &#29983;&#25104;&#30340;&#29615;&#22659;&#21482;&#21253;&#21547;&#23450;&#20041; <span class="stt">defns</span> &#20135;&#29983;&#30340;&#32465;
&#23450;&#65288;<span class="EoplFigureRef"></span>&#65289;&#12290;
<a name="(idx._(gentag._1201))"></a></p><blockquote class="EoplFigure"><p><div class="SIntrapara">[!t]</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">value-of-program</span></span> : <span class="texMathInline">\mathit{Program} \to \mathit{ExpVal}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">value-of-program</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pgm</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">program</span><span class="hspace">&nbsp;</span><span class="RktSym">pgm</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-program</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-defns</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">value-of</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add-module-defns-to-env</span><span class="hspace">&nbsp;</span><span class="RktSym">m-defns</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">empty-env</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span style="font-weight: bold"><span class="stt">add-module-defns-to-env</span></span> : <span class="texMathInline">\mathit{Listof(Defn)} \times \mathit{Env} \to \mathit{Env}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">add-module-defns-to-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">null?</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">module-definition</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-module-definition</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">iface</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add-module-defns-to-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-env-with-module</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">m-name</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">value-of-module-body</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="caption"><p>SIMPLE-MODULES &#30340;&#35299;&#37322;&#22120;&#65292;&#31532; 1 &#37096;&#20998;<a name="(elem._fig-8..3)"></a></p></blockquote></div><div class="SIntrapara"><a name="(idx._(gentag._1202))"></a></div></p></blockquote><blockquote class="EoplFigure"><p><div class="SIntrapara">[!ht]</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">value-of-module-body</span></span> : <span class="texMathInline">\mathit{ModuleBody} \times \mathit{Env} \to \mathit{TypedModule}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">value-of-module-body</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-body</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">module-body</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns-module-body</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-module</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns-to-env</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span style="font-weight: bold"><span class="stt">defns-to-env</span></span> : <span class="texMathInline">\mathit{Listof(Defn)} \times \mathit{Env} \to \mathit{Env}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">defns-to-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">null?</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">empty-env</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">definition</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val-defn</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">val</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">value-of</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">new-env</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-env</span><span class="hspace">&nbsp;</span><span class="RktSym">var</span><span class="hspace">&nbsp;</span><span class="RktSym">val</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-env</span><span class="hspace">&nbsp;</span><span class="RktSym">var</span><span class="hspace">&nbsp;</span><span class="RktSym">val</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns-to-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">new-env</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="caption"><p>SIMPLE-MODULES &#30340;&#35299;&#37322;&#22120;&#65292;&#31532; 2 &#37096;&#20998;<a name="(elem._fig-8..4)"></a></p></blockquote></div><div class="SIntrapara"><a name="(idx._(gentag._1203))"></a></div></p></blockquote><h5><a name="(part._s8..1-checker)"></a>&#26816;&#26597;&#22120;</h5><p><a name="(idx._(gentag._1204))"></a>
&#26816;&#26597;&#22120;&#30340;&#24037;&#20316;&#26159;&#30830;&#20445;&#25152;&#26377;&#27169;&#22359;&#20027;&#20307;&#28385;&#36275;&#20854;&#25509;&#21475;&#65292;&#19988;&#25152;&#26377;&#21464;&#37327;&#30340;&#20351;&#29992;&#31526;&#21512;&#20854;&#31867;&#22411;&#12290;</p><p><a name="(idx._(gentag._1205))"></a>
&#25105;&#20204;&#35821;&#35328;&#30340;&#23450;&#30028;&#35268;&#21017;&#24456;&#31616;&#21333;&#65306;&#27169;&#22359;&#36981;&#24490; <span class="stt">let*</span> &#24335;&#23450;&#30028;&#65292;&#20381;&#27425;&#36827;&#20837;&#27169;&#22359;&#36755;&#20986;&#32465;&#23450;&#20013;&#30340;&#21463;
&#38480;&#21464;&#37327;&#30340;&#20316;&#29992;&#22495;&#12290;&#25509;&#21475;&#21578;&#35785;&#25105;&#20204;&#27599;&#20010;&#21463;&#38480;&#21464;&#37327;&#30340;&#31867;&#22411;&#12290;&#22768;&#26126;&#21644;&#23450;&#20041;&#20063;&#37117;&#36981;&#24490; <span class="stt">let*</span> &#24335;
&#23450;&#30028;&#65288;&#22914;<span class="EoplFigureRef"></span>&#65289;&#12290;</p><p>&#23601;&#20687;<a href="types.html" data-pltdoc="x">&#31867;&#22411;</a>&#20013;&#30340;&#26816;&#26597;&#22120;&#37027;&#26679;&#65292;&#25105;&#20204;&#29992;&#31867;&#22411;&#29615;&#22659;&#35760;&#24405;&#19982;&#24403;&#21069;&#20316;&#29992;&#22495;&#20869;&#21508;&#21517;&#23383;&#30340;&#30456;&#20851;&#20449;
&#24687;&#12290;&#22240;&#20026;&#25105;&#20204;&#29616;&#22312;&#26377;&#20102;&#27169;&#22359;&#21517;&#65292;&#25105;&#20204;&#35201;&#22312;&#31867;&#22411;&#29615;&#22659;&#20013;&#32465;&#23450;&#27169;&#22359;&#21517;&#12290;&#27599;&#20010;&#27169;&#22359;&#21517;&#32465;&#23450;&#21040;&#27169;&#22359;&#30340;
&#25509;&#21475;&#65292;&#20316;&#20026;&#20854;&#31867;&#22411;&#12290;</p><blockquote class="EoplCodeInset"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define-datatype</span><span class="hspace">&nbsp;</span><span class="RktSym">type-environment</span><span class="hspace">&nbsp;</span><span class="RktSym">type-environment?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">empty-tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv</span><span class="hspace">&nbsp;</span><span class="emph">...&#21516;&#21069;...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv-with-module</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">symbol?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">interface</span><span class="hspace">&nbsp;</span><span class="RktSym">interface?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">saved-tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">type-environment?</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote><p>&#35201;&#25214;&#20986;&#21463;&#38480;&#21464;&#37327; <span class="stt">from </span><span class="texMathInline">m</span><span class="stt"> take </span><span class="texMathInline">var</span> &#30340;&#31867;&#22411;&#65292;&#25105;&#20204;&#39318;&#20808;&#22312;&#31867;&#22411;&#29615;&#22659;&#20013;&#25214;&#20986;
<span class="texMathInline">m</span>&#65292;&#28982;&#21518;&#22312;&#24471;&#21040;&#30340;&#25509;&#21475;&#20013;&#26597;&#25214; <span class="texMathInline">var</span> &#30340;&#31867;&#22411;&#12290;</p><blockquote class="EoplCodeInset"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">lookup-qualified-var-in-tenv</span></span> : <span class="texMathInline">\mathit{Sym} \times \mathit{Sym} \times \mathit{Tenv} \to \mathit{Type}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">lookup-qualified-var-in-tenv</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">var-name</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-module-name-in-tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">m-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">interface</span><span class="hspace">&nbsp;</span><span class="RktSym">iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decls</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-variable-name-in-decls</span><span class="hspace">&nbsp;</span><span class="RktSym">var-name</span><span class="hspace">&nbsp;</span><span class="RktSym">decls</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote><blockquote class="EoplFigure"><p><div class="SIntrapara">[!t]</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">type-of-program</span></span> : <span class="texMathInline">\mathit{Program} \to \mathit{Type}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">type-of-program</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pgm</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">program</span><span class="hspace">&nbsp;</span><span class="RktSym">pgm</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-program</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">module-defns</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">type-of</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add-module-defns-to-tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">module-defns</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">empty-tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span style="font-weight: bold"><span class="stt">add-module-defns-to-tenv</span></span> : <span class="texMathInline">\mathit{Listof(ModuleDefn)} \times \mathit{Tenv} \to \mathit{Tenv}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">add-module-defns-to-tenv</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">null?</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">tenv</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">module-definition</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-module-definition</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">expected-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">actual-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">interface-of</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;:-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">actual-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">expected-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">new-tenv</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv-with-module</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">m-name</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">expected-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add-module-defns-to-tenv</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">new-tenv</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">report-module-doesnt-satisfy-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">expected-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">actual-iface</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><blockquote class="caption"><p>SIMPLE-MODULES &#30340;&#26816;&#26597;&#22120;&#65292;&#31532; 1 &#37096;&#20998;<a name="(elem._fig-8..5)"></a></p></blockquote></blockquote><p>&#23601;&#20687;<a href="types.html" data-pltdoc="x">&#31867;&#22411;</a>&#37027;&#26679;&#65292;&#23545;&#31243;&#24207;&#20570;&#31867;&#22411;&#26816;&#26597;&#30340;&#36807;&#31243;&#31867;&#27169;&#20223;&#31243;&#24207;&#30340;&#27714;&#20540;&#65292;&#20294;&#25105;&#20204;&#35760;&#24405;&#30340;&#19981;&#26159;
&#20540;&#65292;&#32780;&#26159;&#31867;&#22411;&#12290;&#25105;&#20204;&#29992; <span class="stt">type-of-program</span> &#20195;&#26367; <span class="stt">value-of-program</span>&#65292;&#29992;
<span class="stt">add-module-defns-to-tenv</span> &#20195;&#26367; <span class="stt">add-module-defns-to-env</span>&#12290;&#36807;&#31243;
<span class="stt">add-module-defns-to-tenv</span> &#29992; <span class="stt">&lt;:-iface</span> &#26816;&#26597;&#21508;&#27169;&#22359;&#20027;&#20307;&#20135;&#29983;&#30340;&#25509;&#21475;&#19982;&#25552;&#20986;&#30340;
&#25509;&#21475;&#26159;&#21542;&#30456;&#31526;&#65307;&#22914;&#26524;&#30456;&#31526;&#65292;&#23601;&#23558;&#27169;&#22359;&#21152;&#20837;&#21040;&#31867;&#22411;&#29615;&#22659;&#20013;&#65307;&#21542;&#21017;&#25253;&#38169;&#12290;</p><p><a name="(idx._(gentag._1206))"></a>
&#27169;&#22359;&#20027;&#20307;&#30340;&#25509;&#21475;&#23558;&#20027;&#20307;&#20013;&#23450;&#20041;&#30340;&#21508;&#20010;&#21464;&#37327;&#19982;&#23450;&#20041;&#20013;&#30340;&#31867;&#22411;&#20851;&#32852;&#36215;&#26469;&#12290;&#20363;&#22914;&#65292;&#22914;&#26524;&#25105;&#20204;&#26597;&#30475;&#31532;
&#19968;&#20010;&#20363;&#23376;&#30340;&#20027;&#20307;&#65292;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">[a = 33</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">x = -(a,1)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">b = -(a,x)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">c = -(x,b)]</span></p></td></tr></table></blockquote><p>&#21487;&#24471;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">[a : int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">x : int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">b : int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">c : int]</span></p></td></tr></table></blockquote></blockquote><p>&#19968;&#26086;&#25105;&#20204;&#24314;&#31435;&#20102;&#19968;&#22871;&#25509;&#21475;&#26469;&#25551;&#36848;&#27169;&#22359;&#20027;&#20307;&#36755;&#20986;&#30340;&#25152;&#26377;&#32465;&#23450;&#65292;&#25105;&#20204;&#23601;&#33021;&#23558;&#20854;&#19982;&#27169;&#22359;&#20844;&#24067;&#30340;&#25509;&#21475;
&#27604;&#36739;&#12290;</p><p>&#22238;&#24518;&#19968;&#19979;&#65292;&#31616;&#21333;&#25509;&#21475;&#21253;&#21547;&#19968;&#20010;&#22768;&#26126;&#21015;&#34920;&#12290;&#36807;&#31243; <span class="stt">defns-to-decls</span> &#21019;&#24314;&#36825;&#26679;&#30340;&#21015;&#34920;&#65292;&#35843;
&#29992; <span class="stt">type-of</span> &#25214;&#20986;&#27599;&#20010;&#23450;&#20041;&#30340;&#31867;&#22411;&#12290;&#22312;&#27599;&#19968;&#27493;&#65292;&#23427;&#36824;&#25353; <span class="stt">let*</span> &#23450;&#30028;&#65292;&#25193;&#23637;&#23616;&#37096;&#31867;
&#22411;&#29615;&#22659;&#65288;&#35265;<span class="EoplFigureRef"></span>&#65289;&#12290;</p><p>&#21097;&#19979;&#30340;&#21482;&#26159;&#29992; <span class="stt">&lt;:-iface</span> &#27604;&#36739;&#27599;&#20010;&#27169;&#22359;&#30340;&#26399;&#26395;&#31867;&#22411;&#19982;&#23454;&#38469;&#31867;&#22411;&#12290;&#25105;&#20204;&#23558; <span class="stt">&lt;:</span> &#23450;&#20041;
&#20026;&#65306;&#33509; <span class="texMathInline">i_1 <span class="stt">&lt;:</span> i_2</span>&#65292;&#21017;&#28385;&#36275;&#25509;&#21475; <span class="texMathInline">i_1</span> &#30340;&#20219;&#20309;&#27169;&#22359;&#20063;&#28385;&#36275;&#25509;&#21475; <span class="texMathInline">i_2</span>&#12290;&#20363;&#22914;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">[u : int</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[u : int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">v : int</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&lt;:</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">z : int]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">z : int]</span></p></td></tr></table></blockquote><p>&#22240;&#20026;&#28385;&#36275;&#25509;&#21475; <span class="stt">[u : int v : bool z : int]</span> &#30340;&#20219;&#20309;&#27169;&#22359;&#37117;&#25552;&#20379;&#20102;&#25509;&#21475; <span class="stt">[u : int
z : int]</span> &#20844;&#24067;&#30340;&#25152;&#26377;&#20540;&#12290;</p></blockquote><p>&#23545;&#25105;&#20204;&#30340;&#31616;&#21333;&#27169;&#22359;&#35821;&#35328;&#65292;<span class="stt">&lt;:-iface</span> &#21482;&#38656;&#35843;&#29992; <span class="stt">&lt;:-decls</span> &#27604;&#36739;&#22768;&#26126;&#12290;&#36825;&#20123;&#36807;&#31243;&#21462;
&#19968; <span class="stt">tenv</span> &#21442;&#25968;&#65292;&#31616;&#21333;&#27169;&#22359;&#31995;&#32479;&#19981;&#20351;&#29992;&#23427;&#65292;&#20294;<a href="#%28part._s8..2%29" data-pltdoc="x">&#22768;&#26126;&#31867;&#22411;&#30340;&#27169;&#22359;</a>&#38656;&#35201;&#12290;
&#35265;<span class="EoplFigureRef"></span>&#12290;</p><p>&#36807;&#31243; <span class="stt">&lt;-decls</span> &#25191;&#34892;&#20027;&#35201;&#24037;&#20316;&#65292;&#27604;&#36739;&#20004;&#20010;&#22768;&#26126;&#38598;&#21512;&#12290;&#22914;&#26524; <span class="texMathInline">decls_1</span> &#21644;
<span class="texMathInline">decls_2</span> &#26159;&#20004;&#20010;&#22768;&#26126;&#38598;&#21512;&#65292;&#24403;&#19988;&#20165;&#24403;&#20219;&#20309;&#33021;&#25552;&#20379; <span class="texMathInline">decls_1</span> &#20013;&#22768;&#26126;&#32465;&#23450;&#30340;&#27169;&#22359;&#65292;&#20063;
&#33021;&#25552;&#20379; <span class="texMathInline">decls_2</span> &#20013;&#22768;&#26126;&#30340;&#32465;&#23450;&#26102;&#65292;&#25105;&#20204;&#35828; <span class="texMathInline">decls_1 &lt;: decls_2</span>&#12290;&#22914;&#26524;
<span class="texMathInline">decls_2</span> &#20013;&#30340;&#25152;&#26377;&#22768;&#26126;&#65292;&#22312; <span class="texMathInline">decls_1</span> &#20013;&#37117;&#26377;&#19982;&#20043;&#21305;&#37197;&#30340;&#22768;&#26126;&#65292;&#23601;&#33021;&#20445;&#35777;&#36825;&#19968;&#28857;&#65292;
&#23601;&#20687;&#19978;&#38754;&#30340;&#20363;&#23376;&#37027;&#26679;&#12290;</p><blockquote class="EoplFigure"><p><div class="SIntrapara">[!t]</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">interface-of</span></span> : <span class="texMathInline">\mathit{ModuleBody} \times \mathit{Tenv} \to \mathit{Iface}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">interface-of</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-body</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">module-body</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns-module-body</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns-to-decls</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span style="font-weight: bold"><span class="stt">defns-to-decls</span></span> : <span class="texMathInline">\mathit{Listof(Defn)} \times \mathit{Tenv} \to \mathit{Decl}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">defns-to-decls</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">null?</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">definition</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val-defn</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var-name</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">ty</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">type-of</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val-decl</span><span class="hspace">&nbsp;</span><span class="RktSym">var-name</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns-to-decls</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">var-name</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><blockquote class="caption"><p>SIMPLE-MODULES &#30340;&#26816;&#26597;&#22120;&#65292;&#31532; 2 &#37096;&#20998;<a name="(elem._fig-8..6)"></a></p></blockquote></blockquote><p>&#36807;&#31243; <span class="stt">&lt;:-decls</span> &#39318;&#20808;&#26816;&#26597; <span class="stt">decls1</span> &#21644; <span class="stt">decls2</span>&#12290;&#33509; <span class="stt">decls2</span> &#20026;&#31354;&#65292;&#37027;
&#20040;&#23427;&#23545; <span class="stt">decls1</span> &#26080;&#25152;&#35201;&#27714;&#65292;&#25152;&#20197;&#32467;&#26524;&#20026; <span class="stt">#t</span>&#12290;&#33509; <span class="stt">decls2</span> &#38750;&#31354;&#65292;&#20294;
<span class="stt">decls1</span> &#20026;&#31354;&#65292;&#37027;&#20040; <span class="stt">decls2</span> &#26377;&#25152;&#35201;&#27714;&#65292;&#20294; <span class="stt">decls1</span> &#26080;&#21487;&#25552;&#20379;&#65292;&#25152;&#20197;&#32467;&#26524;&#20026;
<span class="stt">#f</span>&#12290;&#21542;&#21017;&#65292;&#25105;&#20204;&#27604;&#36739; <span class="stt">decls1</span> &#21644; <span class="stt">decls2</span> &#22768;&#26126;&#30340;&#31532;&#19968;&#23545;&#21464;&#37327;&#30340;&#21517;&#23383;&#65307;&#33509;&#20108;
&#32773;&#30456;&#21516;&#65292;&#37027;&#20040;&#23427;&#20204;&#30340;&#31867;&#22411;&#24517;&#39035;&#21305;&#37197;&#65292;&#28982;&#21518;&#25105;&#20204;&#36882;&#24402;&#22788;&#29702;&#20004;&#20010;&#22768;&#26126;&#21015;&#34920;&#20313;&#19979;&#30340;&#37096;&#20998;&#65307;&#33509;&#20182;&#20204;&#19981;
&#21516;&#65292;&#37027;&#20040;&#25105;&#20204;&#36882;&#24402;&#22788;&#29702; <span class="stt">decls1</span> &#30340; <span class="stt">cdr</span>&#65292;&#25214;&#20986;&#21305;&#37197; <span class="stt">decls2</span> &#20013;&#31532;&#19968;&#20010;&#22768;&#26126;
&#30340;&#20869;&#23481;&#12290;</p><p>&#36825;&#26679;&#65292;&#31616;&#21333;&#27169;&#22359;&#31995;&#32479;&#23601;&#23436;&#25104;&#20102;&#12290;
<a name="(idx._(gentag._1207))"></a>
<a name="(idx._(gentag._1208))"></a>
<a name="(idx._(gentag._1209))"></a>
<a name="(idx._(gentag._1210))"></a></p><blockquote class="EoplFigure"><p><div class="SIntrapara">[!ht]</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">&lt;:-iface</span></span> : <span class="texMathInline">\mathit{Iface} \times \mathit{Iface} \times \mathit{Tenv} \to \mathit{Bool}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;:-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">iface1</span><span class="hspace">&nbsp;</span><span class="RktSym">iface2</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">interface</span><span class="hspace">&nbsp;</span><span class="RktSym">iface1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decls1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">interface</span><span class="hspace">&nbsp;</span><span class="RktSym">iface2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decls2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;:-decls</span><span class="hspace">&nbsp;</span><span class="RktSym">decls1</span><span class="hspace">&nbsp;</span><span class="RktSym">decls2</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span style="font-weight: bold"><span class="stt">&lt;:-decls</span></span> : <span class="texMathInline">\mathit{Listof(Decl)} \times \mathit{Listof(Decl)} \times \mathit{Tenv} \to \mathit{Bool}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;:-decls</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decls1</span><span class="hspace">&nbsp;</span><span class="RktSym">decls2</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cond</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">null?</span><span class="hspace">&nbsp;</span><span class="RktSym">decls2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">null?</span><span class="hspace">&nbsp;</span><span class="RktSym">decls1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">else</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">name1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decl-&gt;name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">decls1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decl-&gt;name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">decls2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eqv?</span><span class="hspace">&nbsp;</span><span class="RktSym">name1</span><span class="hspace">&nbsp;</span><span class="RktSym">name2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">and</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">equal?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decl-&gt;type</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">decls1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decl-&gt;type</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">decls2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;:-decls</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">decls1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">decls2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;:-decls</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">decls1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">decls2</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><blockquote class="caption"><p>SIMPLE-MODULES &#30340;&#25509;&#21475;&#27604;&#36739;<a name="(elem._fig-8..7)"></a></p></blockquote></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..1)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#20462;&#25913;&#26816;&#26597;&#22120;&#65292;&#26816;&#27979;&#24182;&#25298;&#32477;&#20219;&#20309;&#23450;&#20041;&#20004;&#20010;&#21516;&#21517;&#27169;&#22359;&#30340;&#31243;&#24207;&#12290;</p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..2)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#36807;&#31243; <span class="stt">add-module-defns-to-env</span> &#19981;&#23436;&#20840;&#27491;&#30830;&#65292;&#22240;&#20026;&#23427;&#21152;&#20837;&#20102;&#27169;&#22359;&#23450;&#20041;&#30340;&#25152;&#26377;&#20540;&#65292;&#32780;&#19981;
&#21482;&#26159;&#25509;&#21475;&#20013;&#30340;&#20540;&#12290;&#20462;&#25913; <span class="stt">add-module-defns-to-env</span>&#65292;&#21482;&#21152;&#20837;&#25509;&#21475;&#20013;&#22768;&#26126;&#30340;&#20540;&#12290;
<span class="stt">add-module-defns-to-tenv</span> &#20063;&#26377;&#27492;&#38382;&#39064;&#21527;&#65311;</p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..3)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#20462;&#25913;&#35821;&#35328;&#30340;&#35821;&#27861;&#65292;&#20197; <span class="stt">m.v</span> &#20195;&#26367; <span class="stt">from m take v</span> &#20351;&#29992;&#21463;&#38480;&#21464;&#37327;&#12290;</p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..4)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span><a name="(idx._(gentag._1211))"></a>
<a name="(idx._(gentag._1212))"></a>
<a name="(idx._(gentag._1213))"></a>
&#20462;&#25913;&#35821;&#35328;&#30340;&#34920;&#36798;&#24335;&#65292;&#20687;<span class="EoplExerciseRef"></span> &#37027;&#26679;&#65292;&#21152;&#20837;&#22810;&#22768;&#26126; <span class="stt">let</span>&#12289;&#22810;&#21442;&#25968;&#36807;&#31243;
&#21644;&#22810;&#22768;&#26126; <span class="stt">letrec</span>&#12290;
<a name="(idx._(gentag._1214))"></a>
<a name="(idx._(gentag._1215))"></a>
<a name="(idx._(gentag._1216))"></a></p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..5)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#20801;&#35768;&#22312;&#27169;&#22359;&#20027;&#20307;&#20013;&#20351;&#29992; <span class="stt">let</span> &#21644; <span class="stt">letrec</span> &#22768;&#26126;&#12290;&#20363;&#22914;&#65292;&#21487;&#20197;&#20889;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module even-odd</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[even : (int -&gt; bool)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">odd</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">: (int -&gt; bool)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">letrec</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">bool local-odd (x : int)</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">= ... (local-even -(x,1)) ...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">bool local-even (x : int) = ... (local-odd -(x,1)) ...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">in [even = local-even</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">odd = local-odd]</span></p></td></tr></table></blockquote></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..6)"></a><span class="texMathInline">\textnormal{[}{\star}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#20801;&#35768;&#22312;&#27169;&#22359;&#20027;&#20307;&#20013;&#23450;&#20041;&#23616;&#37096;&#27169;&#22359;&#12290;&#20363;&#22914;&#65292;&#21487;&#20197;&#20889;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[u : int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">v : int]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">module m2</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">interface [v : int]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">body [v = 33]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[u = 44</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">v = -(from m2 take v, 1)]</span></p></td></tr></table></blockquote></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..7)"></a><span class="texMathInline">\textnormal{[}{\star}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#25193;&#23637;&#21069;&#19968;&#39064;&#30340;&#35299;&#31572;&#65292;&#20801;&#35768;&#27169;&#22359;&#23558;&#20854;&#20182;&#27169;&#22359;&#20316;&#20026;&#36755;&#20986;&#30340;&#19968;&#37096;&#20998;&#12290;&#20363;&#22914;&#65292;&#21487;&#20197;&#20889;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[u : int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">n : [v : int]]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">module m2</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">interface [v : int]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">body [v = 33]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[u = 44</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">n = m2]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">from m1 take n take v</span></p></td></tr></table></blockquote></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..8)"></a><span class="texMathInline">\textnormal{[}{\star}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#22312;&#25105;&#20204;&#30340;&#35821;&#35328;&#20013;&#65292;&#27169;&#22359;&#24517;&#39035;&#25353;&#29031;&#25509;&#21475;&#20013;&#30340;&#39034;&#24207;&#20135;&#29983;&#20540;&#65292;&#21487;&#20197;&#21462;&#28040;&#36825;&#31181;&#38480;&#21046;&#12290;&#21462;&#28040;&#23427;&#12290;</p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..9)"></a><span class="texMathInline">\textnormal{[}{\star}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#25105;&#20204;&#35828;&#25105;&#20204;&#30340;&#27169;&#22359;&#31995;&#32479;&#24212;&#24403;&#33021;&#35299;&#37322;&#27169;&#22359;&#20043;&#38388;&#30340;&#20381;&#36182;&#20851;&#31995;&#12290;&#32473; SIMPLE-MODULES &#28155;&#21152;&#36825;&#31181;&#33021;&#21147;&#65292;
&#22312;&#27169;&#22359;&#20027;&#20307;&#21644;&#31243;&#24207;&#20027;&#20307;&#20013;&#28155;&#21152;&#19968;&#26465; <span class="stt">depends-on</span> &#35821;&#21477;&#12290;&#37027;&#20040;&#65292;&#27169;&#22359; <span class="stt">m</span> &#19981;&#26159;&#22312;&#20043;
&#21069;&#22768;&#26126;&#30340;&#25152;&#26377;&#27169;&#22359;&#30340;&#20316;&#29992;&#22495;&#20013;&#65292;&#32780;&#26159;&#22312;&#33258;&#36523; <span class="stt">depends-on</span> &#35821;&#21477;&#20013;&#21015;&#20986;&#27169;&#22359;&#30340;&#20316;&#29992;&#22495;&#20013;&#12290;
&#20363;&#22914;&#65292;&#32771;&#34385;&#31243;&#24207;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1 ...</span></p></td></tr><tr><td><p><span class="stt">module m2 ...</span></p></td></tr><tr><td><p><span class="stt">module m3 ...</span></p></td></tr><tr><td><p><span class="stt">module m4 ...</span></p></td></tr><tr><td><p><span class="stt">module m5</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface [...]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">depends-on m1, m3</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[...]</span></p></td></tr></table></blockquote><p><span class="stt">m5</span> &#30340;&#20027;&#20307;&#20165;&#22312;&#26469;&#33258; <span class="stt">m1</span> &#25110; <span class="stt">m3</span> &#30340;&#21463;&#38480;&#21464;&#37327;&#30340;&#20316;&#29992;&#22495;&#20013;&#12290;&#21363;&#20351; <span class="stt">m4</span> &#36755;
&#20986;&#20102; <span class="stt">x</span> &#30340;&#20540;&#65292;&#20351;&#29992; <span class="stt">from m4 take x</span> &#20063;&#23558;&#36896;&#25104;&#31867;&#22411;&#24322;&#24120;&#12290;</p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..10)"></a><span class="texMathInline">\textnormal{[}{\star}{\star}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#25105;&#20204;&#36824;&#21487;&#20197;&#29992; <span class="stt">depends-on</span> &#36825;&#26679;&#30340;&#29305;&#24615;&#25511;&#21046;&#27169;&#22359;&#20027;&#20307;&#27714;&#20540;&#30340;&#26102;&#26426;&#12290;&#32473; SIMPLE-MODULES
&#22686;&#21152;&#36825;&#31181;&#33021;&#21147;&#65292;&#22312;&#21508;&#27169;&#22359;&#20027;&#20307;&#21644;&#31243;&#24207;&#20027;&#20307;&#28155;&#21152;&#19968;&#26465; <span class="stt">imports</span> &#35821;&#21477;&#12290;<span class="stt">imports</span> &#23601;
&#20687; <span class="stt">depends-on</span>&#65292;&#19981;&#21516;&#20043;&#22788;&#26159;&#65292;&#20165;&#24403;&#65288;&#29992; <span class="stt">imports</span> &#35821;&#21477;&#65289;&#23558;&#27169;&#22359;&#36755;&#20837;&#21040;&#20854;&#20182;&#27169;&#22359;
&#26102;&#65292;&#25165;&#27714;&#20854;&#20027;&#20307;&#30340;&#20540;&#12290;</p><p>&#36825;&#26679;&#65292;&#22914;&#26524;&#25105;&#20204;&#30340;&#35821;&#35328;&#26377;&#25171;&#21360;&#34920;&#36798;&#24335;&#65292;&#31243;&#24207;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface [] body [x = print(1)]</span></p></td></tr><tr><td><p><span class="stt">module m2</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface [] body [x = print(2)]</span></p></td></tr><tr><td><p><span class="stt">module m3</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface []</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">import m2</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[x = print(3)]</span></p></td></tr><tr><td><p><span class="stt">import m3, m1</span></p></td></tr><tr><td><p><span class="stt">33</span></p></td></tr></table></blockquote><p>&#22312;&#36820;&#22238; 33 &#20043;&#21069;&#65292;&#23558;&#25171;&#21360; 2&#12289;3 &#21644; 1&#12290;&#36825;&#37324;&#30340;&#27169;&#22359;&#25509;&#21475;&#20026;&#31354;&#65292;&#22240;&#20026;&#25105;&#20204;&#21482;&#20851;&#24515;&#23427;&#20204;&#20027;&#20307;&#27714;&#20540;
&#30340;&#39034;&#24207;&#12290;</p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..11)"></a><span class="texMathInline">\textnormal{[}{\star}{\star}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span><a name="(idx._(gentag._1217))"></a>
&#20462;&#25913;&#26816;&#26597;&#22120;&#65292;&#29992; INFERRED &#20316;&#20026;&#35821;&#35328;&#30340;&#34920;&#36798;&#24335;&#12290;&#36825;&#36947;&#32451;&#20064;&#20013;&#65292;&#20320;&#38656;&#35201;&#20462;&#25913; <span class="stt">&lt;:-decls</span>&#65292;
&#19981;&#33021;&#29992; <span class="stt">equal?</span> &#27604;&#36739;&#31867;&#22411;&#12290;&#20363;&#22914;&#65292;&#22312;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface [f : (int -&gt; int)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body [f = proc (x : ?) x]</span></p></td></tr></table></blockquote><p>&#20013;&#65292;&#31867;&#22411;&#25512;&#23548;&#22120;&#25253;&#21578;&#30340; <span class="stt">f</span> &#23454;&#38469;&#31867;&#22411;&#21487;&#33021;&#26159; <span class="stt">(tvar07 -&gt; tvar07)</span>&#65292;&#36825;&#24212;&#24403;&#25509;&#21463;&#12290;
&#20294;&#26159;&#65292;&#25105;&#20204;&#24212;&#25298;&#32477;&#27169;&#22359;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface [f : (int -&gt; bool)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body [f = proc (x : ?) x]</span></p></td></tr></table></blockquote><p>&#21363;&#20351;&#31867;&#22411;&#25512;&#23548;&#22120;&#25253;&#21578;&#30340;&#31867;&#22411;&#20173;&#20026; <span class="stt">(tvar07 -&gt; tvar07)</span>&#12290;
<a name="(idx._(gentag._1218))"></a></p></blockquote><h4>8.2<tt>&nbsp;</tt><a name="(part._s8..2)"></a>&#22768;&#26126;&#31867;&#22411;&#30340;&#27169;&#22359;</h4><p><a name="(idx._(gentag._1219))"></a>
<a name="(idx._(gentag._1220))"></a>&#33267;&#20170;&#20026;&#27490;&#65292;&#25105;&#20204;&#30340;&#25509;&#21475;&#21482;&#22768;&#26126;&#20102;&#26222;&#36890;&#21464;&#37327;&#21450;&#20854;&#31867;&#22411;&#12290;&#22312;&#19979;&#38754;&#36825;
&#31181;&#27169;&#22359;&#35821;&#35328; OPAQUE-TYPES &#20013;&#65292;&#25105;&#20204;&#36824;&#20801;&#35768;&#25509;&#21475;&#22768;&#26126;&#31867;&#22411;&#12290;&#20363;&#22914;&#65292;&#22312;&#23450;&#20041;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">zero : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">succ : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">pred : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">is-zero : (t -&gt; bool)]</span></p></td></tr><tr><td><p><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">...</span></p></td></tr></table></blockquote><p><a name="(idx._(gentag._1221))"></a>
&#20013;&#65292;&#25509;&#21475;&#22768;&#26126;&#20102;&#31867;&#22411; <span class="stt">t</span>&#65292;&#20197;&#21450;&#35813;&#31867;&#22411;&#20540;&#30340;&#25805;&#20316; <span class="stt">zero</span>&#12289;<span class="stt">succ</span>&#12289;<span class="stt">pred</span> &#21644;
<span class="stt">is-zero</span>&#12290;&#22914;&#21516;<a href="da.html#%28part._s2..1%29" data-pltdoc="x">&#29992;&#25509;&#21475;&#23450;&#20041;&#25968;&#25454;</a>&#65292;&#36825;&#22871;&#25509;&#21475;&#21487;&#33021;&#19982;&#31639;&#26415;&#25805;&#20316;&#30340;&#23454;&#29616;&#30456;&#20851;&#12290;&#36825;&#37324;&#30340;&#22768;&#26126;
<span class="stt">t</span> &#20026;<span class="emph">&#27169;&#31946;&#31867;&#22411;</span> (<span class="emph">opaque type</span>)&#65292;&#24847;&#20026;&#65292;&#27169;&#22359;&#20043;&#22806;&#30340;&#20195;&#30721;&#19981;&#30693;&#36947;&#36825;&#31181;&#31867;&#22411;&#30340;&#20540;
&#22914;&#20309;&#34920;&#31034;&#12290;&#25152;&#26377;&#30340;&#22806;&#37096;&#20195;&#30721;&#37117;&#30693;&#36947;&#21487;&#20197;&#29992; <span class="stt">from m1 take zero</span> &#21644; <span class="stt">from m1 take
succ</span> &#31561;&#36807;&#31243;&#22788;&#29702; <span class="stt">from m1 take t</span> &#31867;&#22411;&#30340;&#20540;&#12290;&#36825;&#26679;&#65292;<span class="stt">from m1 take t</span> &#30340;&#34920;&#29616;
&#23601;&#20687; <span class="stt">int</span> &#21644; <span class="stt">bool</span> &#20043;&#31867;&#30340;&#21407;&#29983;&#31867;&#22411;&#19968;&#26679;&#12290;</p></blockquote><p><a name="(idx._(gentag._1222))"></a>
<a name="(idx._(gentag._1223))"></a>
<a name="(idx._(gentag._1224))"></a>
&#25105;&#20204;&#23558;&#20171;&#32461;&#20004;&#31181;&#31867;&#22411;&#22768;&#26126;&#65306;<span class="emph">&#36879;&#26126;</span> (<span class="emph">transparent</span>) &#31867;&#22411;&#21644;<span class="emph">&#27169;&#31946;</span> (<span class="emph">opaque</span>)
&#31867;&#22411;&#12290;&#22909;&#30340;&#27169;&#22359;&#31995;&#32479;&#20013;&#65292;&#20108;&#32773;&#32570;&#19968;&#19981;&#21487;&#12290;</p><h5>8.2.1<tt>&nbsp;</tt><a name="(part._s8..2..1)"></a>&#20363;&#23376;</h5><p>&#27442;&#30693;&#20854;&#29992;&#36884;&#65292;&#20877;&#24819;&#24819;&#25105;&#20204;&#30340;&#20960;&#20301;&#24320;&#21457;&#32773;&#12290;&#29233;&#20029;&#19997;&#19968;&#30452;&#29992;&#21253;&#21547;&#25972;&#25968;&#23545;&#30340;&#25968;&#25454;&#32467;&#26500;&#34920;&#31034;&#28857;&#30340;&#27178;&#32437;
&#22352;&#26631;&#12290;&#22905;&#20351;&#29992;&#30340;&#35821;&#35328;&#20855;&#26377;<span class="EoplExerciseRef"></span> &#37027;&#26679;&#30340;&#31867;&#22411;&#65292;&#25152;&#20197;&#22905;&#30340;&#27169;&#22359;
<span class="stt">Alices-points</span> &#25509;&#21475;&#20855;&#26377;&#22914;&#19979;&#22768;&#26126;&#65306;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">initial-point : (int -&gt; pairof int * int)</span></p></td></tr><tr><td><p><span class="stt">increment-x : (pairof int * int -&gt; pairof int * int)</span></p></td></tr></table></blockquote><p>&#40077;&#20271;&#21644;&#26597;&#29702;&#23545;&#27492;&#30452;&#21457;&#29282;&#39578;&#12290;&#20182;&#20204;&#19981;&#24819;&#19968;&#36941;&#21448;&#19968;&#36941;&#22320;&#20889; <span class="stt">pairof int * int</span>&#12290;&#22240;&#27492;&#65292;&#29233;&#20029;
&#19997;&#29992;&#36879;&#26126;&#31867;&#22411;&#22768;&#26126;&#37325;&#20889;&#22905;&#30340;&#25509;&#21475;&#12290;&#36825;&#26679;&#65292;&#22905;&#21487;&#20197;&#20889;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module Alices-points</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[transparent point = pairof int * int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">initial-point : (int -&gt; point)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">increment-x : (point -&gt; point)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">get-x : (point -&gt; int)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">...]</span></p></td></tr></table></blockquote><p>&#36825;&#20943;&#36731;&#20102;&#22905;&#30340;&#24037;&#20316;&#65292;&#22240;&#20026;&#22905;&#20889;&#24471;&#26356;&#23569;&#65307;&#36825;&#20063;&#20943;&#36731;&#20102;&#22905;&#21512;&#20316;&#32773;&#30340;&#24037;&#20316;&#65292;&#22240;&#20026;&#20182;&#20204;&#22312;&#23454;&#29616;&#20013;&#21487;&#20197;
&#20889;&#36825;&#26679;&#30340;&#23450;&#20041;&#65306;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">[transparent point = from Alices-points take point</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">foo = proc (p1 : point)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">proc (p2 : point) ...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">...]</span></p></td></tr></table></blockquote><p>&#23545;&#26576;&#20123;&#39033;&#30446;&#20013;&#65292;&#36825;&#24456;&#19981;&#38169;&#12290;&#19981;&#36807;&#65292;&#29233;&#20029;&#19997;&#30340;&#39033;&#30446;&#27491;&#22909;&#35201;&#34920;&#31034;&#22266;&#23450;&#24418;&#29366;&#37329;&#23646;&#23548;&#36712;&#19978;&#30340;&#28857;&#65292;&#25152;&#20197;
&#27178;&#32437;&#22352;&#26631;&#19981;&#26159;&#30456;&#20114;&#29420;&#31435;&#30340;&#12290;<span class="NoteBox"><span class="NoteContent">&#19981;&#22952;&#23558;&#37329;&#23646;&#23548;&#36712;&#35270;&#20026;&#26377;&#38271;&#24230;&#26080;&#23485;&#24230;&#30340;&#22278;&#24418;&#36712;&#36857;&#65292;&#20197;&#22278;&#24515;&#20026;
&#22352;&#26631;&#21407;&#28857;&#12290;&#35201;&#20445;&#35777;&#27178;&#22352;&#26631;&#21464;&#21270;&#26102;&#65292;&#24471;&#21040;&#30340;&#28857;&#20173;&#22312;&#22278;&#19978;&#65292;&#21017;&#32437;&#22352;&#26631;&#20063;&#35201;&#30456;&#24212;&#25913;&#21464;&#12290;&#21453;&#20043;&#20134;
&#28982;&#12290;&#8212;&#8212;<span class="emph">&#35793;&#27880;</span></span></span>&#29233;&#20029;&#19997;&#23454;&#29616; <span class="stt">increment-x</span> &#26102;&#65292;&#35201;&#23567;&#24515;&#32764;&#32764;&#22320;&#26356;&#26032;&#32437;&#22352;&#26631;&#65292;&#20197;&#21305;&#37197;
&#27178;&#22352;&#26631;&#30340;&#25913;&#21464;&#12290;&#20294;&#26159;&#40077;&#20271;&#19981;&#30693;&#36947;&#36825;&#28857;&#65292;&#25152;&#20197;&#20182;&#30340;&#36807;&#31243;&#20889;&#20316;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">increment-y = proc (p : point)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">unpair x y = p</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">in newpair(x, -(y,-1))</span></p></td></tr></table></blockquote><p>&#30001;&#20110;&#40077;&#20271;&#30340;&#20195;&#30721;&#20462;&#25913;&#32437;&#22352;&#26631;&#26102;&#19981;&#38543;&#20043;&#20462;&#25913;&#27178;&#22352;&#26631;&#65292;&#29233;&#20029;&#19997;&#30340;&#20195;&#30721;&#23601;&#27809;&#27861;&#27491;&#24120;&#24037;&#20316;&#20102;&#12290;</p></blockquote><p>&#26356;&#31967;&#31957;&#30340;&#26159;&#65292;&#22914;&#26524;&#29233;&#20029;&#19997;&#25171;&#31639;&#20462;&#25913;&#28857;&#30340;&#34920;&#31034;&#65292;&#25226;&#32437;&#22352;&#26631;&#20316;&#20026;&#31532;&#19968;&#37096;&#20998;&#21602;&#65311;&#22905;&#21487;&#20197;&#25353;&#29031;&#26032;&#30340;&#34920;
&#31034;&#20462;&#25913;&#22905;&#30340;&#20195;&#30721;&#12290;&#20294;&#26159;&#40077;&#20271;&#30340;&#20195;&#30721;&#23601;&#22351;&#25481;&#20102;&#65292;&#22240;&#20026;&#36807;&#31243; <span class="stt">increment-y</span> &#20462;&#25913;&#20102;&#24207;&#23545;&#20013;&#30340;
&#38169;&#35823;&#37096;&#20998;&#12290;</p><p>&#29233;&#20029;&#19997;&#21487;&#20197;&#25226; <span class="stt">point</span> &#22768;&#26126;&#20026;<span class="emph">&#27169;&#31946;</span>&#25968;&#25454;&#31867;&#22411;&#26469;&#35299;&#20915;&#22905;&#30340;&#38382;&#39064;&#12290;&#22905;&#25226;&#25509;&#21475;&#37325;&#20889;&#20026;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">opaque point</span></p></td></tr><tr><td><p><span class="stt">initial-point : (int -&gt; point)</span></p></td></tr><tr><td><p><span class="stt">increment-x : (point -&gt; point)</span></p></td></tr><tr><td><p><span class="stt">get-x : (point -&gt; int)</span></p></td></tr></table></blockquote><p>&#29616;&#22312;&#40077;&#20271;&#29992;&#36807;&#31243; <span class="stt">initial-point</span> &#21019;&#24314;&#26032;&#30340;&#28857;&#65292;&#32780;&#19988;&#20182;&#21487;&#20197;&#29992; <span class="stt">from
Alices-points take get-x</span> &#21644; <span class="stt">from Alices-points take increment-x</span> &#22788;&#29702;&#28857;&#65292;&#20294;
&#26159;&#38500;&#20102;&#29233;&#20029;&#19997;&#25509;&#21475;&#20013;&#30340;&#36807;&#31243;&#22806;&#65292;&#20182;&#26080;&#27861;&#29992;&#20854;&#20182;&#36807;&#31243;&#22788;&#29702;&#28857;&#12290;&#23588;&#20854;&#26159;&#65292;&#20182;&#20889;&#19981;&#20986;&#36807;&#31243;
<span class="stt">increment-y</span>&#65292;&#22240;&#20026;&#23427;&#29992;&#20102;&#29233;&#20029;&#19997;&#25509;&#21475;&#20043;&#22806;&#30340;&#36807;&#31243;&#22788;&#29702;&#28857;&#12290;</p><p>&#22312;&#26412;&#33410;&#30340;&#21097;&#20313;&#37096;&#20998;&#20013;&#65292;&#25105;&#20204;&#25506;&#31350;&#36825;&#20123;&#32452;&#20214;&#30340;&#26356;&#22810;&#20363;&#23376;&#12290;</p><h5><a name="(part._s8..2-transparent-types)"></a>&#36879;&#26126;&#31867;&#22411;</h5><p><a name="(idx._(gentag._1225))"></a>
<a name="(idx._(gentag._1226))"></a>
<a name="(idx._(gentag._1227))"></a>
&#25105;&#20204;&#39318;&#20808;&#35752;&#35770;&#36879;&#26126;&#31867;&#22411;&#22768;&#26126;&#12290;&#26377;&#26102;&#36825;&#20123;&#21448;&#31216;&#20316;<span class="emph">&#20855;&#20307;</span> (<span class="emph">concrete</span>) &#31867;&#22411;
&#25110;<span class="emph">&#31867;&#22411;&#32553;&#20889;</span> (<span class="emph">type abbreviation</span>)&#12290;</p><blockquote class="EoplExample"><p><a name="(elem._eg-8..6)"></a>&#31243;&#24207;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[transparent t = int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">z : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">s : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">is-z? : (t -&gt; bool)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[type t = int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">z = 33</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">s = proc (x : t) -(x,-1)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">is-z? = proc (x : t) zero?(-(x,z))]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">proc (x : from m1 take t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(from m1 take is-z? -(x,0))</span></p></td></tr></table></blockquote><p>&#31867;&#22411;&#20026; <span class="stt">(int -&gt; bool)</span>&#12290;</p></blockquote></blockquote><blockquote class="EoplFigure"><p><div class="SIntrapara">[!ht]</div><div class="SIntrapara"><blockquote class="SCentered"><p><img src="module-type.svg" alt="模块类型声明的作用域" width="570.0pt" height="372.0pt"/></p></blockquote></div></p><blockquote class="caption"><p>&#27169;&#22359;&#31867;&#22411;&#22768;&#26126;&#30340;&#20316;&#29992;&#22495;<a name="(elem._fig-8..8)"></a></p></blockquote></blockquote><p>&#22312;&#25509;&#21475;&#30340;&#21097;&#20313;&#37096;&#20998;&#20013;&#65292;&#22768;&#26126; <span class="stt">transparent t = int</span> &#23558; <span class="stt">t</span> &#32465;&#23450;&#21040;&#31867;&#22411; <span class="stt">int</span>&#65292;
&#25152;&#20197;&#25105;&#20204;&#21487;&#20197;&#20889; <span class="stt">z : t</span>&#12290;&#26356;&#37325;&#35201;&#30340;&#26159;&#65292;&#22312;&#31243;&#24207;&#30340;&#21097;&#20313;&#37096;&#20998;&#20013;&#65292;&#22768;&#26126;&#20063;&#23558; <span class="stt">from m1
take t</span> &#32465;&#23450;&#21040; <span class="stt">int</span>&#12290;&#25105;&#20204;&#31216;&#20043;&#20026;<span class="emph">&#21463;&#38480;&#31867;&#22411;</span> (<span class="emph">qualified type</span>)&#12290;
<a name="(idx._(gentag._1228))"></a>
&#36825;&#37324;&#65292;&#25105;&#20204;&#29992;&#23427;&#22768;&#26126;&#20102;&#32465;&#23450;&#21040;&#21464;&#37327; <span class="stt">z</span> &#30340;&#31867;&#22411;&#12290;&#22768;&#26126;&#30340;&#20316;&#29992;&#22495;&#26159;&#25509;&#21475;&#30340;&#21097;&#20313;&#37096;&#20998;&#65292;&#20197;&#21450;
&#27169;&#22359;&#23450;&#20041;&#20043;&#21518;&#31243;&#24207;&#30340;&#21097;&#20313;&#37096;&#20998;&#12290;</p><p>&#27169;&#22359;&#20027;&#20307;&#20013;&#30340;&#23450;&#20041; <span class="stt">type t = int</span> &#22312;&#20027;&#20307;&#30340;&#21097;&#20313;&#37096;&#20998;&#20013;&#65292;&#23558; <span class="stt">t</span> &#32465;&#23450;&#21040; <span class="stt">int</span>&#65292;
&#25152;&#20197;&#25105;&#20204;&#21487;&#20197;&#20889; <span class="stt">s = proc (x : t) ...</span>&#12290;&#20687;&#20043;&#21069;&#37027;&#26679;&#65292;&#23450;&#20041;&#30340;&#20316;&#29992;&#22495;&#26159;&#20027;&#20307;&#30340;&#21097;&#20313;&#37096;
&#20998;&#65288;&#35265;<span class="EoplFigureRef"></span>&#65289;&#12290;</p><p>&#24403;&#28982;&#65292;&#25105;&#20204;&#21487;&#20197;&#32473;&#31867;&#22411;&#36215;&#20219;&#24847;&#21517;&#23383;&#65292;&#20063;&#21487;&#20197;&#22768;&#26126;&#22810;&#20010;&#31867;&#22411;&#12290;&#31867;&#22411;&#22768;&#26126;&#21487;&#20197;&#20986;&#29616;&#22312;&#25509;&#21475;&#20013;&#20219;&#24847;
&#20301;&#32622;&#65292;&#21482;&#35201;&#27599;&#20010;&#22768;&#26126;&#37117;&#20808;&#20110;&#20351;&#29992;&#12290;</p><p><a name="(idx._(gentag._1229))"></a>
<a name="(idx._(gentag._1230))"></a>
<a name="(idx._(gentag._1231))"></a></p><h5><a name="(part._s8..2-opaque-types)"></a>&#27169;&#31946;&#31867;&#22411;</h5><p><a name="(idx._(gentag._1232))"></a>
<a name="(idx._(gentag._1233))"></a>
&#27169;&#22359;&#36824;&#21487;&#20197;&#29992; <span class="stt">opaque-type</span> &#22768;&#26126;&#36755;&#20986;<span class="emph">&#27169;&#31946;</span>&#31867;&#22411;&#12290;&#27169;&#31946;&#31867;&#22411;&#26377;&#26102;&#21448;
&#31216;&#20316;<span class="emph">&#25277;&#35937;&#31867;&#22411;</span> (<span class="emph">abstract type</span>)&#12290;</p><blockquote class="EoplExample"><p><a name="(elem._eg-8..7)"></a>&#25105;&#20204;&#25226;<span class="EoplExampleRef"></span> &#31243;&#24207;&#20013;&#30340;&#36879;&#26126;&#31867;&#22411;&#26367;&#25442;&#20026;&#27169;&#31946;
&#31867;&#22411;&#12290;&#24471;&#20986;&#30340;&#31243;&#24207;&#26159;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">z : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">s : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">is-z? : (t -&gt; bool)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[type t = int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">z = 33</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">s = proc (x : t) -(x,-1)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">is-z? = proc (x : t) zero?(-(x,z))]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">proc (x : from m1 take t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(from m1 take is-z? -(x,0))</span></p></td></tr></table></blockquote></blockquote></blockquote><p>&#25509;&#21475;&#20013;&#30340;&#22768;&#26126; <span class="stt">opaque t</span> &#25226; <span class="stt">t</span> &#20316;&#20026;&#19968;&#31181;&#26032;&#30340;&#27169;&#31946;&#31867;&#22411;&#21517;&#23383;&#12290;&#27169;&#31946;&#31867;&#22411;&#30340;&#34892;&#20026;&#23601;
&#20687; <span class="stt">int</span> &#25110; <span class="stt">bool</span> &#20043;&#31867;&#30340;&#21407;&#29983;&#31867;&#22411;&#12290;&#21517;&#20026; <span class="stt">t</span> &#30340;&#31867;&#22411;&#22312;&#25509;&#21475;&#30340;&#21097;&#20313;&#37096;&#20998;&#20013;&#32465;
&#23450;&#21040;&#36825;&#31181;&#27169;&#31946;&#31867;&#22411;&#65292;&#32780;&#21463;&#38480;&#31867;&#22411; <span class="stt">from m1 take t</span> &#22312;&#31243;&#24207;&#30340;&#21097;&#20313;&#37096;&#20998;&#20013;&#32465;&#23450;&#21040;&#21516;&#19968;&#27169;
&#31946;&#31867;&#22411;&#12290;&#31243;&#24207;&#30340;&#21097;&#20313;&#37096;&#20998;&#37117;&#30693;&#36947; <span class="stt">from m1 take z</span> &#32465;&#23450;&#21040;&#19968;&#20010;&#20540;&#65292;&#20854;&#31867;&#22411;&#20026; <span class="stt">from
m1 take t</span>&#65307;<span class="stt">from m1 take s</span> &#21644; <span class="stt">from m1 take is-z?</span> &#32465;&#23450;&#21040;&#36807;&#31243;&#65292;&#29992;&#26469;&#22788;&#29702;
&#36825;&#31181;&#31867;&#22411;&#30340;&#20540;&#12290;<a name="(idx._(gentag._1234))"></a>&#36825;&#23601;&#26159;&#25277;&#35937;&#36793;&#30028;&#12290;&#31867;&#22411;&#26816;&#26597;&#22120;&#30830;&#20445;&#34920;
&#36798;&#24335;&#30340;&#31867;&#22411;&#20026; <span class="stt">from m1 take t</span>&#26102;&#65292;&#27714;&#20540;&#26159;&#23433;&#20840;&#30340;&#65292;&#25152;&#20197;&#34920;&#36798;&#24335;&#30340;&#20540;&#21482;&#33021;&#36890;&#36807;&#36825;&#20123;&#25805;&#20316;
&#31526;&#29983;&#25104;&#65292;&#22914;<span class="stt">suitable-env</span>&#25152;&#36848;&#12290;</p><p>&#19982;&#20043;&#23545;&#24212;&#65292;&#23450;&#20041; <span class="stt">type t = int</span> &#22312;&#27169;&#22359;&#20027;&#20307;&#20869;&#37096;&#23558; <span class="stt">t</span> &#20316;&#20026; <span class="stt">int</span> &#30340;&#21517;&#23383;&#65292;
&#20294;&#26159;&#65292;&#30001;&#20110;&#31243;&#24207;&#30340;&#21097;&#20313;&#37096;&#20998;&#20174;&#27169;&#22359;&#25509;&#21475;&#33719;&#24471;&#32465;&#23450;&#65292;&#25152;&#20197;&#23545;&#27492;&#19968;&#26080;&#25152;&#30693;&#12290;</p><p>&#25152;&#20197; <span class="stt">-(x,0)</span> &#31867;&#22411;&#24322;&#24120;&#65292;&#22240;&#20026;&#20027;&#31243;&#24207;&#19981;&#30693;&#36947;&#31867;&#22411; <span class="stt">from m1 take t</span> &#20026;&#30340;&#20540;&#23601;&#26159;&#31867;
&#22411;&#20026; <span class="stt">int</span> &#30340;&#20540;&#12290;</p><p>&#25105;&#20204;&#25913;&#21464;&#31243;&#24207;&#65292;&#21024;&#25481;&#31639;&#26415;&#25805;&#20316;&#65292;&#24471;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">z : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">s : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">is-z? : (t -&gt; bool)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[type t = int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">z = 33</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">s = proc (x : t) -(x,-1)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">is-z? = proc (x : t) zero?(-(x,z))]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">proc (x : from m1 take t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(from m1 take is-z? x)</span></p></td></tr></table></blockquote><p>&#29616;&#22312;&#65292;&#25105;&#20204;&#30340;&#31243;&#24207;&#31867;&#22411;&#27491;&#24120;&#65292;&#31867;&#22411;&#20026; <span class="stt">(from m1 take t -&gt; bool)</span>&#12290;</p></blockquote><p>&#36890;&#36807;&#24378;&#21270;&#25277;&#35937;&#36793;&#30028;&#65292;&#31867;&#22411;&#26816;&#26597;&#22120;&#30830;&#20445;&#31243;&#24207;&#21482;&#33021;&#36890;&#36807;&#25509;&#21475;&#25552;&#20379;&#30340;&#36807;&#31243;&#22788;&#29702;&#25509;&#21475;&#25552;&#20379;&#30340;&#20540;&#12290;
&#22914;<a href="da.html" data-pltdoc="x">&#25968;&#25454;&#25277;&#35937;</a>&#25152;&#36848;&#65292;&#36825;&#32473;&#25105;&#20204;&#25552;&#20379;&#20102;&#26426;&#21046;&#26469;&#20998;&#31163;&#25968;&#25454;&#31867;&#22411;&#30340;&#29992;&#25143;&#21644;&#23454;&#29616;&#12290;&#25509;&#19979;&#26469;&#65292;&#25105;&#20204;&#32473;
&#20986;&#36825;&#19968;&#25216;&#26415;&#30340;&#20960;&#20010;&#20363;&#23376;&#12290;</p><blockquote class="EoplExample"><p><a name="(elem._eg-8..8)"></a>&#22914;&#26524;&#31243;&#24207;&#20351;&#29992;&#20102;&#27169;&#22359;&#23450;&#20041;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module colors</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[opaque color</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">red : color</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">green : color</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">is-red? : (color -&gt; bool)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[type color = int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">red = 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">green = 1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">is-red? = proc (c : color) zero?(c)]</span></p></td></tr></table></blockquote><p>&#31243;&#24207;&#27809;&#27861;&#30693;&#36947; <span class="stt">from colors take color</span> &#23454;&#38469;&#20026; <span class="stt">int</span>&#65292;&#20063;&#19981;&#30693;&#36947; <span class="stt">from
colors take green</span> &#23454;&#38469;&#20026; 1&#65288;&#20063;&#35768;&#26377;&#19968;&#20010;&#20363;&#22806;&#65306;&#36820;&#22238;&#39068;&#33394;&#20316;&#20026;&#26368;&#32456;&#31572;&#26696;&#65292;&#28982;&#21518;&#25171;&#21360;&#20986;
&#26469;&#65289;&#12290;</p></blockquote></blockquote><blockquote class="EoplExample"><p><a name="(elem._eg-8..9)"></a>&#31243;&#24207;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module ints1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">zero : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">succ : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">pred : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">is-zero : (t -&gt; bool)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[type t = int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">zero = 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">succ = proc(x : t) -(x,-5)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">pred = proc(x : t) -(x,5)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">is-zero = proc (x : t) zero?(x)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">let z = from ints1 take zero</span></p></td></tr><tr><td><p><span class="stt">in let s = from ints1 take succ</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">in (s (s z))</span></p></td></tr></table></blockquote><p>&#31867;&#22411;&#20026; <span class="stt">from ints1 take t</span>&#65292;&#20540;&#20026; 10&#12290;&#20294;&#25105;&#20204;&#21482;&#33021;&#36890;&#36807; <span class="stt">ints1</span> &#36755;&#20986;&#30340;&#36807;&#31243;&#22788;&#29702;
&#36825;&#20010;&#20540;&#12290;&#36825;&#20010;&#27169;&#22359;&#29992;&#34920;&#36798;&#20540; <span class="texMathInline">5*k</span> &#34920;&#31034;&#25972;&#25968; <span class="texMathInline">k</span>&#12290;&#29992;<a href="da.html#%28part._s2..1%29" data-pltdoc="x">&#29992;&#25509;&#21475;&#23450;&#20041;&#25968;&#25454;</a>&#30340;&#34920;&#31034;&#27861;&#65292;&#20889;&#20316;
<span class="texMathInline">\lceil k \rceil = 5 * k</span>&#12290;</p></blockquote></blockquote><blockquote class="EoplExample"><p><a name="(elem._eg-8..10)"></a>&#22312;&#36825;&#20010;&#27169;&#22359;&#20013;&#65292;<span class="texMathInline">\lceil k \rceil = -3 * k</span>&#12290;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module ints2</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">zero : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">succ : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">pred : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">is-zero : (t -&gt; bool)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[type t = int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">zero = 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">succ = proc(x : t) -(x,3)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">pred = proc(x : t) -(x,-3)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">is-zero = proc (x : t) zero?(x)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">let z = from ints2 take zero</span></p></td></tr><tr><td><p><span class="stt">in let s = from ints2 take succ</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">in (s (s z))</span></p></td></tr></table></blockquote><p>&#31867;&#22411;&#20026; <span class="stt">from ints2 take t</span>&#65292;&#20540;&#20026; -6&#12290;</p></blockquote></blockquote><blockquote class="EoplExample"><p><a name="(elem._eg-8..11)"></a>&#22312;&#21069;&#38754;&#30340;&#20363;&#23376;&#20013;&#65292;&#25105;&#20204;&#19981;&#33021;&#30452;&#25509;&#22788;&#29702;&#20540;&#65292;&#20294;&#25105;&#20204;&#33021;&#29992;&#27169;&#22359;&#36755;&#20986;
&#30340;&#36807;&#31243;&#22788;&#29702;&#23427;&#20204;&#12290;&#20687;<a href="da.html" data-pltdoc="x">&#25968;&#25454;&#25277;&#35937;</a>&#37027;&#26679;&#65292;&#25105;&#20204;&#21487;&#20197;&#32467;&#21512;&#36825;&#20123;&#36807;&#31243;&#20570;&#26377;&#29992;&#30340;&#24037;&#20316;&#12290;&#36825;&#37324;&#65292;&#25105;&#20204;
&#23558;&#23427;&#20204;&#32467;&#21512;&#36215;&#26469;&#65292;&#20889;&#20986;&#36807;&#31243; <span class="stt">to-int</span>&#65292;&#25226;&#27169;&#22359;&#20013;&#30340;&#20540;&#36716;&#22238; <span class="stt">int</span> &#31867;&#22411;&#12290;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module ints1 </span><span class="emph">...&#21516;&#21069;...</span><span class="stt"></span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">let z = from ints1 take zero</span></p></td></tr><tr><td><p><span class="stt">in let s = from ints1 take succ</span></p></td></tr><tr><td><p><span class="stt">in let p = from ints1 take pred</span></p></td></tr><tr><td><p><span class="stt">in let z? = from ints1 take is-zero</span></p></td></tr><tr><td><p><span class="stt">in letrec int to-int (x : from ints1 take t) =</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">if (z? x)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">then 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">else -((to-int (p x)), -1)</span></p></td></tr><tr><td><p><span class="stt">in (to-int (s (s z)))</span></p></td></tr></table></blockquote><p>&#31867;&#22411;&#20026; <span class="stt">int</span>&#65292;&#20540;&#20026; 2&#12290;</p></blockquote></blockquote><blockquote class="EoplExample"><p><a name="(elem._eg-8..12)"></a>&#36825;&#37324;&#29992;&#21040;&#30340;&#25216;&#26415;&#19982; <span class="stt">ints2</span> &#20013;&#31639;&#26415;&#25805;&#20316;&#30340;&#23454;&#29616;&#30456;&#21516;&#12290;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module ints2 </span><span class="emph">...&#21516;&#21069;...</span><span class="stt"></span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">let z = from ints2 take zero</span></p></td></tr><tr><td><p><span class="stt">in let s = from ints2 take succ</span></p></td></tr><tr><td><p><span class="stt">in let p = from ints2 take pred</span></p></td></tr><tr><td><p><span class="stt">in let z? = from ints2 take is-zero</span></p></td></tr><tr><td><p><span class="stt">in letrec int to-int (x : from ints2 take t) =</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">if (z? x)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">then 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">else -((to-int (p x)), -1)</span></p></td></tr><tr><td><p><span class="stt">in (to-int (s (s z)))</span></p></td></tr></table></blockquote><p>&#31867;&#22411;&#21516;&#26679;&#20026; <span class="stt">int</span>&#65292;&#20540;&#20026; 2&#12290;</p></blockquote></blockquote><p>&#22312;<a href="#%28part._s8..3%29" data-pltdoc="x">&#27169;&#22359;&#36807;&#31243;</a>&#20013;&#65292;&#25105;&#20204;&#23637;&#31034;&#22914;&#20309;&#23558;&#20004;&#20010;&#25277;&#35937;&#20986;&#26469;&#12290;</p><blockquote class="EoplExample"><p><a name="(elem._eg-8..13)"></a>&#22312;&#19979;&#38754;&#30340;&#31243;&#24207;&#20013;&#65292;&#25105;&#20204;&#35774;&#35745;&#19968;&#20010;&#27169;&#22359;&#26469;&#23553;&#35013;&#24067;&#23572;&#31867;&#22411;&#12290;&#24067;&#23572;&#20540;&#29992;&#25972;&#25968;&#20540;&#34920;&#31034;&#65292;
&#20294;&#26159;&#20687;<span class="EoplExampleRef"></span> &#37027;&#26679;&#65292;&#31243;&#24207;&#30340;&#21097;&#20313;&#37096;&#20998;&#23545;&#27492;&#19968;&#26080;&#25152;&#30693;&#12290;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module mybool</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">true : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">false : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">and : (t -&gt; (t -&gt; t))</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">not : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">to-bool : (t -&gt; bool)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[type t = int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">true = 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">false = 13</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">and = proc (x : t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">proc (y : t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">if zero?(x) then y else false</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">not = proc (x : t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">if zero?(x) then false else true</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">to-bool = proc (x : t) zero?(x)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">let true = from mybool take true</span></p></td></tr><tr><td><p><span class="stt">in let false = from mybool take false</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">in let and = from mybool take and</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">in ((and true) false)</span></p></td></tr></table></blockquote><p>&#31867;&#22411;&#20026; <span class="stt">from mybool take t</span>&#65292;&#20540;&#20026; 13&#12290;</p></blockquote></blockquote><p><a name="(idx._(gentag._1235))"></a>
<a name="(idx._(gentag._1236))"></a></p><blockquote class="EoplExercise"><p><a name="(elem._ex8..12)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#22312;<span class="EoplExampleRef"></span> &#20013;&#65292;<span class="stt">and</span> &#21644; <span class="stt">not</span> &#30340;&#23450;&#20041;&#21487;&#20197;&#20174;&#27169;&#22359;&#20869;&#37096;&#31227;&#21040;&#22806;&#38754;
&#21527;&#65311;<span class="stt">to-bool</span> &#21602;&#65311;</p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..13)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#20889;&#19968;&#20010;&#27169;&#22359;&#65292;&#29992; <span class="texMathInline">5*k+3</span> &#34920;&#31034;&#25972;&#25968; <span class="texMathInline">k</span>&#65292;&#23454;&#29616;&#31639;&#26415;&#25805;&#20316;&#12290;</p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..14)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#19979;&#38754;&#26159; <span class="stt">mybool</span>&#65288;<span class="EoplExampleRef"></span>&#65289;&#30340;&#21478;&#19968;&#31181;&#23450;&#20041;&#65306;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module mybool</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">true : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">false : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">and : (t -&gt; (t -&gt; t))</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">not : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">to-bool : (t -&gt; bool)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[type t = int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">true = 1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">false = 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">and = proc (x : t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">proc (y : t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">if zero?(x) then false else y</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">not = proc (x : t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">if zero?(x) then true else false</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">to-bool = proc (x : t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">if zero?(x) then zero?(1) else zero?(0)]</span></p></td></tr></table></blockquote><p>&#26377;&#27809;&#26377;&#31243;&#24207;&#31867;&#22411;&#20026; <span class="stt">int</span>&#65292;&#29992; <span class="stt">mybool</span> &#21407;&#26469;&#30340;&#23450;&#20041;&#36820;&#22238;&#19968;&#20010;&#20540;&#65292;&#29992;&#26032;&#30340;&#23450;&#20041;&#36820;&#22238;&#21478;
&#19968;&#20010;&#20540;&#65311;</p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..15)"></a><span class="texMathInline">\textnormal{[}{\star}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span><a name="(idx._(gentag._1237))"></a>
<a name="(idx._(gentag._1238))"></a>
&#20889;&#19968;&#20010;&#27169;&#22359;&#65292;&#23454;&#29616;&#25277;&#35937;&#34920;&#12290;&#20320;&#23454;&#29616;&#30340;&#34920;&#24212;&#31867;&#20284;&#29615;&#22659;&#65292;&#20294;&#19981;&#26159;&#25226;&#31526;&#21495;&#32465;&#23450;&#21040; Scheme &#20540;&#65292;&#32780;&#26159;
&#25226;&#25972;&#25968;&#20540;&#32465;&#23450;&#21040;&#25972;&#25968;&#20540;&#12290;&#25509;&#21475;&#25552;&#20379;&#19968;&#20010;&#20540;&#65292;&#34920;&#31034;&#31354;&#34920;&#65307;&#20004;&#20010;&#36807;&#31243; <span class="stt">add-to-table</span> &#21644;
<span class="stt">lookup-in-table</span> &#31867;&#20284; <span class="stt">extend-env</span> &#21644; <span class="stt">apply-env</span>&#12290;&#30001;&#20110;&#25105;&#20204;&#30340;&#35821;&#35328;&#21482;&#26377;
&#21333;&#21442;&#25968;&#36807;&#31243;&#65292;&#25105;&#20204;&#29992;&#21654;&#21937;&#21270;&#65288;<span class="EoplExerciseRef"></span>&#65289;&#23454;&#29616;&#31561;&#25928;&#30340;&#22810;&#21442;&#25968;&#36807;&#31243;&#12290;&#20320;&#21487;&#20197;&#29992;
&#26597;&#35810;&#20219;&#20309;&#20540;&#37117;&#36820;&#22238; 0 &#30340;&#34920;&#27169;&#25311;&#31354;&#34920;&#12290;&#36825;&#26159;&#35813;&#27169;&#22359;&#30340;&#19968;&#20010;&#20363;&#23376;&#65306;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module tables</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[opaque table</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">empty : table</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">add-to-table : (int -&gt; (int -&gt; (table -&gt; table)))</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">lookup-in-table : (int -&gt; (table -&gt; int))]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[type table = (int -&gt; int)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">...]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">let empty = from tables take empty</span></p></td></tr><tr><td><p><span class="stt">in let add-binding = from tables take add-to-table</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">in let lookup = from tables take lookup-in-table</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">in let table1 = (((add-binding 3) 300)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(((add-binding 4) 400)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(((add-binding 3) 600)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">empty)))</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">in -(((lookup 4) table1),</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">((lookup 3) table1))</span></p></td></tr></table></blockquote><p>&#36825;&#20010;&#31243;&#24207;&#31867;&#22411;&#24212;&#20026; <span class="stt">int</span>&#12290;&#34920; <span class="stt">table1</span> &#25226; 4 &#32465;&#23450;&#21040; 400&#65292;&#25226; 3 &#32465;&#23450;&#21040; 300&#65292;&#25152;&#20197;
&#31243;&#24207;&#30340;&#20540;&#24212;&#20026; 100&#12290;
<a name="(idx._(gentag._1239))"></a>
<a name="(idx._(gentag._1240))"></a></p></blockquote><h5>8.2.2<tt>&nbsp;</tt><a name="(part._s8..2..2)"></a>&#23454;&#29616;</h5><p>&#29616;&#22312;&#25105;&#20204;&#26469;&#25193;&#23637;&#31995;&#32479;&#65292;&#23454;&#29616;&#36879;&#26126;&#31867;&#22411;&#21644;&#27169;&#31946;&#31867;&#22411;&#22768;&#26126;&#65292;&#21450;&#21463;&#38480;&#31867;&#22411;&#30340;&#24341;&#29992;&#12290;</p><h5><a name="(part._syntax-and-the-interpreter)"></a>&#35821;&#27861;&#21644;&#35299;&#37322;&#22120;</h5><p><a name="(idx._(gentag._1241))"></a>
<a name="(idx._(gentag._1242))"></a>
&#25105;&#20204;&#32473;&#20004;&#31181;&#26032;&#31867;&#22411;&#28155;&#21152;&#35821;&#27861;&#65306;&#26377;&#21517;&#31867;&#22411;&#65288;&#22914; <span class="stt">t</span>&#65289;&#21644;&#21463;&#38480;&#31867;&#22411;&#65288;&#22914; <span class="stt">from m1 take
t</span>&#65289;&#12290;</p><blockquote class="Small"><p><span class="Iidentity">\begin{align*}\mathit{Type} &amp;::= \mathit{Identifier} \\[-3pt]
&amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">named-type (name)</span>} \\[5pt]
    \mathit{Type} &amp;::= <span class="stt">from </span><span class="Iidentity">\mathit{Identifier}</span><span class="stt"> take </span><span class="Iidentity">\mathit{Identifier}</span> \\[-3pt]
&amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">qualified-type (m-name t-name)</span>}\end{align*}</span></p></blockquote><p>&#25105;&#20204;&#20026;&#27169;&#31946;&#31867;&#22411;&#21644;&#36879;&#26126;&#31867;&#22411;&#26032;&#22686;&#20004;&#31181;&#22768;&#26126;&#12290;</p><blockquote class="Small"><p><span class="Iidentity">\begin{align*}\mathit{Decl} &amp;::= <span class="stt">opaque </span><span class="Iidentity">\mathit{Identifier}</span> \\[-3pt]
&amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">opaque-type-decl (t-name)</span>} \\[5pt]
    \mathit{Decl} &amp;::= <span class="stt">transparent </span><span class="Iidentity">\mathit{Identifier}</span><span class="stt"> = </span><span class="Iidentity">\mathit{Type}</span> \\[-3pt]
&amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">transparent-type-decl (t-name ty)</span>}\end{align*}</span></p></blockquote><p><a name="(idx._(gentag._1243))"></a>
&#25105;&#20204;&#36824;&#35201;&#26032;&#22686;&#19968;&#31181;&#23450;&#20041;&#65306;&#31867;&#22411;&#23450;&#20041;&#65292;&#29992;&#26469;&#23450;&#20041;&#27169;&#31946;&#31867;&#22411;&#21644;&#36879;&#26126;&#31867;&#22411;&#12290;</p><blockquote class="Small"><p><span class="Iidentity">\begin{align*}\mathit{Defn} &amp;::= <span class="stt">type </span><span class="Iidentity">\mathit{Identifier}</span><span class="stt"> = </span><span class="Iidentity">\mathit{Type}</span> \\[-3pt]
&amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">type-defn (name ty)</span>}\end{align*}</span></p></blockquote><p>&#35299;&#37322;&#22120;&#19981;&#38656;&#35201;&#26597;&#30475;&#31867;&#22411;&#21644;&#22768;&#26126;&#65292;&#25152;&#20197;&#35299;&#37322;&#22120;&#30340;&#21807;&#19968;&#25913;&#21160;&#26159;&#24573;&#30053;&#31867;&#22411;&#23450;&#20041;&#12290;</p><blockquote class="EoplCodeInset"><p><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">defns-to-env</span></span> : <span class="texMathInline">\mathit{Listof(Defn)} \times \mathit{Env} \to \mathit{Env}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">defns-to-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">null?</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">empty-env</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">definition</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val-defn</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...as</span><span class="hspace">&nbsp;</span><span class="RktSym">before...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">type-defn</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">type-name</span><span class="hspace">&nbsp;</span><span class="RktSym">type</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns-to-env</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara"><a name="(idx._(gentag._1244))"></a></div></p></blockquote><h5><a name="(part._the-checker)"></a>&#26816;&#26597;&#22120;</h5><p><a name="(idx._(gentag._1245))"></a>
<a name="(idx._(gentag._1246))"></a>
&#26816;&#26597;&#22120;&#30340;&#25913;&#21160;&#23601;&#22810;&#22810;&#20102;&#65292;&#22240;&#20026;&#25152;&#26377;&#20851;&#20110;&#31867;&#22411;&#30340;&#25805;&#20316;&#37117;&#35201;&#25193;&#23637;&#65292;&#20197;&#20415;&#22788;&#29702;&#26032;&#30340;&#31867;&#22411;&#12290;</p><p>&#39318;&#20808;&#65292;&#25105;&#20204;&#20171;&#32461;&#19968;&#31181;&#31995;&#32479;&#24615;&#30340;&#26041;&#27861;&#26469;&#22788;&#29702;&#27169;&#31946;&#31867;&#22411;&#21644;&#36879;&#26126;&#31867;&#22411;&#12290;&#27169;&#31946;&#31867;&#22411;&#23601;&#20687; <span class="stt">int</span> &#25110;
<span class="stt">bool</span> &#20043;&#31867;&#30340;&#21407;&#29983;&#31867;&#22411;&#19968;&#26679;&#12290;&#32780;&#36879;&#26126;&#31867;&#22411;&#21517;&#21103;&#20854;&#23454;&#65292;&#26159;&#36879;&#26126;&#30340;&#65306;&#23427;&#20204;&#30340;&#34892;&#20026;&#19982;&#23450;&#20041;&#30456;&#21516;&#12290;
&#25152;&#20197;&#27599;&#20010;&#31867;&#22411;&#37117;&#31561;&#20215;&#20110;&#19979;&#21015;&#35821;&#27861;&#25551;&#36848;&#30340;&#65306;</p><blockquote class="SubFlow"><blockquote class="Small"><p><span class="texMathDisplay">\mathit{Type} ::= <span class="stt">int</span>\ |\ <span class="stt">bool</span>\ |\ <span class="stt">from </span><span class="texMathInline">m</span><span class="stt"> take </span><span class="texMathInline">t</span>\ |\ <span class="stt">(</span><span class="texMathInline">\mathit{Type}</span><span class="stt"> -&gt; </span><span class="texMathInline">\mathit{Type}</span><span class="stt">)</span></span></p></blockquote><p>&#20854;&#20013;&#65292;<span class="texMathInline">t</span> &#20026; <span class="texMathInline">m</span> &#20013;&#30340;&#27169;&#31946;&#31867;&#22411;&#22768;&#26126;&#12290;&#25105;&#20204;&#31216;&#36825;&#31181;&#24418;&#24335;&#30340;&#31867;&#22411;&#20026;<span class="emph">&#23637;&#24320;&#31867;&#22411;</span> (<span class="emph">expanded
type</span>)&#12290;</p></blockquote><p>&#25509;&#19979;&#26469;&#25105;&#20204;&#25193;&#23637;&#31867;&#22411;&#29615;&#22659;&#65292;&#22788;&#29702;&#26032;&#31867;&#22411;&#12290;&#25105;&#20204;&#30340;&#31867;&#22411;&#29615;&#22659;&#23558;&#27599;&#20010;&#26377;&#21517;&#31867;&#22411;&#25110;&#21463;&#38480;&#31867;&#22411;&#32465;&#23450;&#21040;
&#19968;&#20010;&#23637;&#24320;&#31867;&#22411;&#12290;&#26032;&#30340;&#31867;&#22411;&#29615;&#22659;&#23450;&#20041;&#20026;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define-datatype</span><span class="hspace">&nbsp;</span><span class="RktSym">type-environment</span><span class="hspace">&nbsp;</span><span class="RktSym">type-environment?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">empty-tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv</span><span class="hspace">&nbsp;</span><span class="emph">...&#21516;&#21069;...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv-with-module</span><span class="hspace">&nbsp;</span><span class="emph">...&#21516;&#21069;...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv-with-type</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">t-name</span><span class="hspace">&nbsp;</span><span class="RktSym">symbol?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">type</span><span class="hspace">&nbsp;</span><span class="RktSym">type?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">saved-tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">type-environment?</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote><p>&#23427;&#28385;&#36275;&#26465;&#20214;&#65306;<span class="stt">type</span> &#24635;&#26159;&#19968;&#20010;&#23637;&#24320;&#31867;&#22411;&#12290;&#20687;<span class="stt">invariant</span>&#35752;&#35770;&#30340;&#65292;&#36825;&#20010;&#26465;&#20214;&#26159;
&#19968;<span class="emph">&#19981;&#21464;&#24335;</span>&#12290;</p></blockquote><p><a name="(idx._(gentag._1247))"></a>
&#25509;&#30528;&#25105;&#20204;&#20889;&#20986;&#20989;&#25968; <span class="stt">expand-type</span>&#65292;&#23427;&#21462;&#19968;&#20010;&#31867;&#22411;&#21644;&#19968;&#20010;&#31867;&#22411;&#29615;&#22659;&#65292;&#29992;&#21518;&#32773;&#20013;&#30340;&#32465;&#23450;&#23637;
&#24320;&#21069;&#32773;&#12290;&#26681;&#25454;&#19981;&#21464;&#24335;&#8220;&#32467;&#26524;&#31867;&#22411;&#24050;&#23637;&#24320;&#8221;&#65292;&#23427;&#22312;&#31867;&#22411;&#29615;&#22659;&#20013;&#26597;
&#35810;&#26377;&#21517;&#31867;&#22411;&#21644;&#21463;&#38480;&#31867;&#22411;&#65292;&#23545;<span class="stt">proc</span> &#31867;&#22411;&#65292;&#23427;&#36882;&#24402;&#22788;&#29702;&#21442;&#25968;&#21644;&#32467;&#26524;&#31867;&#22411;&#12290;</p><blockquote class="EoplCodeInset"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">expand-type</span></span> : <span class="texMathInline">\mathit{Type} \times \mathit{Tenv} \to \mathit{ExpandedType}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">expand-type</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ty</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">type</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int-type</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">int-type</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bool-type</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bool-type</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">proc-type</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">arg-type</span><span class="hspace">&nbsp;</span><span class="RktSym">result-type</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">proc-type</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-type</span><span class="hspace">&nbsp;</span><span class="RktSym">arg-type</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-type</span><span class="hspace">&nbsp;</span><span class="RktSym">result-type</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">named-type</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-type-name-in-tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">name</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">qualified-type</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">t-name</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-qualified-type-in-tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">t-name</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote><p>&#20026;&#20102;&#32500;&#25345;&#36825;&#19968;&#19981;&#21464;&#24335;&#65292;&#25105;&#20204;&#24517;&#39035;&#20445;&#35777;&#19981;&#35770;&#20309;&#26102;&#25193;&#23637;&#31867;&#22411;&#29615;&#22659;&#65292;&#37117;&#35201;&#35843;&#29992; <span class="stt">expand-type</span>&#12290;
&#36825;&#31181;&#22320;&#26041;&#26377;&#19977;&#22788;&#65306;</p><ul><li><p>&#22312;&#26816;&#26597;&#22120;&#20013;&#30340; <span class="stt">type-of</span> &#20869;&#65307;</p></li><li><p>&#29992; <span class="stt">defns-to-decls</span> &#22788;&#29702;&#31867;&#22411;&#23450;&#20041;&#21015;&#34920;&#20043;&#22788;&#65307;</p></li><li><p>&#22312; <span class="stt">add-module-defns-to-tenv</span> &#20013;&#65292;&#21521;&#31867;&#22411;&#29615;&#22659;&#28155;&#21152;&#27169;&#22359;&#20043;&#22788;&#12290;</p></li></ul><p>&#22312;&#26816;&#26597;&#22120;&#20013;&#65292;&#25105;&#20204;&#25226;&#24418;&#22914;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">extend-tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">sym</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></p></blockquote></blockquote><p>&#30340;&#35843;&#29992;&#26367;&#25442;&#20026;</p><blockquote class="EoplCodeInset"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">extend-tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">var</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-type</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></p></blockquote></blockquote></blockquote><p>&#22312; <span class="stt">defns-to-decls</span> &#20013;&#65292;&#24403;&#25105;&#20204;&#36935;&#21040;&#31867;&#22411;&#23450;&#20041;&#26102;&#65292;&#25105;&#20204;&#23637;&#24320;&#21491;&#36793;&#30340;&#23450;&#20041;&#65292;&#28982;&#21518;&#23558;&#20854;&#21152;
&#20837;&#31867;&#22411;&#29615;&#22659;&#20013;&#12290;<span class="stt">type-of</span> &#36820;&#22238;&#30340;&#31867;&#22411;&#19968;&#23450;&#26159;&#23637;&#24320;&#30340;&#65292;&#25152;&#20197;&#25105;&#20204;&#19981;&#38656;&#35201;&#20877;&#27425;&#23637;&#24320;&#23427;&#12290;&#30001;
&#20110;&#22312;&#27169;&#22359;&#20027;&#20307;&#20013;&#65292;&#25152;&#26377;&#31867;&#22411;&#32465;&#23450;&#37117;&#26159;&#36879;&#26126;&#30340;&#65292;&#25152;&#20197;&#25105;&#20204;&#25226;&#31867;&#22411;&#23450;&#20041;&#36716;&#25442;&#20026;&#36879;&#26126;&#31867;&#22411;&#22768;&#26126;&#12290;&#22312;
<span class="stt">add-module-defns-to-tenv</span> &#20013;&#65292;&#25105;&#20204;&#35843;&#29992; <span class="stt">extend-tenv-with-module</span>&#65292;&#23558;&#25509;&#21475;
&#28155;&#21152;&#21040;&#31867;&#22411;&#29615;&#22659;&#20013;&#12290;&#36825;&#37324;&#65292;&#25105;&#20204;&#38656;&#35201;&#23637;&#24320;&#25509;&#21475;&#65292;&#20197;&#30830;&#20445;&#23427;&#21253;&#21547;&#30340;&#25152;&#26377;&#31867;&#22411;&#37117;&#24050;&#23637;&#24320;&#12290;&#35201;&#23436;&#25104;
&#36825;&#19968;&#28857;&#65292;&#25105;&#20204;&#20462;&#25913; <span class="stt">add-module-defns-to-tenv</span>&#65292;&#35843;&#29992; <span class="stt">expand-iface</span>&#12290;
&#35265;<span class="EoplFigureRef"></span>&#12290;</p><p>&#36807;&#31243; <span class="stt">expand-iface</span>&#65288;<span class="EoplFigureRef"></span>&#65289;&#35843;&#29992; <span class="stt">expand-decls</span>&#12290;&#25105;&#20204;&#25552;&#21462;
&#20986;&#36825;&#20123;&#36807;&#31243;&#65292;&#20026;<a href="#%28part._s8..3%29" data-pltdoc="x">&#27169;&#22359;&#36807;&#31243;</a>&#20570;&#20934;&#22791;&#12290;</p><blockquote class="EoplFigure"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">defns-to-decls</span></span> : <span class="texMathInline">\mathit{Listof(Defn)} \times \mathit{Tenv} \to \mathit{Decl}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">defns-to-decls</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">null?</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">definition</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val-defn</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var-name</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">ty</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">type-of</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">new-env</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">var-name</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val-decl</span><span class="hspace">&nbsp;</span><span class="RktSym">var-name</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns-to-decls</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">new-env</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">type-defn</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">new-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv-with-type</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-type</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">transparent-type-decl</span><span class="hspace">&nbsp;</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns-to-decls</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">new-env</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span style="font-weight: bold"><span class="stt">add-module-defns-to-tenv</span></span> : <span class="texMathInline">\mathit{Listof(ModuleDefn)} \times \mathit{Tenv} \to \mathit{Tenv}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">add-module-defns-to-tenv</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">null?</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">tenv</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">module-definition</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a-module-definition</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">expected-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">actual-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">interface-of</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;:-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">actual-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">expected-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">new-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv-with-module</span><span class="hspace">&nbsp;</span><span class="RktSym">m-name</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">expected-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add-module-defns-to-tenv</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">new-env</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">report-module-doesnt-satisfy-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">expected-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">actual-iface</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><blockquote class="caption"><p>OPAQUE-TYPES &#30340;&#26816;&#26597;&#22120;&#65292;&#31532; 1 &#37096;&#20998;<a name="(elem._fig-8..9)"></a></p></blockquote></blockquote><blockquote class="EoplFigure"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">expand-iface</span></span> : <span class="texMathInline">\mathit{Sym} \times \mathit{Iface} \times \mathit{Tenv} \to \mathit{Iface}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">expand-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">iface</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">interface</span><span class="hspace">&nbsp;</span><span class="RktSym">iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decls</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-decls</span><span class="hspace">&nbsp;</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">decls</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span style="font-weight: bold"><span class="stt">expand-decls</span></span> : <span class="texMathInline">\mathit{Sym} \times \mathit{Listof(Decl)} \times \mathit{Tenv} \to \mathit{Listof(Decl)}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">expand-decls</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">decls</span><span class="hspace">&nbsp;</span><span class="RktSym">internal-tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">null?</span><span class="hspace">&nbsp;</span><span class="RktSym">decls</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">declaration</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">decls</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">opaque-type-decl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">t-name</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">expanded-type</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">qualified-type</span><span class="hspace">&nbsp;</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">t-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">new-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv-with-type</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">t-name</span><span class="hspace">&nbsp;</span><span class="RktSym">expanded-type</span><span class="hspace">&nbsp;</span><span class="RktSym">internal-tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">transparent-type-decl</span><span class="hspace">&nbsp;</span><span class="RktSym">t-name</span><span class="hspace">&nbsp;</span><span class="RktSym">expanded-type</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-decls</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">decls</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">new-env</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">transparent-type-decl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">t-name</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">expanded-type</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-type</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="hspace">&nbsp;</span><span class="RktSym">internal-tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">new-env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv-with-type</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">t-name</span><span class="hspace">&nbsp;</span><span class="RktSym">expanded-type</span><span class="hspace">&nbsp;</span><span class="RktSym">internal-tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">transparent-type-decl</span><span class="hspace">&nbsp;</span><span class="RktSym">t-name</span><span class="hspace">&nbsp;</span><span class="RktSym">expanded-type</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-decls</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">decls</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">new-env</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val-decl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var-name</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">expanded-type</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-type</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="hspace">&nbsp;</span><span class="RktSym">internal-tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val-decl</span><span class="hspace">&nbsp;</span><span class="RktSym">var-name</span><span class="hspace">&nbsp;</span><span class="RktSym">expanded-type</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-decls</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">decls</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">internal-tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><blockquote class="caption"><p>OPAQUE-TYPES &#30340;&#26816;&#26597;&#22120;&#65292;&#31532; 2 &#37096;&#20998;
<a name="(idx._(gentag._1248))"></a><a name="(elem._fig-8..10)"></a></p></blockquote></blockquote><p>&#36807;&#31243; <span class="stt">expand-decls</span> &#36941;&#21382;&#22768;&#26126;&#38598;&#21512;&#65292;&#21019;&#24314;&#26032;&#30340;&#31867;&#22411;&#29615;&#22659;&#65292;&#20854;&#20013;&#30340;&#27599;&#20010;&#31867;&#22411;&#21644;&#21464;&#37327;&#21517;&#37117;
&#32465;&#23450;&#21040;&#19968;&#20010;&#23637;&#24320;&#31867;&#22411;&#12290;&#40635;&#28902;&#20043;&#22788;&#26159;&#22768;&#26126;&#36981;&#24490; <span class="stt">let*</span> &#24335;&#20316;&#29992;&#22495;&#65306;&#38598;&#21512;&#20013;&#30340;&#27599;&#20010;&#22768;&#26126;&#30340;&#20316;
&#29992;&#22495;&#21253;&#21547;&#23427;&#20043;&#21518;&#30340;&#25152;&#26377;&#22768;&#26126;&#12290;
<a name="(idx._(gentag._1249))"></a></p><p>&#35201;&#26126;&#30333;&#36825;&#24847;&#21619;&#30528;&#20160;&#20040;&#65292;&#32771;&#34385;&#27169;&#22359;&#23450;&#20041;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module m1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">transparent u = int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">transparent uu = (t -&gt; u)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">% A &#22788;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">f : uu</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">...]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[...]</span></p></td></tr></table></blockquote><p>&#35201;&#28385;&#36275;&#19981;&#21464;&#24335;&#65292;&#31867;&#22411;&#29615;&#22659;&#20013;&#30340; <span class="stt">m1</span> &#24212;&#32465;&#23450;&#21040;&#21253;&#21547;&#22914;&#19979;&#22768;&#26126;&#30340;&#25509;&#21475;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">[transparent t = from m1 take t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">transparent u = int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">transparent uu = (from m1 take t -&gt; int)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">f : (from m1 take t -&gt; int)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">...]</span></p></td></tr></table></blockquote><p>&#21482;&#35201;&#25105;&#20204;&#36825;&#26679;&#20570;&#65292;&#19981;&#35770;&#20309;&#26102;&#25105;&#20204;&#20174;&#31867;&#22411;&#29615;&#22659;&#20013;&#26597;&#35810;&#31867;&#22411;&#26102;&#65292;&#24471;&#21040;&#30340;&#37117;&#26159;&#26399;&#26395;&#30340;&#23637;&#24320;&#31867;&#22411;&#12290;</p><p>&#22312; A &#22788;&#65292;&#32039;&#38543;&#22768;&#26126; <span class="stt">f</span> &#20043;&#21518;&#65292;&#31867;&#22411;&#29615;&#22659;&#24212;&#32465;&#23450;&#21040;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">t</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>&#32465;&#23450;&#21040;</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">from m1 take t</span></p></td></tr><tr><td><p><span class="stt">u</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>&#32465;&#23450;&#21040;</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">int</span></p></td></tr><tr><td><p><span class="stt">uu</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>&#32465;&#23450;&#21040;</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="stt">(from m1 take t -&gt; int)</span></p></td></tr></table></blockquote><p>&#25105;&#20204;&#25226;&#31867;&#20284;&#19978;&#38754; A &#22788;&#30340;&#31867;&#22411;&#29615;&#22659;&#31216;&#20026;<span class="emph">&#20869;&#37096;</span>&#31867;&#22411;&#29615;&#22659;&#12290;&#23427;&#20316;&#20026;&#21442;&#25968;&#20256;&#32473;
<span class="stt">expand-decls</span>&#12290;</p><p>&#29616;&#22312;&#25105;&#20204;&#21487;&#20197;&#20889;&#20986; <span class="stt">expand-decls</span>&#12290;&#20687; <span class="stt">defns-to-decls</span>&#65292;&#36825;&#20010;&#36807;&#31243;&#21482;&#21019;&#24314;&#36879;&#26126;&#22768;
&#26126;&#65292;&#22240;&#20026;&#23427;&#30340;&#29992;&#36884;&#23601;&#26159;&#21019;&#24314;&#26597;&#35810;&#21463;&#38480;&#31867;&#22411;&#25152;&#29992;&#30340;&#25968;&#25454;&#32467;&#26500;&#12290;</p><p>&#26368;&#21518;&#65292;&#25105;&#20204;&#20462;&#25913; <span class="stt">&lt;:-decls</span>&#65292;&#22788;&#29702;&#20004;&#31181;&#26032;&#22768;&#26126;&#12290;&#25105;&#20204;&#24517;&#39035;&#22788;&#29702;&#22768;&#26126;&#38598;&#21512;&#20869;&#37096;&#30340;&#20316;&#29992;&#22495;&#20851;
&#31995;&#12290;&#20363;&#22914;&#65292;&#22914;&#26524;&#25105;&#20204;&#27604;&#36739;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">[transparent t = int</span></p></td></tr><tr><td><p><span class="stt">x : bool</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">&lt;:</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[y : int]</span></p></td></tr><tr><td><p><span class="stt">y : t]</span></p></td></tr></table></blockquote><p>&#22788;&#29702;&#22768;&#26126; <span class="stt">y</span> &#26102;&#65292;&#25105;&#20204;&#38656;&#35201;&#30693;&#36947; <span class="stt">t</span> &#25351;&#20195; <span class="stt">int</span> &#31867;&#22411;&#12290;&#25152;&#20197;&#65292;&#24403;&#25105;&#20204;&#36882;&#24402;&#21521;&#19979;
&#22788;&#29702;&#22768;&#26126;&#21015;&#34920;&#26102;&#65292;&#25105;&#20204;&#38656;&#35201;&#38543;&#20043;&#25193;&#23637;&#31867;&#22411;&#29615;&#22659;&#65292;&#23601;&#20687;&#22312; <span class="stt">expand-decls</span> &#20013;&#29983;&#25104;
<span class="stt">internal-tenv</span> &#19968;&#26679;&#12290;&#25105;&#20204;&#35843;&#29992; <span class="stt">extend-tenv-with-decl</span> &#22788;&#29702;&#36825;&#20123;&#65292;&#23427;&#21462;&#19968;&#22768;
&#26126;&#65292;&#26681;&#25454;&#31867;&#22411;&#29615;&#22659;&#23558;&#20854;&#23637;&#24320;&#20026;&#36866;&#24403;&#30340;&#31867;&#22411;&#65288;<span class="EoplFigureRef"></span>&#65289;&#12290;</p></blockquote><blockquote class="EoplFigure"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">&lt;:-decls</span></span> : <span class="texMathInline">\mathit{Listof(Decl)} \times \mathit{Listof(Decl)} \times \mathit{Tenv} \to \mathit{Bool}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;:-decls</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decls1</span><span class="hspace">&nbsp;</span><span class="RktSym">decls2</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cond</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">null?</span><span class="hspace">&nbsp;</span><span class="RktSym">decls2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">null?</span><span class="hspace">&nbsp;</span><span class="RktSym">decls1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">else</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">name1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decl-&gt;name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">decls1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decl-&gt;name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">decls2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eqv?</span><span class="hspace">&nbsp;</span><span class="RktSym">name1</span><span class="hspace">&nbsp;</span><span class="RktSym">name2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">and</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;:-decl</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">decls1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">decls2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;:-decls</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">decls1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">decls2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv-with-decl</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">decls1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;:-decls</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cdr</span><span class="hspace">&nbsp;</span><span class="RktSym">decls1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">decls2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv-with-decl</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">car</span><span class="hspace">&nbsp;</span><span class="RktSym">decls1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span style="font-weight: bold"><span class="stt">extend-tenv-with-decl</span></span> : <span class="texMathInline">\mathit{Decl} \times \mathit{Tenv} \to \mathit{Tenv}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">extend-tenv-with-decl</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decl</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">declaration</span><span class="hspace">&nbsp;</span><span class="RktSym">decl</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val-decl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">transparent-type-decl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv-with-type</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">name</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-type</span><span class="hspace">&nbsp;</span><span class="RktSym">ty</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">opaque-type-decl</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv-with-type</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">name</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">qualified-type</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fresh-module-name</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">%unknown</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">name</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><blockquote class="caption"><p>OPAQUE-TYPES &#30340;&#26816;&#26597;&#22120;&#65292;&#31532; 3 &#37096;&#20998;
<a name="(idx._(gentag._1250))"></a><a name="(elem._fig-8..11)"></a></p></blockquote></blockquote><p>&#22312;&#23637;&#24320;&#36807;&#31243;&#20013;&#65292;&#25105;&#20204;&#24635;&#26159;&#29992; <span class="stt">decls1</span>&#12290;&#27442;&#30693;&#20854;&#21407;&#22240;&#65292;&#32771;&#34385;&#27604;&#36739;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">[transparent t = int</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">[opaque t</span></p></td></tr><tr><td><p><span class="stt">transparent u = (t -&gt; t)</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&lt;:</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">transparent u = (t -&gt; int)</span></p></td></tr><tr><td><p><span class="stt">f : (t -&gt; u)]</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">f : (t -&gt; (int -&gt; int))]</span></p></td></tr></table></blockquote><p>&#36825;&#19968;&#27604;&#36739;&#24212;&#35813;&#36890;&#36807;&#65292;&#22240;&#20026;&#24403;&#27169;&#22359;&#20027;&#20307;&#25552;&#20379;&#24038;&#20391;&#30340;&#32465;&#23450;&#26102;&#65292;&#20063;&#26159;&#21491;&#20391;&#25509;&#21475;&#30340;&#27491;&#30830;&#23454;&#29616;&#12290;</p><p>&#27604;&#36739;&#31867;&#22411; <span class="stt">u</span> &#30340;&#20004;&#20010;&#23450;&#20041;&#26102;&#65292;&#25105;&#20204;&#24471;&#30693;&#36947;&#31867;&#22411; <span class="stt">t</span> &#23454;&#38469;&#19978;&#26159; <span class="stt">int</span>&#12290;&#21363;&#20351;&#24038;&#36793;
&#30340;&#22768;&#26126;&#27809;&#26377;&#20986;&#29616;&#22312;&#21491;&#36793;&#65292;&#21516;&#26679;&#30340;&#25216;&#24039;&#20063;&#36866;&#29992;&#65292;&#23601;&#20687;&#19978;&#38754;&#31532;&#19968;&#20010;&#20363;&#23376;&#20013;&#30340;&#22768;&#26126; <span class="stt">t</span> &#25152;&#23637;&#31034;
&#30340;&#12290;&#25105;&#20204;&#35843;&#29992; <span class="stt">expand-type</span> &#26469;&#32500;&#25345;&#19981;&#21464;&#24335;&#8220;&#31867;&#22411;&#29615;&#22659;&#20013;&#30340;&#25152;&#26377;&#31867;&#22411;&#22343;
&#24050;&#23637;&#24320;&#8221;&#12290;<span class="stt">extend-tenv-with-decl</span> &#26368;&#21518;&#19968;&#21477;&#20013;&#36873;&#20160;&#20040;&#27169;&#22359;&#21517;&#26080;&#20851;&#32039;&#35201;&#65292;
&#22240;&#20026;&#21463;&#38480;&#31867;&#22411;&#25903;&#25345;&#30340;&#21807;&#19968;&#25805;&#20316;&#26159; <span class="stt">equal?</span>&#12290;&#25152;&#20197;&#29992; <span class="stt">fresh-module-name</span> &#36275;&#20197;&#20445;&#35777;
&#36825;&#19968;&#21463;&#38480;&#31867;&#22411;&#26159;&#26032;&#29983;&#25104;&#30340;&#12290;</p><p>&#29616;&#22312;&#26469;&#22788;&#29702;&#20851;&#38190;&#38382;&#39064;&#65306;&#22914;&#20309;&#27604;&#36739;&#22768;&#26126;&#65311;&#20165;&#24403;&#20108;&#32773;&#20351;&#29992;&#30456;&#21516;&#30340;&#21517;&#23383;&#65288;&#21464;&#37327;&#25110;&#31867;&#22411;&#65289;&#26102;&#65292;&#22768;&#26126;&#25165;
&#33021;&#21305;&#37197;&#12290;&#22914;&#26524;&#19968;&#23545;&#22768;&#26126;&#21516;&#21517;&#65292;&#26377;&#22235;&#31181;&#21305;&#37197;&#26041;&#24335;&#65306;</p><ul><li><p>&#20108;&#32773;&#22343;&#20026;&#20540;&#22768;&#26126;&#65292;&#19988;&#31867;&#22411;&#21305;&#37197;&#12290;</p></li><li><p>&#20108;&#32773;&#22343;&#20026;&#27169;&#31946;&#31867;&#22411;&#22768;&#26126;&#12290;</p></li><li><p>&#20108;&#32773;&#22343;&#20026;&#36879;&#26126;&#31867;&#22411;&#22768;&#26126;&#65292;&#19988;&#23450;&#20041;&#21305;&#37197;&#12290;</p></li><li><p><span class="stt">decl1</span> &#20026;&#36879;&#26126;&#31867;&#22411;&#22768;&#26126;&#65292;<span class="stt">decl2</span> &#20026;&#27169;&#31946;&#31867;&#22411;&#22768;&#26126;&#12290;&#20363;&#22914;&#65292;&#20551;&#35774;&#26377;&#20010;&#27169;&#22359;
&#30340;&#25509;&#21475;&#22768;&#26126;&#20102; <span class="stt">opaque t</span>&#65292;&#20027;&#20307;&#20013;&#30340;&#23450;&#20041;&#20026; <span class="stt">type t = int</span>&#65292;&#24212;&#24403;&#25509;&#21463;&#36825;&#31181;&#20570;&#27861;&#12290;
&#36807;&#31243; <span class="stt">defns-to-decls</span> &#23558;&#23450;&#20041; <span class="stt">type t = int</span> &#36716;&#25442;&#20026;&#36879;&#26126;&#31867;&#22411;&#22768;&#26126;&#65292;&#25152;&#20197;
<span class="stt">add-module-defns-to-tenv</span> &#20013;&#30340;&#26465;&#20214;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">actual-iface &lt;: expected-iface</span></p></td></tr></table></blockquote><p>&#38656;&#35201;&#26816;&#26597;
<span class="texMathDisplay"><span class="stt">(transparent </span><span class="texMathInline">t</span><span class="stt"> = int)</span> &lt;: <span class="stt">(opaque </span><span class="texMathInline">t</span><span class="stt">)</span></span>
&#26159;&#21542;&#25104;&#31435;&#12290;</p><p>&#30001;&#20110;&#36825;&#19968;&#27169;&#22359;&#24212;&#34987;&#25509;&#21463;&#65292;&#35813;&#39033;&#27979;&#35797;&#24212;&#36820;&#22238;&#30495;&#12290;</p><p>&#36825;&#21578;&#35785;&#25105;&#20204;&#65292;&#31867;&#22411;&#24050;&#30693;&#30340;&#23545;&#35937;&#24635;&#33021;&#20316;&#20026;&#31867;&#22411;&#26410;&#30693;&#30340;&#23545;&#35937;&#12290;&#21453;&#20043;&#21017;&#19981;&#28982;&#12290;&#20363;&#22914;&#65292;
<span class="texMathDisplay"><span class="stt">(opaque </span><span class="texMathInline">t</span><span class="stt">)</span> &lt;: <span class="stt">(transparent </span><span class="texMathInline">t</span><span class="stt"> = int)</span></span>
&#24212;&#20026;&#20551;&#65292;&#22240;&#20026;&#27169;&#31946;&#31867;&#22411;&#20540;&#30340;&#23454;&#38469;&#31867;&#22411;&#21487;&#33021;&#19981;&#26159; <span class="stt">int</span>&#65292;&#32780;&#19988;&#28385;&#36275; <span class="stt">opaque t</span> &#30340;&#27169;
&#22359;&#21487;&#33021;&#26080;&#27861;&#28385;&#36275; <span class="stt">transparent t = int</span>&#12290;</p></li></ul><p><div class="SIntrapara">&#36825;&#26679;&#65292;&#25105;&#20204;&#23601;&#24471;&#20986;<span class="EoplFigureRef"></span> &#20013;&#30340;&#20195;&#30721;&#12290;<span class="stt">equiv-type?</span> &#30340;&#23450;&#20041;&#25193;&#23637;&#20854;&#31867;
&#22411;&#65292;&#25152;&#20197;&#65292;&#22312;&#19978;&#38754;&#30340;&#20363;&#23376;
</div><div class="SIntrapara"><blockquote class="Small"><blockquote class="SCentered"><p><span class="stt">[transparent t = int x : bool y : t] &lt;: [y : int]</span></p></blockquote></blockquote></div><div class="SIntrapara"><blockquote class="SubFlow"><p>&#20013;&#65292;&#24038;&#36793;&#30340; <span class="stt">t</span> &#23637;&#24320;&#20026; <span class="stt">int</span>&#65292;&#21305;&#37197;&#25104;&#21151;&#12290;
<a name="(idx._(gentag._1251))"></a>
<a name="(idx._(gentag._1252))"></a></p></blockquote></div></p><blockquote class="EoplExercise"><p><a name="(elem._ex8..16)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span><a name="(idx._(gentag._1253))"></a>
<a name="(idx._(gentag._1254))"></a>
<a name="(idx._(gentag._1255))"></a>
&#29992;<span class="EoplExerciseRef"></span> &#20013;&#30340;&#35821;&#35328;&#25193;&#23637;&#26412;&#33410;&#30340;&#31995;&#32479;&#65292;&#28982;&#21518;&#37325;&#20889;<span class="EoplExerciseRef"></span>&#65292;
&#29992;&#22810;&#21442;&#25968;&#36807;&#31243;&#20195;&#26367;&#36820;&#22238;&#36807;&#31243;&#30340;&#36807;&#31243;&#12290;
<a name="(idx._(gentag._1256))"></a>
<a name="(idx._(gentag._1257))"></a>
<a name="(idx._(gentag._1258))"></a></p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..17)"></a><span class="texMathInline">\textnormal{[}{\star}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#20223;&#29031;<span class="EoplExerciseRef"></span>&#65292;&#20801;&#35768;&#27169;&#22359;&#20197;&#19981;&#21516;&#20110;&#25509;&#21475;&#22768;&#26126;&#30340;&#39034;&#24207;&#20135;&#29983;&#20540;&#12290;&#20294;&#26159;&#35760;&#20303;&#65292;&#23450;&#20041;&#8212;&#8212;
&#23588;&#20854;&#26159;&#31867;&#22411;&#30340;&#23450;&#20041;&#8212;&#8212;&#24517;&#39035;&#36981;&#23432;&#23450;&#30028;&#35268;&#21017;&#12290;</p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..18)"></a><span class="texMathInline">\textnormal{[}{\star}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#25105;&#20204;&#20195;&#30721;&#20381;&#36182;&#30340;&#19981;&#21464;&#24335;&#26159;&#65306;&#31867;&#22411;&#29615;&#22659;&#20013;&#30340;&#25152;&#26377;&#31867;&#22411;&#22343;&#24050;&#23637;&#24320;&#12290;&#25105;&#20204;&#22312;&#20195;&#30721;&#20013;&#22810;&#27425;&#35843;&#29992;
<span class="stt">expand-type</span> &#26469;&#32500;&#25345;&#36825;&#19968;&#19981;&#21464;&#24335;&#12290;&#36825;&#23601;&#24456;&#23481;&#26131;&#22240;&#24536;&#35760;&#35843;&#29992; <span class="stt">expand-type</span> &#32780;&#30772;&#22351;
&#31995;&#32479;&#12290;&#37325;&#26500;&#20195;&#30721;&#65292;&#20943;&#23569; <span class="stt">expand-type</span> &#30340;&#35843;&#29992;&#65292;&#20197;&#20415;&#26356;&#31283;&#23450;&#22320;&#32500;&#25345;&#19981;&#21464;&#24335;&#12290;
<a name="(idx._(gentag._1259))"></a></p></blockquote><blockquote class="EoplFigure"><p><div class="SIntrapara">[!ht]</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">&lt;:-decl</span></span> : <span class="texMathInline">\mathit{Decl} \times \mathit{Decl} \times \mathit{Tenv} \to \mathit{Bool}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;:-decl</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decl1</span><span class="hspace">&nbsp;</span><span class="RktSym">decl2</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">or</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">and</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val-decl?</span><span class="hspace">&nbsp;</span><span class="RktSym">decl1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">val-decl?</span><span class="hspace">&nbsp;</span><span class="RktSym">decl2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">equiv-type?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decl-&gt;type</span><span class="hspace">&nbsp;</span><span class="RktSym">decl1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decl-&gt;type</span><span class="hspace">&nbsp;</span><span class="RktSym">decl2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">and</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">transparent-type-decl?</span><span class="hspace">&nbsp;</span><span class="RktSym">decl1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">transparent-type-decl?</span><span class="hspace">&nbsp;</span><span class="RktSym">decl2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">equiv-type?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decl-&gt;type</span><span class="hspace">&nbsp;</span><span class="RktSym">decl1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decl-&gt;type</span><span class="hspace">&nbsp;</span><span class="RktSym">decl2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">and</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">transparent-type-decl?</span><span class="hspace">&nbsp;</span><span class="RktSym">decl1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">opaque-type-decl?</span><span class="hspace">&nbsp;</span><span class="RktSym">decl2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">and</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">opaque-type-decl?</span><span class="hspace">&nbsp;</span><span class="RktSym">decl1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">opaque-type-decl?</span><span class="hspace">&nbsp;</span><span class="RktSym">decl2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span style="font-weight: bold"><span class="stt">equiv-type?</span></span> : <span class="texMathInline">\mathit{Type} \times \mathit{Type} \times \mathit{Tenv} \to \mathit{Bool}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">equiv-type?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ty1</span><span class="hspace">&nbsp;</span><span class="RktSym">ty2</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">equal?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-type</span><span class="hspace">&nbsp;</span><span class="RktSym">ty1</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-type</span><span class="hspace">&nbsp;</span><span class="RktSym">ty2</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><blockquote class="caption"><p>OPAQUE-TYPES &#30340;&#26816;&#26597;&#22120;&#65292;&#31532; 4 &#37096;&#20998;
<a name="(idx._(gentag._1260))"></a>
<a name="(idx._(gentag._1261))"></a>
<a name="(idx._(gentag._1262))"></a><a name="(elem._fig-8..12)"></a></p></blockquote></blockquote><h4>8.3<tt>&nbsp;</tt><a name="(part._s8..3)"></a>&#27169;&#22359;&#36807;&#31243;</h4><p><a name="(idx._(gentag._1263))"></a>
<a name="(idx._(gentag._1264))"></a>
<a name="(idx._(gentag._1265))"></a>
<a name="(idx._(gentag._1266))"></a>
OPAQUE-TYPES &#20013;&#30340;&#31243;&#24207;&#26377;&#22266;&#23450;&#30340;&#20381;&#36182;&#20851;&#31995;&#12290;&#27169;&#22359; <span class="stt">m4</span> &#21487;&#33021;&#20381;&#36182; <span class="stt">m3</span> &#21644; <span class="stt">m2</span>&#65292;
<span class="stt">m2</span> &#20381;&#36182; <span class="stt">m1</span>&#12290;&#26377;&#26102;&#65292;&#25105;&#20204;&#35828;&#20381;&#36182;&#20851;&#31995;&#26159;<span class="emph">&#30828;&#32534;&#30721;</span> (<span class="emph">hard-coded</span>) &#30340;&#12290;&#36890;&#24120;&#65292;
&#36825;&#31181;&#30828;&#32534;&#30721;&#30340;&#20381;&#36182;&#20851;&#31995;&#20250;&#23548;&#33268;&#31967;&#31957;&#30340;&#31243;&#24207;&#35774;&#35745;&#65292;&#22240;&#20026;&#36825;&#20351;&#27169;&#22359;&#38590;&#20197;&#22797;&#29992;&#12290;&#26412;&#33410;&#65292;&#25105;&#20204;&#32473;&#31995;&#32479;
&#28155;&#21152;&#21517;&#20026;<span class="emph">&#27169;&#22359;&#36807;&#31243;</span> (<span class="emph">module procedure</span>)&#65288;&#26377;&#26102;&#21448;&#31216;<span class="emph">&#21442;&#25968;&#21270;&#27169;&#22359;</span> (<span class="emph">parameterized
module</span>)&#65289;&#30340;&#32452;&#20214;&#65292;&#20197;&#20415;&#22797;&#29992;&#27169;&#22359;&#12290;&#25105;&#20204;&#31216;&#36825;&#31181;&#26032;&#35821;&#35328;&#20026;PROC-MODULES&#12290;</p><h5>8.3.1<tt>&nbsp;</tt><a name="(part._s8..3..1)"></a>&#20363;&#23376;</h5><p>&#20877;&#26469;&#30475;&#25105;&#20204;&#30340;&#19977;&#20301;&#24320;&#21457;&#32773;&#12290;&#26597;&#29702;&#24819;&#29992;&#29233;&#20029;&#19997;&#27169;&#22359;&#30340;&#26576;&#20123;&#32452;&#20214;&#12290;&#20294;&#29233;&#20029;&#19997;&#30340;&#27169;&#22359;&#20351;&#29992;&#20102;&#40077;&#20271;&#27169;
&#22359;&#25552;&#20379;&#30340;&#25968;&#25454;&#24211;&#65292;&#32780;&#26597;&#29702;&#24819;&#29992;&#21478;&#19968;&#25968;&#25454;&#24211;&#65292;&#30001;&#20854;&#20182;&#27169;&#22359;&#25552;&#20379;&#65288;&#25140;&#23433;&#23068;&#25152;&#20889;&#65289;&#12290;</p><p>&#35201;&#23454;&#29616;&#36825;&#20123;&#65292;&#29233;&#20029;&#19997;&#29992;&#27169;&#22359;&#36807;&#31243;&#37325;&#20889;&#22905;&#30340;&#20195;&#30721;&#12290;&#27169;&#22359;&#36807;&#31243;&#23601;&#20687;&#36807;&#31243;&#65292;&#20294;&#23427;&#22788;&#29702;&#30340;&#26159;&#27169;&#22359;&#65292;&#32780;
&#38750;&#34920;&#36798;&#20540;&#12290;&#22312;&#27169;&#22359;&#23618;&#38754;&#19978;&#65292;&#25509;&#21475;&#23601;&#20687;&#31867;&#22411;&#12290;&#23601;&#20687; CHECKED &#20013;&#30340;&#36807;&#31243;&#31867;&#22411;&#25351;&#23450;&#21442;&#25968;&#21644;&#32467;&#26524;&#31867;
&#22411;&#65292;&#27169;&#22359;&#36807;&#31243;&#30340;&#25509;&#21475;&#25351;&#23450;&#21442;&#25968;&#30340;&#25509;&#21475;&#21644;&#32467;&#26524;&#30340;&#25509;&#21475;&#12290;</p><p>&#29233;&#20029;&#19997;&#20889;&#20986;&#26032;&#30340;&#27169;&#22359; <span class="stt">Alices-point-builder</span>&#65292;&#24320;&#22836;&#20026;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module Alices-point-builder</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">((database : [opaque db-type</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">opaque node-type</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">insert-node : (node-type -&gt;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(db-type -&gt; db-type))</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">...])</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">=&gt; [opaque point</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">initial-point : (int -&gt; point)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">...])</span></p></td></tr></table></blockquote><p>&#36825;&#22871;&#25509;&#21475;&#35828;&#30340;&#26159;&#65292;<span class="stt">Alices-point-builder</span> &#26159;&#19968;&#27169;&#22359;&#36807;&#31243;&#12290;&#23427;&#26399;&#26395;&#30340;&#21442;&#25968;&#26159;&#19968;&#20010;&#27169;&#22359;&#65292;
&#35813;&#27169;&#22359;&#36755;&#20986;&#20004;&#20010;&#31867;&#22411;&#65292;<span class="stt">db-type</span> &#21644; <span class="stt">node-type</span>&#65292;&#19968;&#20010;&#36807;&#31243;&#65292;<span class="stt">insert-node</span>&#65292;
&#21487;&#33021;&#36824;&#26377;&#20854;&#20182;&#19968;&#20123;&#20540;&#12290;&#32473;&#23450;&#36825;&#20010;&#27169;&#22359;&#65292;<span class="stt">Alices-point-builder</span> &#24212;&#29983;&#25104;&#19968;&#20010;&#27169;&#22359;&#65292;&#29983;&#25104;
&#30340;&#27169;&#22359;&#36755;&#20986;&#27169;&#31946;&#31867;&#22411; <span class="stt">point</span>&#65292;&#36807;&#31243; <span class="stt">initial-point</span>&#65292;&#36824;&#21487;&#33021;&#26377;&#20854;&#20182;&#19968;&#20123;&#20540;&#12290;
<span class="stt">Alices-point-builder</span> &#30340;&#25509;&#21475;&#36824;&#25351;&#23450;&#20102;&#21442;&#25968;&#30340;&#23616;&#37096;&#21517;&#31216;&#65307;&#31245;&#21518;&#25105;&#20204;&#23558;&#30475;&#21040;&#20026;&#20309;&#38656;&#35201;&#23427;&#12290;</p><p>&#29233;&#20029;&#19997;&#30340;&#26032;&#27169;&#22359;&#20027;&#20307;&#24320;&#22836;&#20026;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">module-proc (m : [opaque db-type</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">opaque node-type</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">insert-node : (node-type -&gt;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(db-type -&gt; db-type))</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">...])</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[type point = ...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">initial-point = ... from m take insert-node ...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">...]</span></p></td></tr></table></blockquote><p>&#23601;&#20687;&#19968;&#33324;&#30340;&#36807;&#31243;&#34920;&#36798;&#24335;&#24418;&#22914;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">proc (</span><span class="texMathInline">var</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">: </span><span class="texMathInline">t</span><span class="stt">) </span><span class="texMathInline">e</span></p></td></tr></table></blockquote><p>&#27169;&#22359;&#36807;&#31243;&#24418;&#22914;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module-proc (</span><span class="texMathInline">m</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">: [...]) [...]</span></p></td></tr></table></blockquote></blockquote><p>&#26412;&#20363;&#20013;&#65292;&#29233;&#20029;&#19997;&#36873;&#25321; <span class="stt">m</span> &#20316;&#20026;&#27169;&#22359;&#36807;&#31243;&#20013;&#32465;&#23450;&#21464;&#37327;&#30340;&#21517;&#23383;&#65307;&#23427;&#19981;&#24517;&#21644;&#25509;&#21475;&#20013;&#30340;&#23616;&#37096;&#21517;&#23383;
&#30456;&#21516;&#12290;&#25105;&#20204;&#38656;&#35201;&#20877;&#20889;&#19968;&#36941;&#21442;&#25968;&#30340;&#25509;&#21475;&#65292;&#22240;&#20026;&#27169;&#22359;&#25509;&#21475;&#30340;&#20316;&#29992;&#22495;&#19981;&#21253;&#21547;&#27169;&#22359;&#20027;&#20307;&#12290;&#21487;&#20197;&#20813;&#38500;&#36825;
&#19968;&#38480;&#21046;&#65288;&#35265;<span class="EoplExerciseRef"></span>&#65289;&#12290;</p><p>&#29616;&#22312;&#65292;&#29233;&#20029;&#19997;&#25226;&#22905;&#30340;&#27169;&#22359;&#37325;&#20889;&#20026;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module Alices-points</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[opaque point</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">initial-point : (int -&gt; point)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">...]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(Alices-point-builder Bobs-db-module)</span></p></td></tr></table></blockquote><p>&#26597;&#29702;&#30340;&#27169;&#22359;&#20889;&#25104;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module Charlies-points</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[opaque point</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">initial-point : (int -&gt; point)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">...]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(Alices-point-builder Dianas-db-module)</span></p></td></tr></table></blockquote></blockquote><p>&#27169;&#22359; <span class="stt">Alices-points</span> &#20351;&#29992; <span class="stt">Bobs-db-module</span> &#22788;&#29702;&#25968;&#25454;&#24211;&#12290;&#27169;&#22359;
<span class="stt">Charlies-points</span> &#20351;&#29992; <span class="stt">Dianas-db-module</span> &#22788;&#29702;&#25968;&#25454;&#24211;&#12290;&#36825;&#26679;&#32452;&#32455;&#21487;&#20197;&#22797;&#29992;
<span class="stt">Alices-point-builder</span> &#20013;&#30340;&#20195;&#30721;&#12290;&#36825;&#19981;&#20165;&#36991;&#20813;&#20102;&#20889;&#20004;&#27425;&#21516;&#26679;&#30340;&#20195;&#30721;&#65292;&#32780;&#19988;&#65292;&#22312;&#20195;&#30721;&#38656;
&#35201;&#21464;&#21160;&#26102;&#65292;&#21487;&#20197;&#21482;&#25913;&#19968;&#22788;&#65292;&#33258;&#21160;&#20256;&#25773;&#21040; <span class="stt">Alices-point</span> &#21644; <span class="stt">Charlies-points</span> &#20013;&#12290;</p><p>&#21478;&#19968;&#20010;&#20363;&#23376;&#65292;&#32771;&#34385;<span class="EoplExampleRef"></span> &#21644;<span class="EoplExampleRef"></span>&#12290;&#22312;&#36825;&#20004;&#20010;&#20363;&#23376;&#20013;&#65292;
&#25105;&#20204;&#29992;&#22522;&#26412;&#30456;&#21516;&#30340;&#20195;&#30721;&#20889; <span class="stt">to-int</span>&#12290;&#22312;<span class="EoplExampleRef"></span> &#20013;&#23427;&#26159;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">letrec int to-int (x : from ints1 take t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">= if (z? x)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">then 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">else -((to-int (p x)), -1)</span></p></td></tr></table></blockquote><p>&#22312;<span class="EoplExampleRef"></span> &#20013;&#65292;<span class="stt">x</span> &#30340;&#31867;&#22411;&#26159; <span class="stt">from ints2 take t</span>&#12290;&#25152;&#20197;&#25105;&#20204;&#37325;&#20889;
&#20026;&#21442;&#25968;&#21270;&#30340;&#27169;&#22359;&#65292;&#21442;&#25968;&#27169;&#22359;&#20135;&#29983;&#25152;&#38656;&#30340;&#25972;&#25968;&#12290;</p></blockquote><blockquote class="EoplExample"><p><a name="(elem._eg-8..14)"></a>&#22768;&#26126;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module to-int-maker</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">((ints : [opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">zero : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">succ : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">pred : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">is-zero : (t -&gt; bool)])</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">=&gt; [to-int : (from ints take t -&gt; int)])</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">module-proc (ints : [opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">zero : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">succ : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">pred : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">is-zero : (t -&gt; bool)])</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">[to-int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">= let z? = from ints take is-zero</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">in let p = from ints take pred</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">in letrec int to-int (x : from ints take t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">= if (z? x)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">then 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">else -((to-int (p x)), -1)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">in to-int]</span></p></td></tr></table></blockquote><p>&#23450;&#20041;&#20102;&#19968;&#20010;&#27169;&#22359;&#36807;&#31243;&#12290;&#36825;&#22871;&#25509;&#21475;&#35828;&#30340;&#26159;&#65292;&#35813;&#27169;&#22359;&#21462;&#27169;&#22359; <span class="stt">ints</span>&#65292;&#29983;&#25104;&#21478;&#19968;&#27169;&#22359;&#65307;
<span class="stt">ints</span> &#23454;&#29616;&#31639;&#26415;&#25805;&#20316;&#30340;&#25509;&#21475;&#65292;&#29983;&#25104;&#30340;&#27169;&#22359;&#36755;&#20986;&#36807;&#31243; <span class="stt">to-int</span>&#65292;&#23558; <span class="stt">ints</span> &#20013;&#30340;
&#31867;&#22411; <span class="stt">t</span> &#36716;&#25442;&#20026;&#25972;&#25968;&#12290;&#24471;&#20986;&#30340;&#36807;&#31243; <span class="stt">to-int</span> &#19981;&#33021;&#20381;&#36182;&#31639;&#26415;&#25805;&#20316;&#30340;&#23454;&#29616;&#65292;&#22240;&#20026;&#25105;&#20204;
&#26681;&#26412;&#19981;&#30693;&#36947;&#23454;&#29616;&#26159;&#20160;&#20040;&#65281;&#36825;&#27573;&#20195;&#30721;&#20013;&#65292;<span class="stt">ints</span> &#22768;&#26126;&#20102;&#20004;&#27425;&#65306;&#19968;&#27425;&#22312;&#25509;&#21475;&#20013;&#65292;&#19968;&#27425;&#22312;&#20027;&#20307;
&#20013;&#12290;&#20687;&#25105;&#20204;&#20043;&#21069;&#35828;&#30340;&#65292;&#36825;&#26159;&#22240;&#20026;&#25509;&#21475;&#22768;&#26126;&#30340;&#20316;&#29992;&#22495;&#21482;&#38480;&#20110;&#25509;&#21475;&#65292;&#19981;&#21253;&#21547;&#27169;&#22359;&#20027;&#20307;&#12290;</p></blockquote></blockquote><p>&#25105;&#20204;&#20877;&#26469;&#30475;&#20351;&#29992; <span class="stt">to-int</span> &#30340;&#19968;&#20123;&#20363;&#23376;&#65306;</p><blockquote class="EoplExample"><p><div class="SIntrapara"><a name="(elem._eg-8..15)"></a>
</div><div class="SIntrapara"><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module to-int-maker </span><span class="emph">...&#21516;&#21069;...</span><span class="stt"></span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">module ints1 </span><span class="emph">...&#21516;&#21069;...</span><span class="stt"></span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">module ints1-to-int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface [to-int : (from ints1 take t -&gt; int)]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(to-int-maker ints1)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">let two1 = (from ints1 take succ</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(from ints1 take succ</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">from ints1 take zero))</span></p></td></tr><tr><td><p><span class="stt">in (from ints1-to-int take to-int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">two1)</span></p></td></tr></table></blockquote><p>&#31867;&#22411;&#20026; <span class="stt">int</span>&#65292;&#20540;&#20026; 2&#12290;&#22240;&#20026;&#25105;&#20204;&#39318;&#20808;&#23450;&#20041;&#20102;&#27169;&#22359; <span class="stt">to-int-maker</span> &#21644; <span class="stt">ints1</span>&#12290;
&#28982;&#21518;&#25105;&#20204;&#29992; <span class="stt">ints1</span> &#35843;&#29992; <span class="stt">to-int-maker</span>&#65292;&#24471;&#21040;&#27169;&#22359; <span class="stt">ints1-to-int</span>&#65292;&#23427;&#36755;&#20986;
&#32465;&#23450; <span class="stt">from ints1-to-int take to-int</span>&#12290;</p></blockquote></div></p></blockquote><p>&#19979;&#38754;&#36825;&#20010;&#20363;&#23376;&#20004;&#27425;&#20351;&#29992; <span class="stt">to-int-maker</span>&#65292;&#22788;&#29702;&#20004;&#31181;&#19981;&#21516;&#30340;&#31639;&#26415;&#25805;&#20316;&#23454;&#29616;&#12290;</p><blockquote class="EoplExample"><p><div class="SIntrapara"><a name="(elem._eg-8..16)"></a>
</div><div class="SIntrapara"><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module to-int-maker </span><span class="emph">...&#21516;&#21069;...</span><span class="stt"></span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">module ints1 </span><span class="emph">...&#21516;&#21069;...</span><span class="stt"></span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">module ints2 </span><span class="emph">...&#21516;&#21069;...</span><span class="stt"></span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">module ints1-to-int</span></p></td></tr><tr><td><p><span class="stt">interface [to-int : (from ints1 take t -&gt; int)]</span></p></td></tr><tr><td><p><span class="stt">body (to-int-maker ints1)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">module ints2-to-int</span></p></td></tr><tr><td><p><span class="stt">interface [to-int : (from ints2 take t -&gt; int)]</span></p></td></tr><tr><td><p><span class="stt">body (to-int-maker ints2)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">let s1 = from ints1 take succ</span></p></td></tr><tr><td><p><span class="stt">in let z1 = from ints1 take zero</span></p></td></tr><tr><td><p><span class="stt">in let to-ints1 = from ints1-to-int take to-int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">in let s2 = from ints2 take succ</span></p></td></tr><tr><td><p><span class="stt">in let z2 = from ints2 take zero</span></p></td></tr><tr><td><p><span class="stt">in let to-ints2 = from ints2-to-int take to-int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">in let two1 = (s1 (s1 z1))</span></p></td></tr><tr><td><p><span class="stt">in let two2 = (s2 (s2 z2))</span></p></td></tr><tr><td><p><span class="stt">in -((to-ints1 two1), (to-ints2 two2))</span></p></td></tr></table></blockquote><p>&#31867;&#22411;&#20026; <span class="stt">int</span>&#65292;&#20540;&#20026; 0&#12290;&#22914;&#26524;&#25105;&#20204;&#23558; <span class="stt">(to-ints2 two2)</span> &#26367;&#25442;&#20026; <span class="stt">(to-ints2
two1)</span>&#65292;&#21017;&#31243;&#24207;&#31867;&#22411;&#24322;&#24120;&#65292;&#22240;&#20026; <span class="stt">to-ints2</span> &#26399;&#26395;&#30340;&#21442;&#25968;&#31867;&#22411;&#26159; <span class="stt">int2</span> &#34920;&#31034;&#30340;&#31639;&#26415;
&#25805;&#20316;&#65292;&#20294;&#20540; <span class="stt">two1</span> &#30340;&#31867;&#22411;&#26159; <span class="stt">int1</span> &#34920;&#31034;&#30340;&#31639;&#26415;&#25805;&#20316;&#12290;</p></blockquote></div></p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..19)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span><span class="EoplExampleRef"></span> &#20013;&#65292;&#21019;&#24314; <span class="stt">two1</span> &#21644; <span class="stt">two2</span> &#30340;&#20195;&#30721;&#37325;&#22797;&#65292;&#22240;&#27492;&#21487;&#20197;&#25277;&#35937;&#20986;
&#26469;&#12290;&#23436;&#25104;&#27169;&#22359;&#23450;&#20041;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module from-int-maker</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">((ints : [opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">zero : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">succ : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">pred : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">is-zero : (t -&gt; bool)])</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">=&gt; [from-int : (int -&gt; from ints take t)])</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr></table></blockquote><p>&#29992;&#27169;&#22359; <span class="stt">ints</span>&#34920;&#31034;&#25972;&#25968;&#34920;&#36798;&#20540;&#12290;&#29992;&#20320;&#30340;&#27169;&#22359;&#37325;&#20570;<span class="EoplExampleRef"></span> &#20013;&#30340;&#35745;&#31639;&#12290;&#29992;
&#22823;&#20110; 2 &#30340;&#21442;&#25968;&#27979;&#35797;&#12290;</p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..20)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span><a name="(idx._(gentag._1267))"></a>
&#23436;&#25104;&#27169;&#22359;&#23450;&#20041;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module sum-prod-maker</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">((ints : [opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">zero : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">succ : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">pred : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">is-zero : (t -&gt; bool)])</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">=&gt; [plus : (from ints take t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">-&gt; (from ints take t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">-&gt; from ints take t))</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">times : (from ints take t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">-&gt; (from ints take t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">-&gt; from ints take t))])</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[plus = ...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">times = ...]</span></p></td></tr></table></blockquote><p>&#23450;&#20041;&#19968;&#20010;&#27169;&#22359;&#36807;&#31243;&#65292;&#23427;&#21462;&#19968;&#31639;&#26415;&#25805;&#20316;&#30340;&#23454;&#29616;&#65292;&#29983;&#25104;&#29992;&#36825;&#31181;&#23454;&#29616;&#30340;&#27714;&#21644;&#21644;&#27714;&#31215;&#30340;&#36807;&#31243;&#12290;&#29992;
<span class="stt">plus</span>&#20013;&#30340; <span class="stt">plus</span> &#23450;&#20041;&#65292;&#20197;&#21450;&#31867;&#20284;&#30340; <span class="stt">times</span> &#23450;&#20041;&#12290;</p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..21)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#20889;&#19968;&#20010;&#27169;&#22359;&#36807;&#31243;&#65292;&#21462;&#31639;&#26415;&#25805;&#20316;&#30340;&#23454;&#29616; <span class="stt">ints</span>&#65292;&#36820;&#22238;&#31639;&#26415;&#25805;&#20316;&#30340;&#21478;&#19968;&#31181;&#23454;&#29616;&#65292;&#20854;&#20013;&#65292;&#25972;&#25968;
<span class="texMathInline">k</span> &#20197; <span class="stt">ints</span> &#20013;&#30340; <span class="texMathInline">2*k</span> &#34920;&#31034;&#12290;</p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..22)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#23436;&#25104;&#27169;&#22359;&#23450;&#20041;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module equality-maker</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">((ints : [opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">zero : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">succ : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">pred : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">is-zero : (t -&gt; bool)])</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">=&gt; [equal : (from ints take t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">-&gt; (from ints take t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">-&gt; bool))])</span></p></td></tr><tr><td><p><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">...</span></p></td></tr></table></blockquote><p>&#23450;&#20041;&#19968;&#20010;&#27169;&#22359;&#36807;&#31243;&#65292;&#23427;&#21462;&#19968;&#31639;&#26415;&#25805;&#20316;&#30340;&#23454;&#29616;&#65292;&#29983;&#25104;&#19968;&#36807;&#31243;&#65292;&#29992;&#36825;&#31181;&#23454;&#29616;&#20570;&#30456;&#31561;&#27604;&#36739;&#12290;
<a name="(idx._(gentag._1268))"></a></p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..23)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span><a name="(idx._(gentag._1269))"></a>
&#20889;&#20986;&#27169;&#22359; <span class="stt">table-of</span>&#65292;&#23427;&#19982;<span class="EoplExerciseRef"></span> &#20013;&#30340; <span class="stt">table</span> &#27169;&#22359;&#31867;&#20284;&#65292;&#21482;&#26159;
&#23558;&#34920;&#30340;&#20869;&#23481;&#21442;&#25968;&#21270;&#65292;&#36825;&#26679;&#23601;&#33021;&#29992;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">module mybool-tables</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">[opaque table</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">empty : table</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">add-to-table : (int -&gt;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(from mybool take t -&gt;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(table -&gt; table)))</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">lookup-in-table : (int -&gt;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(table -&gt;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">from mybool take t))]</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(table-of mybool)</span></p></td></tr></table></blockquote><p>&#23450;&#20041;&#21253;&#21547; <span class="stt">from mybool take t</span> &#31867;&#22411;&#20540;&#30340;&#34920;&#12290;
<a name="(idx._(gentag._1270))"></a></p></blockquote><h5>8.3.2<tt>&nbsp;</tt><a name="(part._s8..3..2)"></a>&#23454;&#29616;</h5><h5><a name="(part._s8..3-syntax)"></a>&#35821;&#27861;</h5><p><a name="(idx._(gentag._1271))"></a>
&#32473;&#25105;&#20204;&#30340;&#35821;&#35328;&#28155;&#21152;&#27169;&#22359;&#36807;&#31243;&#23601;&#20687;&#28155;&#21152;&#36807;&#31243;&#19968;&#26679;&#12290;&#27169;&#22359;&#36807;&#31243;&#30340;&#25509;&#21475;&#24456;&#20687; <span class="stt">proc</span> &#30340;&#31867;&#22411;&#12290;</p><blockquote class="Small"><p><span class="Iidentity">\begin{align*}   \mathit{Iface} &amp;::= <span class="stt">((</span><span class="Iidentity">\mathit{Identifier}</span><span class="stt"> : </span><span class="Iidentity">\mathit{Iface}</span><span class="stt">)) =&gt; </span><span class="Iidentity">\mathit{Iface}</span> \\[-3pt]
&amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">proc-iface (param-name param-iface result-iface)</span>}\end{align*}</span></p></blockquote><p>&#34429;&#28982;&#36825;&#22871;&#25509;&#21475;&#30475;&#36215;&#26469;&#20687;&#26159;&#26222;&#36890;&#30340;&#36807;&#31243;&#31867;&#22411;&#65292;&#23427;&#36824;&#26159;&#26377;&#20004;&#22788;&#21306;&#21035;&#12290;&#39318;&#20808;&#65292;&#23427;&#25551;&#36848;&#20102;&#27169;&#22359;&#20540;&#21040;&#27169;
&#22359;&#20540;&#30340;&#20989;&#25968;&#65292;&#32780;&#38750;&#34920;&#36798;&#20540;&#21040;&#34920;&#36798;&#20540;&#30340;&#20989;&#25968;&#12290;&#20854;&#27425;&#65292;&#19981;&#20687;&#36807;&#31243;&#31867;&#22411;&#65292;&#23427;&#35201;&#32473;&#20989;&#25968;&#30340;&#36755;&#20837;&#21629;&#21517;&#12290;
&#36825;&#26159;&#24517;&#39035;&#30340;&#65292;&#22240;&#20026;&#36755;&#20986;&#30340;&#25509;&#21475;&#21487;&#33021;&#20381;&#36182;&#36755;&#20837;&#30340;&#20540;&#65292;&#23601;&#20687; <span class="stt">to-int-maker</span> &#30340;&#31867;&#22411;&#37027;&#26679;&#65306;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">((ints : [opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">zero : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">succ : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">pred : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">is-zero : (t -&gt; bool)])</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">=&gt; [to-int : (from ints take t -&gt; int)])</span></p></td></tr></table></blockquote><p><span class="stt">to-int-maker</span> &#21462;&#19968;&#27169;&#22359; <span class="stt">ints</span>&#65292;&#29983;&#25104;&#19968;&#27169;&#22359;&#65292;&#20854;&#31867;&#22411;&#19981;&#20165;&#20381;&#36182; <span class="stt">ints</span> &#20013;&#30340;
&#22266;&#23450;&#31867;&#22411;&#65292;&#20063;&#20381;&#36182; <span class="stt">ints</span> &#26412;&#36523;&#12290;<a name="(elem._module-proc-eg)"></a>&#24403;&#25105;&#20204;
&#20687;<span class="EoplExampleRef"></span> &#37027;&#26679;&#29992; <span class="stt">ints1</span> &#35843;&#29992; <span class="stt">to-int-maker</span> &#26102;&#65292;&#24471;&#21040;&#30340;&#27169;&#22359;
&#25509;&#21475;&#26159;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">[to-int : (from ints1 take t -&gt; int)]</span></p></td></tr></table></blockquote><p>&#32780;&#24403;&#25105;&#20204;&#29992; <span class="stt">ints2</span> &#35843;&#29992;&#26102;&#65292;&#24471;&#21040;&#30340;&#26159;&#21478;&#19968;&#20010;&#25509;&#21475;</p><p><div class="SIntrapara"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">[to-int : (from ints2 take t -&gt; int)]</span></p></td></tr></table></blockquote></div><div class="SIntrapara"><a name="(idx._(gentag._1272))"></a></div></p></blockquote><p>&#25105;&#20204;&#25193;&#23637; <span class="stt">expand-iface</span> &#26469;&#22788;&#29702;&#36825;&#20123;&#26032;&#25509;&#21475;&#65292;&#24182;&#25353;&#24050;&#23637;&#24320;&#22788;&#29702;&#12290;&#36825;&#26679;&#34892;&#24471;&#36890;&#26159;&#22240;&#20026;&#21442;
&#25968;&#25509;&#21475;&#21644;&#32467;&#26524;&#25509;&#21475;&#22312;&#38656;&#35201;&#26102;&#33258;&#20250;&#23637;&#24320;&#12290;</p><blockquote class="EoplCodeInset"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">expand-iface</span></span> : <span class="texMathInline">\mathit{Sym} \times \mathit{Iface} \times \mathit{Tenv} \to \mathit{Iface}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">expand-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">iface</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">interface</span><span class="hspace">&nbsp;</span><span class="RktSym">iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decls</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="emph">...&#21516;&#21069;...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">proc-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">param-name</span><span class="hspace">&nbsp;</span><span class="RktSym">param-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">result-iface</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">iface</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote><p><a name="(idx._(gentag._1273))"></a>
<a name="(idx._(gentag._1274))"></a>
&#25105;&#20204;&#38656;&#35201;&#26032;&#30340;&#27169;&#22359;&#20027;&#20307;&#26469;&#21019;&#24314;&#27169;&#22359;&#36807;&#31243;&#65292;&#24341;&#29992;&#27169;&#22359;&#36807;&#31243;&#30340;&#32465;&#23450;&#21464;&#37327;&#65292;&#20197;&#21450;&#35843;&#29992;&#27169;&#22359;&#36807;&#31243;&#12290;</p><blockquote class="Small"><p><span class="Iidentity">\begin{align*}\mathit{ModuleBody} &amp;::= <span class="stt">module-proc (</span><span class="Iidentity">\mathit{Identifier}</span><span class="stt"> : </span><span class="Iidentity">\mathit{Iface}</span><span class="stt">) </span><span class="Iidentity">\mathit{ModuleBody}</span> \\[-3pt]
  &amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">proc-module-body (m-name m-type m-body)</span>} \\[-5pt]
\mathit{ModuleBody} &amp;::= \mathit{Identifier} \\[-3pt]
  &amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">var-module-body (m-name)</span>} \\[-5pt]
\mathit{ModuleBody} &amp;::= <span class="stt">(</span><span class="Iidentity">\mathit{Identifier}</span><span class="stt"> </span><span class="Iidentity">\mathit{Identifier}</span><span class="stt">)</span> \\[-3pt]
  &amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">app-module-body (rator rand)</span>}\end{align*}</span></p></blockquote><h5><a name="(part._s8..3-interpreter)"></a>&#35299;&#37322;&#22120;</h5><p><a name="(idx._(gentag._1275))"></a>
&#39318;&#20808;&#65292;&#31867;&#20284;&#36807;&#31243;&#65292;&#25105;&#20204;&#26032;&#22686;&#19968;&#31181;&#27169;&#22359;&#12290;</p><blockquote class="EoplCodeInset"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define-datatype</span><span class="hspace">&nbsp;</span><span class="RktSym">typed-module</span><span class="hspace">&nbsp;</span><span class="RktSym">typed-module?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-module</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bindings</span><span class="hspace">&nbsp;</span><span class="RktSym">environment?</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">proc-module</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">b-var</span><span class="hspace">&nbsp;</span><span class="RktSym">symbol?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym">module-body?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">saved-env</span><span class="hspace">&nbsp;</span><span class="RktSym">environment?</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote><p>&#25105;&#20204;&#25193;&#23637; <span class="stt">value-of-module-body</span> &#22788;&#29702;&#26032;&#30340;&#27169;&#22359;&#20027;&#20307;&#12290;&#20195;&#30721;&#19982;&#34920;&#36798;&#24335;&#20013;&#30340;&#21464;&#37327;&#24341;&#29992;&#21644;
&#36807;&#31243;&#35843;&#29992;&#21313;&#20998;&#31867;&#20284;&#65288;<span class="EoplFigureRef"></span>&#65289;&#12290;
<a name="(idx._(gentag._1276))"></a></p><blockquote class="EoplFigure"><p><div class="SIntrapara">[!t]</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">value-of-module-body</span></span> : <span class="texMathInline">\mathit{ModuleBody} \times \mathit{Env} \to \mathit{TypedModule}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">value-of-module-body</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-body</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">module-body</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns-module-body</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...as</span><span class="hspace">&nbsp;</span><span class="RktSym">before...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var-module-body</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-name</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-module-name-in-env</span><span class="hspace">&nbsp;</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">proc-module-body</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">m-type</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">proc-module</span><span class="hspace">&nbsp;</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">app-module-body</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rator</span><span class="hspace">&nbsp;</span><span class="RktSym">rand</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">rator-val</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-module-name-in-env</span><span class="hspace">&nbsp;</span><span class="RktSym">rator</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rand-val</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-module-name-in-env</span><span class="hspace">&nbsp;</span><span class="RktSym">rand</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">typed-module</span><span class="hspace">&nbsp;</span><span class="RktSym">rator-val</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">proc-module</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">value-of-module-body</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-env-with-module</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">m-name</span><span class="hspace">&nbsp;</span><span class="RktSym">rand-val</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">else</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">report-bad-module-app</span><span class="hspace">&nbsp;</span><span class="RktSym">rator-val</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="caption"><p><span class="stt">value-of-module-body</span><a name="(elem._fig-8..13)"></a></p></blockquote></div><div class="SIntrapara"><a name="(idx._(gentag._1277))"></a></div></p></blockquote><h5><a name="(part._s8..3-checker)"></a>&#26816;&#26597;&#22120;</h5><p><div class="SIntrapara"><a name="(idx._(gentag._1278))"></a>
<a name="(idx._(gentag._1279))"></a>
</div><div class="SIntrapara"><blockquote class="EoplFigure"><p>[!ht]<span class="texMathDisplay">\begin{array}{l}
 \small{\textrm{IFACE-M-VAR}} \\
 <span class="stt">(</span><span class="texMathInline">\rhd</span><span class="stt"> </span><span class="texMathInline">m</span><span class="stt"> </span><span class="texMathInline">tenv</span><span class="stt">)</span> = tenv<span class="stt">(</span><span class="texMathInline">m</span><span class="stt">)</span>
\end{array}</span></p><p><span class="texMathDisplay">\begin{array}{l}
 \small{\textrm{IFACE-M-PROC}} \\
 \infer{<span class="stt">(</span><span class="texMathInline">\rhd</span><span class="stt"> (m-proc (</span><span class="texMathInline">m</span><span class="stt">:</span><span class="texMathInline">i_1</span><span class="stt">) </span><span class="texMathInline">body</span><span class="stt">))</span> = <span class="stt">((</span><span class="texMathInline">m</span><span class="stt">:</span><span class="texMathInline">i_1</span><span class="stt">) =&gt; </span><span class="texMathInline">i^{\prime}_{1}</span><span class="stt">)</span>}
       {<span class="stt">(</span><span class="texMathInline">\rhd</span><span class="stt"> body [</span><span class="texMathInline">m</span><span class="stt">=</span><span class="texMathInline">i_1</span><span class="stt">]tenv)</span> = i^{\prime}}
\end{array}</span></p><p><span class="texMathDisplay">\begin{array}{l}
 \small{\textrm{IFACE-M-APP}} \\
 \infer{<span class="stt">(</span><span class="texMathInline">\rhd</span><span class="stt"> (</span><span class="texMathInline">m_1</span><span class="stt"> </span><span class="texMathInline">m_2</span><span class="stt">) tenv)</span> = <span class="stt">i((</span><span class="texMathInline">m</span><span class="stt">:</span><span class="texMathInline">i_1</span><span class="stt">) =&gt; </span><span class="texMathInline">i^{\prime}_{1}</span><span class="stt">)</span>}
       {\begin{array}{c}
         tenv(m_1) = <span class="stt">((</span><span class="texMathInline">m</span><span class="stt">:</span><span class="texMathInline">i_1</span><span class="stt">) =&gt; </span><span class="texMathInline">i^{\prime}_{1}</span><span class="stt">)</span> \quad tenv(<span class="texMathInline">m_2</span>) = <span class="texMathInline">i_2</span> \\
         i_2 &lt;: i_1
        \end{array}}
\end{array}</span></p><blockquote class="caption"><p>&#26032;&#27169;&#22359;&#20027;&#20307;&#30340;&#21028;&#31867;&#35268;&#21017;<a name="(elem._fig-8..14)"></a></p></blockquote></blockquote></div></p><p>&#25105;&#20204;&#21487;&#20197;&#32473;&#26032;&#30340;&#27169;&#22359;&#20027;&#20307;&#20889;&#20986;<a href="types.html#%28part._s7..2%29" data-pltdoc="x">&#36171;&#20104;&#34920;&#36798;&#20540;&#31867;&#22411;</a>&#37027;&#26679;&#30340;&#35268;&#21017;&#12290;&#36825;&#20123;&#35268;&#21017;
&#22914;<span class="EoplFigureRef"></span> &#25152;&#31034;&#12290;&#20026;&#20102;&#33021;&#22312;&#19968;&#39029;&#32440;&#20869;&#20889;&#19979;&#35268;&#21017;&#65292;&#25105;&#20204;&#29992; <span class="stt">(</span><span class="texMathInline">\rhd</span><span class="stt">
</span><span class="texMathInline">body</span><span class="stt"> </span><span class="texMathInline">tenv</span><span class="stt">) = </span><span class="texMathInline">i</span> &#20195;&#26367; <span class="stt">(interface-of </span><span class="texMathInline">body</span><span class="stt"> </span><span class="texMathInline">tenv</span><span class="stt">) = </span><span class="texMathInline">i</span>&#12290;</p><p>&#27491;&#22914;&#39044;&#24819;&#30340;&#37027;&#26679;&#65292;&#27169;&#22359;&#21464;&#37327;&#30340;&#31867;&#22411;&#20174;&#31867;&#22411;&#29615;&#22659;&#20013;&#21462;&#24471;&#12290;&#23601;&#20687; CHECKED &#20013;&#30340;&#36807;&#31243;&#37027;&#26679;&#65292;
<span class="stt">module-proc</span> &#30340;&#31867;&#22411;&#26681;&#25454;&#21442;&#25968;&#31867;&#22411;&#21644;&#20027;&#20307;&#31867;&#22411;&#24471;&#21040;&#12290;</p><p>&#27169;&#22359;&#36807;&#31243;&#30340;&#35843;&#29992;&#24456;&#20687; CHECKED &#20013;&#30340;&#36807;&#31243;&#35843;&#29992;&#65292;&#20294;&#26377;&#20004;&#20010;&#37325;&#35201;&#21306;&#21035;&#12290;</p><p>&#39318;&#20808;&#65292;&#25805;&#20316;&#25968;&#30340;&#31867;&#22411;&#65288;&#35268;&#21017; IFACE-M-APP &#20013;&#30340; <span class="texMathInline">i_2</span>&#65289;&#19981;&#24517;&#19982;&#21442;&#25968;&#31867;&#22411; (<span class="texMathInline">i_1</span>) &#30456;&#21516;&#12290;
&#25105;&#20204;&#21482;&#35201;&#27714; <span class="texMathInline">i_2 &lt;: i_1</span>&#12290;&#36825;&#23601;&#22815;&#20102;&#65292;&#22240;&#20026; <span class="texMathInline">i_2 &lt;: i_1</span> &#24847;&#21619;&#30528;&#28385;&#36275;&#25509;&#21475; <span class="texMathInline">i_2</span>
&#30340;&#20219;&#24847;&#27169;&#22359;&#37117;&#28385;&#36275;&#25509;&#21475; <span class="texMathInline">i_1</span>&#65292;&#20063;&#23601;&#33021;&#20316;&#20026;&#27169;&#22359;&#36807;&#31243;&#30340;&#21442;&#25968;&#12290;</p><p>&#20854;&#27425;&#65292;&#22312;&#32467;&#26524;&#31867;&#22411; <span class="texMathInline">t^{\prime}_{1}</span> &#20013;&#65292;&#25105;&#20204;&#25226; <span class="texMathInline">m</span> &#20195;&#25442;&#20026;&#25805;&#20316;&#25968; <span class="texMathInline">m_2</span>&#12290;&#32771;&#34385;
<span class="stt">module-proc-eg</span>&#30340;&#20363;&#23376;&#12290;&#20854;&#20013;&#65292;&#25105;&#20204;&#29992; <span class="stt">ints1</span> &#21644; <span class="stt">ints2</span> &#35843;&#29992;&#27169;&#22359;&#36807;
&#31243; <span class="stt">to-int-maker</span>&#65292;&#20854;&#25509;&#21475;&#20026;</p><blockquote class="SubFlow"><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">((ints : [opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">zero : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">succ : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">pred : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">is-zero : (t -&gt; bool)])</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">=&gt; [to-int : (from ints take t -&gt; int)])</span></p></td></tr></table></blockquote><p>&#24403;&#25105;&#20204;&#29992; <span class="stt">ints1</span> &#35843;&#29992; <span class="stt">to-int-maker</span>&#65292;&#20195;&#25442;&#32780;&#24471;&#30340;&#25509;&#21475;&#20026;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">[to-int : (from ints1 take t -&gt; int)]</span></p></td></tr></table></blockquote><p>&#24403;&#25105;&#20204;&#29992; <span class="stt">ints2</span> &#35843;&#29992; <span class="stt">to-int-maker</span>&#65292;&#20195;&#25442;&#32780;&#24471;&#30340;&#25509;&#21475;&#20026;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">[to-int : (from ints2 take t -&gt; int)]</span></p></td></tr></table></blockquote><p>&#27491;&#21512;&#26399;&#26395;&#12290;</p></blockquote><blockquote class="EoplFigure"><p><div class="SIntrapara">[!ht]</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">interface-of</span></span> : <span class="texMathInline">\mathit{ModuleBody} \times \mathit{Tenv} \to \mathit{Iface}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">interface-of</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-body</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">module-body</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">var-module-body</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">m-name</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-module-name-in-tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">m-name</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns-module-body</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">defns-to-decls</span><span class="hspace">&nbsp;</span><span class="RktSym">defns</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">app-module-body</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rator-id</span><span class="hspace">&nbsp;</span><span class="RktSym">rand-id</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">rator-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-module-name-in-tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">rator-id</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rand-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-module-name-in-tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="hspace">&nbsp;</span><span class="RktSym">rand-id</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">interface</span><span class="hspace">&nbsp;</span><span class="RktSym">rator-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decls</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">report-attempt-to-apply-simple-module</span><span class="hspace">&nbsp;</span><span class="RktSym">rator-id</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">proc-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">param-name</span><span class="hspace">&nbsp;</span><span class="RktSym">param-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">result-iface</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;:-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">rand-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">param-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rename-in-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">result-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">param-name</span><span class="hspace">&nbsp;</span><span class="RktSym">rand-id</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">report-bad-module-application-error</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">param-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">rand-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">proc-module-body</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rand-name</span><span class="hspace">&nbsp;</span><span class="RktSym">rand-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">body-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">interface-of</span><span class="hspace">&nbsp;</span><span class="RktSym">m-body</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv-with-module</span><span class="hspace">&nbsp;</span><span class="RktSym">rand-name</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">rand-name</span><span class="hspace">&nbsp;</span><span class="RktSym">rand-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">proc-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">rand-name</span><span class="hspace">&nbsp;</span><span class="RktSym">rand-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">body-iface</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><blockquote class="caption"><p>PROC-MODULES&#30340;&#26816;&#26597;&#22120;&#65292;&#31532;1&#37096;&#20998;
<a name="(idx._(gentag._1280))"></a>
<a name="(idx._(gentag._1281))"></a>
<a name="(idx._(gentag._1282))"></a><a name="(elem._fig-8..15)"></a></p></blockquote></blockquote><p>&#29992;&#36825;&#20123;&#35268;&#21017;&#65292;&#24456;&#23481;&#26131;&#20889;&#20986; <span class="stt">interface-of</span> &#30340;&#20195;&#30721;&#65288;<span class="EoplFigureRef"></span>&#65289;&#12290;&#24403;&#25105;&#20204;
&#26816;&#26597; <span class="stt">module-proc</span> &#30340;&#20027;&#20307;&#26102;&#65292;&#25105;&#20204;&#25226;&#21442;&#25968;&#28155;&#21152;&#21040;&#31867;&#22411;&#29615;&#22659;&#20013;&#65292;&#23601;&#22909;&#20687;&#23427;&#26159;&#20301;&#20110;&#39030;&#23618;&#30340;
&#27169;&#22359;&#12290;&#36825;&#27573;&#20195;&#30721;&#29992;&#36807;&#31243; <span class="stt">rename-in-iface</span> &#23545;&#24471;&#21040;&#30340;&#25509;&#21475;&#36827;&#34892;&#20195;&#25442;&#12290;</p><p>&#26368;&#21518;&#65292;&#25105;&#20204;&#25193;&#23637; <span class="stt">&lt;:-iface</span>&#65292;&#22788;&#29702;&#26032;&#30340;&#31867;&#22411;&#12290;&#29992;&#26469;&#27604;&#36739; <span class="stt">proc-iface</span> &#30340;&#35268;&#21017;&#20026;</p><blockquote class="Small"><p><span class="texMathDisplay">\infer{<span class="stt">((</span><span class="texMathInline">m_1</span><span class="stt"> : </span><span class="texMathInline">i_1</span><span class="stt">) =&gt; </span><span class="texMathInline">i^{\prime}_{1}</span><span class="stt">)</span> &lt;: <span class="stt">((</span><span class="texMathInline">m_2</span><span class="stt"> : </span><span class="texMathInline">i_2</span><span class="stt">) =&gt; </span><span class="texMathInline">i^{\prime}_{2}</span><span class="stt">)</span>}
      {i_2 &lt;: i_1 &amp;
       i^{\prime}_{1}<span class="stt">[</span><span class="texMathInline">m^{\prime}/m_{1}</span><span class="stt">]</span> &lt;: i^{\prime}_{2}<span class="stt">[</span><span class="texMathInline">m^{\prime}/m_{2}</span><span class="stt">]</span> &amp;
       m^{\prime} &#19981;&#22312; i^{\prime}_{1} &#25110; i^{\prime}_{2} &#20013;}</span></p></blockquote><p>&#35201;&#20351; <span class="stt">((</span><span class="texMathInline">m_1</span><span class="stt"> : </span><span class="texMathInline">i_1</span><span class="stt">) =&gt; </span><span class="texMathInline">i^{\prime}_{1}</span><span class="stt">)</span>&#65292;&#28385;&#36275;&#31532;&#19968;&#20010;&#25509;&#21475;&#30340;&#27169;&#22359;
<span class="texMathInline">m_0</span> &#20063;&#24517;&#39035;&#28385;&#36275;&#31532;&#20108;&#20010;&#25509;&#21475;&#12290;&#36825;&#23601;&#26159;&#35828;&#65292;&#25509;&#21475;&#20026; <span class="texMathInline">i_2</span> &#30340;&#20219;&#20309;&#27169;&#22359;&#37117;&#33021;&#20316;&#20026;&#21442;&#25968;&#65292;
&#20256;&#32473; <span class="texMathInline">m_0</span>&#65292;<span class="texMathInline">m_0</span> &#20135;&#29983;&#30340;&#20219;&#20309;&#27169;&#22359;&#37117;&#28385;&#36275; <span class="texMathInline">i^{\prime}_{2}</span>&#12290;</p><p>&#20026;&#28385;&#36275;&#31532;&#19968;&#20010;&#35201;&#27714;&#65292;&#25105;&#20204;&#35201;&#27714; <span class="texMathInline">i_2 &lt;: i_1</span>&#12290;&#36825;&#20445;&#35777;&#20102;&#28385;&#36275; <span class="texMathInline">i_2</span> &#30340;&#20219;&#20309;&#27169;&#22359;&#37117;&#33021;&#20316;
&#20026;&#21442;&#25968;&#20256;&#32473; <span class="texMathInline">m_0</span>&#12290;&#27880;&#24847;&#36870;&#24207;&#65306;&#25105;&#20204;&#35828;&#21442;&#25968;&#31867;&#22411;&#30340;<span class="emph">&#23376;&#31867;&#22411;&#21028;&#23450;</span> (<span class="emph">subtyping</span>)
&#26159;<span class="emph">&#36870;&#21464;&#30340;</span> (<span class="emph">contravariant</span>)&#12290;
<a name="(idx._(gentag._1283))"></a></p><p>&#32467;&#26524;&#30340;&#31867;&#22411;&#21602;&#65311;&#25105;&#20204;&#21487;&#20197;&#35201;&#27714; <span class="texMathInline">i^{\prime}_{1} &lt;: i^{\prime}_{2}</span>&#12290;&#19981;&#24184;&#30340;&#26159;&#65292;&#36825;&#34892;
&#19981;&#36890;&#12290;<span class="texMathInline">i^{\prime}_{1}</span> &#20013;&#65292;&#21487;&#33021;&#20986;&#29616;&#27169;&#22359;&#21464;&#37327; <span class="texMathInline">m_1</span>&#65292;<span class="texMathInline">i^{\prime}_{2}</span> &#20013;&#65292;&#21487;
&#33021;&#20986;&#29616;&#27169;&#22359;&#21464;&#37327; <span class="texMathInline">m_2</span> &#30340;&#23454;&#20363;&#12290;&#25152;&#20197;&#65292;&#35201;&#27604;&#36739;&#23427;&#20204;&#65292;&#25105;&#20204;&#24471;&#23558; <span class="texMathInline">m_1</span> &#21644; <span class="texMathInline">m_2</span> &#37325;
&#21629;&#21517;&#20026;&#26032;&#30340;&#27169;&#22359;&#21464;&#37327; <span class="texMathInline">m^{\prime}</span>&#12290;&#19968;&#26086;&#23436;&#25104;&#36825;&#19968;&#27493;&#65292;&#25105;&#20204;&#23601;&#33021;&#29031;&#24120;&#27604;&#36739;&#23427;&#20204;&#20102;&#12290;&#36825;&#23601;
&#24471;&#20986;&#26465;&#20214; <span class="texMathInline">i^{\prime}_{1}<span class="stt">[</span><span class="texMathInline">m^{\prime}/m_{1}</span><span class="stt">]</span> &lt;:
i^{\prime}_{2}<span class="stt">[</span><span class="texMathInline">m^{\prime}/m_{2}</span><span class="stt">]</span></span>&#12290;</p><p>&#21028;&#26029;&#36825;&#31181;&#20851;&#31995;&#30340;&#20195;&#30721;&#36739;&#20026;&#30452;&#30333;&#65288;<span class="EoplFigureRef"></span>&#65289;&#12290;&#21028;&#26029;
<span class="texMathInline">i^{\prime}_{1}<span class="stt">[</span><span class="texMathInline">m^{\prime}/m_{1}</span><span class="stt">]</span> &lt;:
i^{\prime}_{2}<span class="stt">[</span><span class="texMathInline">m^{\prime}/m_{2}</span><span class="stt">]</span></span> &#26102;&#65292;&#25105;&#20204;&#25193;&#23637;&#31867;&#22411;&#29615;&#22659;&#65292;&#32473;
<span class="texMathInline">m^{\prime}</span> &#28155;&#21152;&#32465;&#23450;&#12290;&#30001;&#20110; <span class="texMathInline">i_1</span> &#30340;&#27604; <span class="texMathInline">i_2</span> &#23567;&#65292;&#25105;&#20204;&#23558; <span class="texMathInline">m^{\prime}</span> &#19982;
&#23427;&#20851;&#32852;&#36215;&#26469;&#12290;&#25105;&#20204;&#35843;&#29992; <span class="stt">extend-tenv-with-module</span> &#27604;&#36739;&#32467;&#26524;&#30340;&#31867;&#22411;&#26102;&#65292;&#36824;&#35201;&#35843;&#29992;
<span class="stt">expand-iface</span> &#32500;&#25345;&#19981;&#21464;&#24335;&#12290;</p><p><a name="(idx._(gentag._1284))"></a>
&#29616;&#22312;&#65292;&#23436;&#25104;&#20102;&#12290;&#21507;&#26479;&#22307;&#20195;&#21543;&#65292;&#25918;&#20123;&#22902;&#27833;<span class="emph">&#21475;</span>&#21619;&#12289;&#28909;&#27975;&#27713;<span class="emph">&#21475;</span>&#21619;&#12289;&#36824;&#26377;
&#22362;&#26524;<span class="emph">&#21475;</span>&#21619;&#30340;&#20304;&#26009;&#12290;&#24590;&#20040;&#32452;&#21512;&#19981;&#35201;&#32039;&#65292;&#22909;&#21507;&#23601;&#34892;&#65281;
<a name="(idx._(gentag._1285))"></a>
<a name="(idx._(gentag._1286))"></a>
<a name="(idx._(gentag._1287))"></a>
<a name="(idx._(gentag._1288))"></a>
<a name="(idx._(gentag._1289))"></a>
<a name="(idx._(gentag._1290))"></a>
<a name="(idx._(gentag._1291))"></a></p><blockquote class="EoplFigure"><p><div class="SIntrapara">[!ht]</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span style="font-weight: bold"><span class="stt">&lt;:-iface</span></span> : <span class="texMathInline">\mathit{Iface} \times \mathit{Iface} \times \mathit{Tenv} \to \mathit{Bool}</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;:-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lambda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">iface1</span><span class="hspace">&nbsp;</span><span class="RktSym">iface2</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">interface</span><span class="hspace">&nbsp;</span><span class="RktSym">iface1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decls1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">interface</span><span class="hspace">&nbsp;</span><span class="RktSym">iface2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decls2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;:-decls</span><span class="hspace">&nbsp;</span><span class="RktSym">decls1</span><span class="hspace">&nbsp;</span><span class="RktSym">decls2</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">proc-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">param-name2</span><span class="hspace">&nbsp;</span><span class="RktSym">param-iface2</span><span class="hspace">&nbsp;</span><span class="RktSym">result-iface2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">proc-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">param-name1</span><span class="hspace">&nbsp;</span><span class="RktSym">param-iface1</span><span class="hspace">&nbsp;</span><span class="RktSym">result-iface1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cases</span><span class="hspace">&nbsp;</span><span class="RktSym">interface</span><span class="hspace">&nbsp;</span><span class="RktSym">iface2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simple-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">decls2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">proc-iface</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">param-name2</span><span class="hspace">&nbsp;</span><span class="RktSym">param-iface2</span><span class="hspace">&nbsp;</span><span class="RktSym">result-iface2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">new-name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fresh-module-name</span><span class="hspace">&nbsp;</span><span class="RktSym">param-name1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">let</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">result-iface1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rename-in-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">result-iface1</span><span class="hspace">&nbsp;</span><span class="RktSym">param-name1</span><span class="hspace">&nbsp;</span><span class="RktSym">new-name</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">result-iface2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rename-in-iface</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">result-iface2</span><span class="hspace">&nbsp;</span><span class="RktSym">param-name2</span><span class="hspace">&nbsp;</span><span class="RktSym">new-name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">and</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;:-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">param-iface2</span><span class="hspace">&nbsp;</span><span class="RktSym">param-iface1</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;:-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">result-iface1</span><span class="hspace">&nbsp;</span><span class="RktSym">result-iface2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">extend-tenv-with-module</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">new-name</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">expand-iface</span><span class="hspace">&nbsp;</span><span class="RktSym">new-name</span><span class="hspace">&nbsp;</span><span class="RktSym">param-iface1</span><span class="hspace">&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">tenv</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><blockquote class="caption"><p>PROC-MODULES &#30340;&#26816;&#26597;&#22120;&#65292;&#31532; 2 &#37096;&#20998;
<a name="(idx._(gentag._1292))"></a>
<a name="(idx._(gentag._1293))"></a>
<a name="(idx._(gentag._1294))"></a>
<a name="(idx._(gentag._1295))"></a>
<a name="(idx._(gentag._1296))"></a>
<a name="(idx._(gentag._1297))"></a>
<a name="(idx._(gentag._1298))"></a><a name="(elem._fig-8..16)"></a></p></blockquote></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..24)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#30446;&#21069;&#65292;&#35843;&#29992;&#27169;&#22359;&#21482;&#33021;&#36890;&#36807;&#26631;&#35782;&#31526;&#12290;&#35201;&#26159;&#25105;&#20204;&#24819;&#26816;&#26597;&#35843;&#29992; <span class="stt">(m1 (m2 m3))</span>&#65292;&#31867;&#22411;&#35268;&#21017;&#26377;&#20160;
&#20040;&#38382;&#39064;&#65311;</p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..25)"></a><span class="texMathInline">\textnormal{[}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span><a name="(idx._(gentag._1299))"></a>
&#25193;&#23637; PROC-MODULES&#65292;&#20687;<span class="EoplExerciseRef"></span> &#37027;&#26679;&#65292;&#20801;&#35768;&#27169;&#22359;&#21462;&#22810;&#20010;&#21442;&#25968;&#12290;
<a name="(idx._(gentag._1300))"></a></p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..26)"></a><span class="texMathInline">\textnormal{[}{\star}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#25193;&#23637;&#35821;&#35328;&#30340;&#27169;&#22359;&#20027;&#20307;&#65292;&#23558;&#27169;&#22359;&#35843;&#29992;&#30340;&#29983;&#25104;&#24335;&#25913;&#20026;</p><p><span class="Iidentity">\begin{align*}\mathit{ModuleBody} &amp;::= <span class="stt">(</span><span class="Iidentity">\mathit{ModuleBody}</span><span class="stt"> </span><span class="Iidentity">\mathit{ModuleBody}</span><span class="stt">)</span> \\[-3pt]
  &amp;\mathrel{\phantom{::=}} \fbox{<span class="stt">app-module-body (rator rand)</span>}\end{align*}</span></p></blockquote><blockquote class="EoplExercise"><p><a name="(elem._ex8..27)"></a><span class="texMathInline">\textnormal{[}{\star}{\star}{\star}\textnormal{]}</span><span class="hspace">&nbsp;</span>&#22312; PROC-MODULES &#20013;&#65292;&#25105;&#20204;&#24635;&#35201;&#19968;&#36941;&#21448;&#19968;&#36941;&#20889;&#36825;&#31181;&#25509;&#21475;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">[opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">zero : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">succ : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">pred : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">is-zero : (t -&gt; bool)]</span></p></td></tr></table></blockquote><p>&#32473;&#31243;&#24207;&#28155;&#21152;&#35821;&#27861;&#65292;&#25903;&#25345;&#21629;&#21517;&#25509;&#21475;&#65292;&#36825;&#26679;&#25105;&#20204;&#23601;&#33021;&#20889;</p><blockquote class="EoplCodeInset"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">interface int-interface = [opaque t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">zero : t</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">succ : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">pred : (t -&gt; t)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">is-zero : (t -&gt; bool)]</span></p></td></tr><tr><td><p><span class="stt">module make-to-int</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">interface</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">((ints : int-interface)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">=&gt; [to-int : from ints take t -&gt; int])</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">body</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">...</span></p></td></tr></table></blockquote></blockquote><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="types.html" title="backward to &quot;7 类型&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;编程语言要素&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="oac.html" title="forward to &quot;9 对象和类&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>